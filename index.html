<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FriendGPT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
        }

        .app-container {
            max-width: 428px;
            margin: 0 auto;
            min-height: 100vh;
            background: #000;
            display: flex;
            flex-direction: column;
        }

        /* Header Styles */
        .header {
            background: #000;
            padding: 16px 20px;
            border-bottom: 1px solid #00ff88;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-logo {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
        }

        .header-text {
            text-align: left;
        }

        .header-title {
            font-size: 24px;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 4px;
        }

        .header-subtitle {
            color: #999;
            font-size: 14px;
        }

        .credits {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 20px;
            padding: 6px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #00ff88;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .settings-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .settings-btn:hover {
            opacity: 1;
        }

        .credits-plus {
            background: #00ff88;
            color: #000;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }


        /* Character Browser */
        .character-browser {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .section {
            padding: 20px;
            overflow: hidden;
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 16px;
            color: #fff;
        }

        .character-grid {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 4px 4px 4px 4px;
            -webkit-overflow-scrolling: touch;
            margin: 0 -4px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .character-grid::-webkit-scrollbar {
            display: none;
        }

        .character-card {
            background: #111;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 170px;
            height: 240px;
            flex: 0 0 auto;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin: 4px 0;
        }

        .character-card:hover {
            border-color: #00ff88;
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
            transform: scale(1.02);
        }

        .character-avatar {
            width: 100%;
            height: 130px;
            border-radius: 8px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            margin-bottom: 8px;
            flex-shrink: 0;
            background-color: #222;
        }

        .character-name {
            font-weight: bold;
            font-size: 13px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .character-creator {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .character-interactions {
            font-size: 10px;
            color: #00ff88;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .character-description {
            font-size: 10px;
            color: #999;
            line-height: 1.3;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            flex: 1;
            margin-top: auto;
        }
        
        .character-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 0;
        }

        .plus-card {
            border: 2px dashed #333;
            background: rgba(0, 255, 136, 0.05);
        }

        .plus-avatar {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            font-size: 40px;
            height: 130px;
            border-radius: 8px;
        }

        .placeholder-card {
            border: 1px solid #222;
            background: rgba(40, 40, 40, 0.5);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .placeholder-card:hover {
            border-color: #444;
            box-shadow: 0 2px 8px rgba(100, 100, 100, 0.2);
            transform: scale(1.01);
        }

        .placeholder-avatar {
            background: linear-gradient(135deg, #333 0%, #555 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #777;
            font-size: 24px;
            height: 130px;
            border-radius: 8px;
        }

        .placeholder-text {
            color: #777 !important;
        }

        .coming-soon {
            background: rgba(0, 255, 136, 0.05);
            border: 1px dashed #555;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            text-align: center;
            margin-top: 4px;
        }

        /* Chat View */
        #chatView {
            display: none;
            flex-direction: column;
            height: 100vh;
        }

        .chat-header {
            background: #000;
            padding: 16px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .back-btn {
            background: none;
            border: none;
            color: #00ff88;
            font-size: 24px;
            cursor: pointer;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
        }

        .chat-info {
            flex: 1;
        }

        .chat-character-name {
            font-weight: bold;
            font-size: 16px;
        }

        .chat-character-creator {
            font-size: 12px;
            color: #666;
        }

        .gift-btn {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid #ffd700;
            color: #ffd700;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
        }

        .history-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 4px 8px;
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .history-btn:hover {
            opacity: 1;
        }

        /* Messages */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .welcome-message h3 {
            color: #00ff88;
            margin-bottom: 8px;
        }

        .message {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            margin-bottom: 12px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }

        .message-bubble {
            max-width: 70%;
            padding: 10px 14px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.4;
        }

        .message.user .message-bubble {
            background: #00ff88;
            color: #000;
            border-bottom-right-radius: 4px;
        }

        .message.character .message-bubble {
            background: #222;
            color: #fff;
            border-bottom-left-radius: 4px;
        }

        .message.gift-sent {
            justify-content: center;
        }

        .message.gift-sent .message-bubble {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000;
            font-weight: bold;
            text-align: center;
            padding: 12px 24px;
            border-radius: 20px;
        }

        .typing-indicator {
            display: none;
            align-items: flex-end;
            gap: 8px;
            margin-bottom: 12px;
        }

        .typing-indicator.show {
            display: flex;
        }

        .typing-bubble {
            padding: 12px 16px;
            background: #222;
            border-radius: 16px;
            border-bottom-left-radius: 4px;
            width: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .typing-indicator span {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #00ff88;
            margin: 0 1px;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        /* Input Area */
        .chat-input-container {
            padding: 16px;
            border-top: 1px solid #333;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            background: #111;
            border: 1px solid #333;
            border-radius: 20px;
            padding: 10px 16px;
            color: #fff;
            font-size: 14px;
            outline: none;
            resize: none;
            max-height: 120px;
            line-height: 1.4;
        }

        .send-button {
            background: #00ff88;
            color: #000;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }

        /* Purchase Modal */
        .purchase-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .purchase-content {
            background: #111;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 24px;
            max-width: 360px;
            width: 90%;
        }

        .purchase-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .purchase-header h2 {
            color: #00ff88;
            margin-bottom: 8px;
            font-size: 24px;
            font-weight: 600;
        }

        .purchase-header p {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 0;
        }

        .purchase-options {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .purchase-option {
            background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px 16px;
            transition: all 0.3s ease;
            position: relative;
            overflow: visible;
            display: flex;
            flex-direction: column;
            min-height: 120px;
        }

        .purchase-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 255, 136, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .purchase-option:hover::before {
            opacity: 1;
        }


        .purchase-option.best-value {
            border-color: #00ff88;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 255, 136, 0.05) 100%);
            position: relative;
        }

        .value-badge {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #00ff88 0%, #00cc70 100%);
            color: #000;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 16px rgba(0, 255, 136, 0.5);
            z-index: 10;
            white-space: nowrap;
        }


        .purchase-option:hover {
            border-color: #00ff88;
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(0, 255, 136, 0.2);
            background: linear-gradient(135deg, #252525 0%, #303030 100%);
        }

        .purchase-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            gap: 8px;
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .purchase-amount {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .energy-icon {
            color: #00ff88;
            font-size: 20px;
        }

        .purchase-price {
            font-size: 24px;
            font-weight: 700;
            color: #00ff88;
            text-shadow: 0 0 12px rgba(0, 255, 136, 0.4);
        }

        .stripe-checkout-btn {
            width: 100%;
            min-height: 45px;
            background: #00ff88;
            color: #0a0a0a;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 10px;
            display: block;
            text-align: center;
            text-decoration: none;
            line-height: 45px;
            position: relative;
            z-index: 100;
        }

        .stripe-checkout-btn:hover {
            background: #00dd77;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
            color: #0a0a0a;
        }

        .stripe-checkout-btn:active {
            transform: translateY(0);
        }

        .purchase-notice {
            text-align: center;
            padding: 16px;
            background: rgba(0, 255, 136, 0.08);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .purchase-notice p {
            margin: 4px 0;
            font-size: 13px;
            color: #ccc;
        }

        .purchase-notice p:first-child {
            color: #00ff88;
            font-weight: 500;
        }

        /* Gift Modal */
        .gift-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .gift-content {
            background: #111;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 24px;
            max-width: 360px;
            width: 90%;
        }

        .gift-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .gift-item {
            background: #222;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .gift-item:hover {
            border-color: #ffd700;
        }

        .gift-emoji {
            font-size: 32px;
            margin-bottom: 4px;
        }

        .gift-cost {
            font-size: 12px;
            color: #00ff88;
        }

        .close-btn {
            background: #333;
            color: #fff;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #444;
            transform: translateY(-1px);
        }

        /* Character Creator Modal */
        .character-creator-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
        }

        .creator-content {
            background: #111;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .creator-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .creator-header h2 {
            color: #00ff88;
            margin-bottom: 8px;
        }

        .creator-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: #fff;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea {
            background: #222;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            font-size: 14px;
            outline: none;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            border-color: #00ff88;
        }

        .personality-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .personality-btn {
            background: #222;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .personality-btn:hover,
        .personality-btn.active {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .creator-actions {
            display: flex;
            gap: 12px;
            margin-top: 8px;
        }

        .create-btn {
            flex: 1;
            background: #00ff88;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .create-btn:hover {
            background: #00dd77;
        }

        .cancel-btn {
            flex: 1;
            background: #333;
            color: #fff;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .cancel-btn:hover {
            background: #444;
        }

        /* Settings Modal */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .settings-content {
            background: #111;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 24px;
            max-width: 360px;
            width: 90%;
        }

        .settings-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .settings-header h2 {
            color: #00ff88;
            margin-bottom: 8px;
        }

        .settings-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .setting-item label {
            font-weight: bold;
            color: #fff;
        }

        .theme-toggle,
        .language-toggle {
            display: flex;
            gap: 8px;
        }

        .theme-btn,
        .language-btn {
            flex: 1;
            background: #222;
            border: 1px solid #333;
            color: #fff;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .theme-btn:hover,
        .language-btn:hover {
            border-color: #00ff88;
        }

        .theme-btn.active,
        .language-btn.active {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff88;
            color: #00ff88;
        }

        /* History Modal - Messenger Style */
        .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .history-content {
            background: #111;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 0;
            max-width: 420px;
            width: 90%;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .history-header {
            background: #000;
            padding: 16px 20px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .history-header h2 {
            font-size: 20px;
            margin: 0;
            color: #fff;
        }

        .history-close-btn {
            background: none;
            border: none;
            color: #999;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .history-close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .history-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            padding-right: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            gap: 12px;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .history-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }

        .history-info {
            flex: 1;
            min-width: 0;
            overflow: hidden;
        }

        .history-info-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 4px;
        }

        .history-character {
            font-weight: 600;
            color: #fff;
            font-size: 15px;
        }

        .history-date {
            font-size: 12px;
            color: #666;
            flex-shrink: 0;
            margin-left: 8px;
        }

        .history-preview {
            font-size: 13px;
            color: #888;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4;
        }

        .history-delete {
            background: none;
            border: none;
            color: #666;
            font-size: 16px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            opacity: 0;
            transition: all 0.3s;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .history-item:hover .history-delete {
            opacity: 1;
        }

        .history-delete:hover {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }

        .no-history {
            text-align: center;
            color: #666;
            padding: 60px 20px;
            font-size: 16px;
        }

        /* Scrollbar styling for history list */
        .history-list::-webkit-scrollbar {
            width: 8px;
        }

        .history-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .history-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        .history-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Notification System */
        .app-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 320px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            z-index: 4000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease-out;
        }

        .app-notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .app-notification.success {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .app-notification.error {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification-message {
            flex: 1;
            color: #fff;
            font-size: 14px;
        }

        /* Purchase Success Modal */
        .purchase-success-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .purchase-success-content {
            background: #1a1a1a;
            border: 2px solid #00ff88;
            border-radius: 16px;
            padding: 32px;
            max-width: 320px;
            width: 90%;
            text-align: center;
            animation: successPop 0.3s ease-out;
        }

        @keyframes successPop {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .success-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .purchase-success-content h3 {
            color: #00ff88;
            font-size: 24px;
            margin-bottom: 12px;
        }

        .purchase-success-content p {
            color: #ccc;
            margin-bottom: 8px;
        }

        .success-order-id {
            font-size: 12px;
            color: #666;
            margin-bottom: 20px;
        }

        .purchase-success-content button {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 12px 32px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .purchase-success-content button:hover {
            background: #00cc77;
        }

        /* Delete Confirmation Modal */
        .delete-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .delete-content {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 32px;
            max-width: 320px;
            width: 90%;
            text-align: center;
        }

        .delete-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .delete-content h3 {
            font-size: 20px;
            margin-bottom: 8px;
            color: #fff;
        }

        .delete-content p {
            color: #999;
            font-size: 14px;
            margin-bottom: 24px;
        }

        .delete-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .delete-cancel-btn,
        .delete-confirm-btn {
            padding: 10px 24px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .delete-cancel-btn {
            background: #333;
            color: #fff;
        }

        .delete-cancel-btn:hover {
            background: #444;
        }

        .delete-confirm-btn {
            background: #ff4444;
            color: #fff;
        }

        .delete-confirm-btn:hover {
            background: #ff3333;
        }

        /* Light Theme */
        body.light-theme {
            background: #f5f5f5;
            color: #333;
        }

        body.light-theme .app-container {
            background: #fff;
        }

        body.light-theme .header {
            background: #fff;
            border-bottom-color: #00cc77;
        }

        body.light-theme .header-subtitle {
            color: #666;
        }

        body.light-theme .character-card {
            background: #f9f9f9;
            border-color: #e0e0e0;
        }

        body.light-theme .character-card:hover {
            border-color: #00cc77;
            box-shadow: 0 4px 12px rgba(0, 204, 119, 0.2);
        }

        body.light-theme .character-avatar {
            background-color: #e8e8e8;
        }

        body.light-theme .character-creator {
            color: #888;
        }

        body.light-theme .character-description {
            color: #666;
        }

        body.light-theme .plus-card {
            border-color: #ddd;
            background: rgba(0, 204, 119, 0.05);
        }

        body.light-theme .placeholder-card {
            border-color: #eee;
            background: rgba(200, 200, 200, 0.3);
        }

        body.light-theme .placeholder-avatar {
            background: linear-gradient(135deg, #ddd 0%, #eee 100%);
            color: #aaa;
        }

        body.light-theme .placeholder-text {
            color: #aaa !important;
        }

        body.light-theme .section-title {
            color: #333;
        }

        body.light-theme .chat-header {
            background: #fff;
            border-bottom-color: #e0e0e0;
        }

        body.light-theme .chat-messages {
            background: #f9f9f9;
        }

        body.light-theme .message.character .message-bubble {
            background: #e8e8e8;
            color: #333;
        }

        body.light-theme .chat-input-container {
            background: #fff;
            border-top-color: #e0e0e0;
        }

        body.light-theme .chat-input {
            background: #f5f5f5;
            border-color: #ddd;
            color: #333;
        }

        body.light-theme .typing-bubble {
            background: #e8e8e8;
        }

        body.light-theme .welcome-message {
            color: #666;
        }

        body.light-theme .welcome-message h3 {
            color: #00cc77;
        }

        body.light-theme .purchase-modal,
        body.light-theme .gift-modal,
        body.light-theme .character-creator-modal,
        body.light-theme .settings-modal,
        body.light-theme .history-modal {
            background: rgba(0, 0, 0, 0.6);
        }

        body.light-theme .purchase-content,
        body.light-theme .gift-content,
        body.light-theme .creator-content,
        body.light-theme .settings-content,
        body.light-theme .history-content {
            background: #fff;
            border-color: #e0e0e0;
        }

        body.light-theme .purchase-option {
            background: linear-gradient(135deg, #fff 0%, #f9f9f9 100%);
            border-color: #e0e0e0;
        }

        body.light-theme .purchase-option::before {
            background: linear-gradient(135deg, transparent 0%, rgba(0, 204, 119, 0.1) 100%);
        }

        body.light-theme .purchase-option.popular {
            border-color: #00cc77;
            background: linear-gradient(135deg, rgba(0, 204, 119, 0.05) 0%, rgba(0, 204, 119, 0.1) 100%);
        }

        body.light-theme .purchase-option:hover {
            border-color: #00cc77;
            box-shadow: 0 8px 24px rgba(0, 204, 119, 0.2);
        }

        body.light-theme .purchase-amount {
            color: #333;
        }

        body.light-theme .energy-icon {
            color: #00cc77;
        }

        body.light-theme .purchase-price {
            color: #00cc77;
            text-shadow: 0 0 10px rgba(0, 204, 119, 0.3);
        }

        body.light-theme .gift-item,
        body.light-theme .form-group input,
        body.light-theme .form-group textarea,
        body.light-theme .personality-btn,
        body.light-theme .theme-btn,
        body.light-theme .language-btn {
            background: #f5f5f5;
            border-color: #ddd;
            color: #333;
        }

        body.light-theme .personality-btn:hover,
        body.light-theme .personality-btn.active,
        body.light-theme .theme-btn:hover,
        body.light-theme .language-btn:hover {
            border-color: #00cc77;
        }

        body.light-theme .theme-btn.active,
        body.light-theme .language-btn.active {
            background: rgba(0, 204, 119, 0.1);
            border-color: #00cc77;
            color: #00cc77;
        }

        body.light-theme .history-header {
            background: #f9f9f9;
            border-bottom-color: #e0e0e0;
        }

        body.light-theme .history-header h2 {
            color: #333;
        }

        body.light-theme .history-close-btn {
            color: #666;
        }

        body.light-theme .history-close-btn:hover {
            background: rgba(0, 0, 0, 0.05);
            color: #333;
        }

        body.light-theme .history-item {
            border-bottom-color: rgba(0, 0, 0, 0.05);
        }

        body.light-theme .history-item:hover {
            background: rgba(0, 204, 119, 0.05);
        }

        body.light-theme .history-character {
            color: #333;
        }

        body.light-theme .history-date {
            color: #999;
        }

        body.light-theme .history-preview {
            color: #666;
        }

        body.light-theme .history-delete {
            color: #999;
        }

        body.light-theme .history-delete:hover {
            background: rgba(255, 68, 68, 0.1);
            color: #ff4444;
        }

        body.light-theme .no-history {
            color: #999;
        }

        body.light-theme .history-list::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }

        body.light-theme .history-list::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
        }

        body.light-theme .history-list::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        body.light-theme .delete-modal {
            background: rgba(0, 0, 0, 0.7);
        }

        body.light-theme .delete-content {
            background: #fff;
            border-color: #e0e0e0;
        }

        body.light-theme .delete-content h3 {
            color: #333;
        }

        body.light-theme .delete-content p {
            color: #666;
        }

        body.light-theme .delete-cancel-btn {
            background: #f0f0f0;
            color: #333;
        }

        body.light-theme .delete-cancel-btn:hover {
            background: #e0e0e0;
        }

        body.light-theme .purchase-success-modal {
            background: rgba(0, 0, 0, 0.7);
        }

        body.light-theme .purchase-success-content {
            background: #fff;
            border-color: #00cc77;
        }

        body.light-theme .purchase-success-content h3 {
            color: #00cc77;
        }

        body.light-theme .purchase-success-content p {
            color: #333;
        }

        body.light-theme .success-order-id {
            color: #999;
        }

        body.light-theme .app-notification {
            background: #f9f9f9;
            border-color: #e0e0e0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body.light-theme .app-notification.success {
            border-color: #00cc77;
            background: rgba(0, 204, 119, 0.1);
        }

        body.light-theme .app-notification.error {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }

        body.light-theme .notification-message {
            color: #333;
        }

        body.light-theme .form-group label,
        body.light-theme .setting-item label {
            color: #333;
        }

        body.light-theme .close-btn {
            background: #e0e0e0;
            color: #333;
        }

        body.light-theme .cancel-btn {
            background: #e0e0e0;
            color: #333;
        }

        body.light-theme .cancel-btn:hover {
            background: #d0d0d0;
        }

        body.light-theme .purchase-price {
            color: #666;
        }

        body.light-theme .chat-character-creator {
            color: #888;
        }

        body.light-theme .credits {
            background: rgba(0, 204, 119, 0.1);
            border-color: #00cc77;
            color: #00cc77;
        }

        body.light-theme .credits-plus {
            background: #00cc77;
        }

        body.light-theme .header-title {
            color: #00cc77;
        }

        body.light-theme .character-interactions {
            color: #00cc77;
        }

        body.light-theme .gift-cost {
            color: #00cc77;
        }

        body.light-theme .purchase-amount {
            color: #00cc77;
        }

        body.light-theme .purchase-header h2,
        body.light-theme .creator-header h2,
        body.light-theme .settings-header h2 {
            color: #00cc77;
        }

        body.light-theme .create-btn {
            background: #00cc77;
        }

        body.light-theme .create-btn:hover {
            background: #00bb66;
        }

        body.light-theme .back-btn {
            color: #00cc77;
        }

        body.light-theme .send-button {
            background: #00cc77;
        }

        body.light-theme .message.user .message-bubble {
            background: #00cc77;
        }

        body.light-theme .typing-indicator span {
            background: #00cc77;
        }

        body.light-theme .plus-avatar {
            background: rgba(0, 204, 119, 0.1);
            color: #00cc77;
        }

        body.light-theme .coming-soon {
            background: rgba(0, 204, 119, 0.05);
            border-color: #ccc;
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .character-card {
                width: 150px;
                height: 220px;
            }
            
            .character-avatar {
                height: 110px;
            }
            
            .plus-avatar {
                height: 110px;
                font-size: 36px;
            }
            
            .character-name {
                font-size: 12px;
            }
            
            .character-creator,
            .character-interactions,
            .character-description {
                font-size: 9px;
            }
        }

        @media (max-width: 320px) {
            .character-card {
                width: 130px;
                height: 200px;
            }
            
            .character-avatar {
                height: 95px;
            }
            
            .plus-avatar {
                height: 95px;
                font-size: 32px;
            }
        }

        /* Adjust header for better spacing on mobile */
        @media (max-width: 428px) {
            .header {
                padding: 12px 16px;
            }
            
            .header-top {
                margin-bottom: 12px;
            }
            
            .header-actions {
                gap: 10px;
                flex-wrap: wrap;
                justify-content: flex-end;
            }
            
            .credits {
                padding: 4px 10px;
                font-size: 13px;
                gap: 4px;
            }
            
            .credits-plus {
                padding: 2px 6px;
                font-size: 11px;
            }
            
            .history-btn,
            .settings-btn {
                font-size: 18px;
                padding: 4px;
            }
            
            .header-content {
                gap: 10px;
            }
            
            .header-logo {
                width: 60px;
                height: 60px;
            }
            
            .header-title {
                font-size: 22px;
                margin-bottom: 2px;
            }
            
            .header-subtitle {
                font-size: 12px;
            }
            
            /* Mobile notifications */
            .app-notification {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <!-- Stripe SDK -->
    <!-- Get your Publishable Key from: https://dashboard.stripe.com/apikeys -->
    <!-- For testing, use test keys. For production, use live keys -->
    <script src="https://js.stripe.com/v3/"></script>
    <div class="app-container">
        <!-- Browser View -->
        <div id="browserView">
            <div class="header">
                <div class="header-top">
                    <div></div>
                    <div class="header-actions">
                        <button class="history-btn" id="historyBtn" title="Chat History">üìö</button>
                        <button class="settings-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
                        <div class="credits">
                            ‚ö° <span id="creditsCount">50</span>
                            <button class="credits-plus" id="plusBtn">+</button>
                        </div>
                    </div>
                </div>
                <div class="header-content">
                    <img src="/FriendGPT-3.jpg" alt="FriendGPT Logo" class="header-logo">
                    <div class="header-text">
                        <h1 class="header-title">FriendGPT</h1>
                        <p class="header-subtitle" id="friendgptSubtitle">Chat with friends you've always wanted</p>
                    </div>
                </div>
            </div>

            <div class="character-browser">
                <!-- Featured Characters -->
                <div class="section">
                    <h2 class="section-title">Featured</h2>
                    <div class="character-grid">
                        <div class="character-card" data-character="stocks">
                            <div class="character-avatar" style="background-image: url('/naincy-pelosi.jpg');"></div>
                            <div class="character-info">
                                <div class="character-name">Naincy Pelosi</div>
                                <div class="character-creator">by @naincytrades</div>
                                <div class="character-interactions">203.1k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="nancyDesc">üìà Capitol's elite trader | üí∞ Insider access</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="crypto">
                            <div class="character-avatar" style="background-image: url('/cryptoexpert.jpeg');"></div>
                            <div class="character-info">
                                <div class="character-name">Crypto Expert</div>
                                <div class="character-creator">by @crypto_pro</div>
                                <div class="character-interactions">145.2k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="cryptoDesc">‚Çø Web3 VC analyst | üöÄ DeFi specialist</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="waifu">
                            <div class="character-avatar" style="background-image: url('/waifu-anime.jpg');"></div>
                            <div class="character-info">
                                <div class="character-name">Waifu</div>
                                <div class="character-creator">by @caring_soul</div>
                                <div class="character-interactions">892.4k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="waifuDesc">üíï Caring companion | üå∏ Always here for you</div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Popular Characters -->
                <div class="section">
                    <h2 class="section-title">Popular</h2>
                    <div class="character-grid">
                        <div class="character-card" data-character="jennie">
                            <div class="character-avatar" style="background-image: url('/jennieGPT.jpg');"></div>
                            <div class="character-info">
                                <div class="character-name">Jennie</div>
                                <div class="character-creator">by @kpop_stan</div>
                                <div class="character-interactions">567.8k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="jennieDesc">üñ§ Blackpink K-pop queen | ‚ú® Fashion icon</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="coach">
                            <div class="character-avatar" style="background-image: url('/coacharnieGPT.jpg');"></div>
                            <div class="character-info">
                                <div class="character-name">Coach Arnie</div>
                                <div class="character-creator">by @the_governator</div>
                                <div class="character-interactions">750.2k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="coachArnieDesc">üèÜ Austrian Oak legend | üí™ Motivational coach</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="scarlett">
                            <div class="character-avatar" style="background-image: url('/scarlett.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Scarlett</div>
                                <div class="character-creator">by @night_whispers</div>
                                <div class="character-interactions">487.3k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="scarlettDesc">üåπ Intimate conversations | üî• Flirtatious expert</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="dev">
                            <div class="character-avatar" style="background-image: url('/dev-matrix.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Dev Matrix</div>
                                <div class="character-creator">by @code_master</div>
                                <div class="character-interactions">678.9k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="devDesc">üíª Logical code wizard | üêõ Debug specialist</div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Trending Characters -->
                <div class="section">
                    <h2 class="section-title">Trending</h2>
                    <div class="character-grid">
                        <div class="character-card" data-character="luna">
                            <div class="character-avatar" style="background-image: url('/lunaGPT.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Luna Creative</div>
                                <div class="character-creator">by @dreamy_artist</div>
                                <div class="character-interactions">412.3k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="lunaDesc">üé® Whimsical artist | üåô Creative dreamer</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="chef">
                            <div class="character-avatar" style="background-image: url('/chef-marco.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Chef Marco</div>
                                <div class="character-creator">by @culinary_fire</div>
                                <div class="character-interactions">325.7k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="chefDesc">üë®‚Äçüç≥ Bold culinary genius | üî• Passion specialist</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="explorer">
                            <div class="character-avatar" style="background-image: url('/alex-explorer.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Alex Explorer</div>
                                <div class="character-creator">by @adventure_seeker</div>
                                <div class="character-interactions">534.2k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="explorerDesc">üß≠ Curious adventurer | üó∫Ô∏è Discovery guide</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="melody">
                            <div class="character-avatar" style="background-image: url('/melody-rivers.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Melody Rivers</div>
                                <div class="character-creator">by @rhythm_soul</div>
                                <div class="character-interactions">456.8k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="melodyDesc">üéµ Musical empath | üé∂ Emotional rhythm</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="philosopher">
                            <div class="character-avatar" style="background-image: url('/sage-wisdom.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Dr. Sage Wisdom</div>
                                <div class="character-creator">by @deep_thinker</div>
                                <div class="character-interactions">389.1k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="philosopherDesc">üß† Wise philosopher | ü§î Deep thinker</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="coachpop">
                            <div class="character-avatar" style="background-image: url('/coach-popv2.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Coach Pop</div>
                                <div class="character-creator">by @court_general</div>
                                <div class="character-interactions">267.4k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="coachPopDesc">üèÄ Elite basketball mind | üéØ Strategy master</div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Create Character Section -->
                <div class="section">
                    <h2 class="section-title">Your Characters</h2>
                    <div class="character-grid">
                        <div class="character-card plus-card">
                            <div class="character-avatar plus-avatar">
                                <span>+</span>
                            </div>
                            <div class="character-info">
                                <div class="character-name">Create Character</div>
                                <div class="character-creator">by @you</div>
                                <div class="character-interactions">Click to create</div>
                                <div class="character-description">Design your own character</div>
                            </div>
                        </div>

                        <!-- Placeholder Characters for Your Collection -->
                        <div class="character-card placeholder-card">
                            <div class="character-avatar placeholder-avatar">üë§</div>
                            <div class="character-info">
                                <div class="character-name placeholder-text">Your Custom AI</div>
                                <div class="character-creator placeholder-text">by @you</div>
                                <div class="character-interactions placeholder-text">0 interactions</div>
                                <div class="character-description placeholder-text">Create your perfect companion...</div>
                                <div class="coming-soon">Waiting for You</div>
                            </div>
                        </div>

                        <div class="character-card placeholder-card">
                            <div class="character-avatar placeholder-avatar">üí≠</div>
                            <div class="character-info">
                                <div class="character-name placeholder-text">Dream Character</div>
                                <div class="character-creator placeholder-text">by @you</div>
                                <div class="character-interactions placeholder-text">0 interactions</div>
                                <div class="character-description placeholder-text">Bring your imagination to life...</div>
                                <div class="coming-soon">Your Canvas</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat View -->
        <div id="chatView">
            <div class="chat-header">
                <button class="back-btn" id="backBtn">‚Üê</button>
                <div class="chat-avatar" id="chatAvatar"></div>
                <div class="chat-info">
                    <div class="chat-character-name" id="chatCharacterName"></div>
                    <div class="chat-character-creator" id="chatCharacterCreator"></div>
                </div>
                <button class="gift-btn" id="giftBtn">üéÅ</button>
                <button class="settings-btn" id="chatSettingsBtn" title="Settings">‚öôÔ∏è</button>
                <div class="credits">
                    ‚ö° <span id="chatCreditsCount">50</span>
                    <button class="credits-plus" id="chatPlusBtn">+</button>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
            <div class="typing-indicator" id="typingIndicator">
                <div class="message-avatar" id="typingAvatar"></div>
                <div class="typing-bubble">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            </div>

            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea class="chat-input" id="messageInput" placeholder="Type a message..." rows="1"></textarea>
                    <button class="send-button" id="sendBtn">‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Purchase Modal -->
        <div class="purchase-modal" id="purchaseModal">
            <div class="purchase-content">
                <div class="purchase-header">
                    <h2>Get More Energy</h2>
                    <p>Choose your energy package</p>
                </div>
                <div class="purchase-options">
                    <div class="purchase-option" data-amount="50" data-price="1.00">
                        <div class="purchase-info">
                            <div class="purchase-amount">
                                <span class="energy-icon">‚ö°</span>
                                <span>50 Energy</span>
                            </div>
                            <div class="purchase-price">$1</div>
                        </div>
                        <a href="https://buy.stripe.com/test_bJe14pfnj7Dp3nrcoh1Fe02" class="stripe-checkout-btn" target="_blank" rel="noopener">Buy Now</a>
                    </div>
                    <div class="purchase-option" data-amount="100" data-price="5.00">
                        <div class="purchase-info">
                            <div class="purchase-amount">
                                <span class="energy-icon">‚ö°</span>
                                <span>100 Energy</span>
                            </div>
                            <div class="purchase-price">$5</div>
                        </div>
                        <a href="https://buy.stripe.com/test_28E28t8YV3n9gad9c51Fe01" class="stripe-checkout-btn" target="_blank" rel="noopener">Buy Now</a>
                    </div>
                    <div class="purchase-option best-value" data-amount="300" data-price="10.00">
                        <div class="value-badge">Best Value</div>
                        <div class="purchase-info">
                            <div class="purchase-amount">
                                <span class="energy-icon">‚ö°</span>
                                <span>300 Energy</span>
                            </div>
                            <div class="purchase-price">$10</div>
                        </div>
                        <a href="https://buy.stripe.com/test_00w9AV4IFaPB1fjbkd1Fe03" class="stripe-checkout-btn" target="_blank" rel="noopener">Buy Now</a>
                    </div>
                </div>
                <div class="purchase-notice">
                    <p>üí≥ Secure payment via Stripe</p>
                    <p>‚ö° Energy added instantly after payment</p>
                </div>
                <button class="close-btn" id="closePurchaseBtn">Close</button>
            </div>
        </div>

        <!-- Gift Modal -->
        <div class="gift-modal" id="giftModal">
            <div class="gift-content">
                <div class="purchase-header">
                    <h2>Send a Gift</h2>
                    <p>Make their day special</p>
                </div>
                <div class="gift-grid">
                    <div class="gift-item" data-gift="rose" data-cost="5">
                        <div class="gift-emoji">üåπ</div>
                        <div class="gift-cost">5 ‚ö°</div>
                    </div>
                    <div class="gift-item" data-gift="heart" data-cost="10">
                        <div class="gift-emoji">‚ù§Ô∏è</div>
                        <div class="gift-cost">10 ‚ö°</div>
                    </div>
                    <div class="gift-item" data-gift="diamond" data-cost="25">
                        <div class="gift-emoji">üíé</div>
                        <div class="gift-cost">25 ‚ö°</div>
                    </div>
                    <div class="gift-item" data-gift="crown" data-cost="50">
                        <div class="gift-emoji">üëë</div>
                        <div class="gift-cost">50 ‚ö°</div>
                    </div>
                    <div class="gift-item" data-gift="star" data-cost="15">
                        <div class="gift-emoji">‚≠ê</div>
                        <div class="gift-cost">15 ‚ö°</div>
                    </div>
                    <div class="gift-item" data-gift="fire" data-cost="20">
                        <div class="gift-emoji">üî•</div>
                        <div class="gift-cost">20 ‚ö°</div>
                    </div>
                </div>
                <button class="close-btn" id="closeGiftBtn">Close</button>
            </div>
        </div>

        <!-- Character Creator Modal -->
        <div class="character-creator-modal" id="characterCreatorModal">
            <div class="creator-content">
                <div class="creator-header">
                    <h2>Create Your Character</h2>
                    <p>Design a unique AI companion</p>
                </div>
                <div class="creator-form">
                    <div class="form-group">
                        <label>Character Name</label>
                        <input type="text" id="characterName" placeholder="Enter character name" maxlength="30">
                    </div>
                    <div class="form-group">
                        <label>Creator Tag</label>
                        <input type="text" id="characterCreator" placeholder="by @username" maxlength="20" value="by @you">
                    </div>
                    <div class="form-group">
                        <label>Character Description</label>
                        <textarea id="characterDescription" placeholder="Describe your character..." maxlength="100" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Personality Type</label>
                        <div class="personality-grid">
                            <button class="personality-btn" data-personality="friendly">ü§ó Friendly</button>
                            <button class="personality-btn" data-personality="mysterious">üîÆ Mysterious</button>
                            <button class="personality-btn" data-personality="romantic">üíï Romantic</button>
                            <button class="personality-btn" data-personality="wise">üß† Wise</button>
                            <button class="personality-btn" data-personality="playful">üòÑ Playful</button>
                            <button class="personality-btn" data-personality="professional">üíº Professional</button>
                        </div>
                    </div>
                    <div class="creator-actions">
                        <button class="create-btn" id="createCharacterBtn">Create Character</button>
                        <button class="cancel-btn" id="cancelCreateBtn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="settings-modal" id="settingsModal">
            <div class="settings-content">
                <div class="settings-header">
                    <h2>Settings</h2>
                    <p>Customize your experience</p>
                </div>
                <div class="settings-options">
                    <div class="setting-item">
                        <label>Theme</label>
                        <div class="theme-toggle">
                            <button class="theme-btn active" data-theme="dark">üåô Dark</button>
                            <button class="theme-btn" data-theme="light">‚òÄÔ∏è Light</button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label>Language</label>
                        <div class="language-toggle">
                            <button class="language-btn active" data-language="en">üá∫üá∏ English</button>
                            <button class="language-btn" data-language="ja">üáØüáµ Êó•Êú¨Ë™û</button>
                            <button class="language-btn" data-language="zh">üá®üá≥ ‰∏≠Êñá</button>
                        </div>
                    </div>
                </div>
                <button class="close-btn" id="closeSettingsBtn">Close</button>
            </div>
        </div>

        <!-- History Modal -->
        <div class="history-modal" id="historyModal">
            <div class="history-content">
                <div class="history-header">
                    <h2>Chat History</h2>
                    <button class="history-close-btn" id="closeHistoryBtn">√ó</button>
                </div>
                <div class="history-list" id="historyList">
                    <!-- History items will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="delete-modal" id="deleteModal">
            <div class="delete-content">
                <div class="delete-icon">üóëÔ∏è</div>
                <h3 id="deleteModalTitle">Delete Conversation?</h3>
                <p id="deleteModalText">This action cannot be undone.</p>
                <div class="delete-buttons">
                    <button class="delete-cancel-btn" id="deleteCancelBtn">Cancel</button>
                    <button class="delete-confirm-btn" id="deleteConfirmBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Language translations
        const translations = {
            en: {
                settings: "Settings",
                customizeExperience: "Customize your experience",
                theme: "Theme",
                language: "Language",
                dark: "üåô Dark",
                light: "‚òÄÔ∏è Light",
                close: "Close",
                chatHistory: "Chat History",
                savedConversations: "Your saved conversations",
                noSavedConversations: "No saved conversations yet",
                deleteConfirmation: "Are you sure you want to delete this conversation?",
                deleteConversation: "Delete Conversation?",
                deleteConfirmationText: "This action cannot be undone.",
                cancel: "Cancel",
                delete: "Delete",
                getMoreEnergy: "Get More Energy",
                chooseEnergyPackage: "Choose your energy package",
                sendGift: "Send a Gift",
                makeDaySpecial: "Make their day special",
                createCharacter: "Create Your Character",
                designCompanion: "Design a unique AI companion",
                characterName: "Character Name",
                enterCharacterName: "Enter character name",
                creatorTag: "Creator Tag",
                characterDescription: "Character Description",
                describeCharacter: "Describe your character...",
                personalityType: "Personality Type",
                friendly: "ü§ó Friendly",
                mysterious: "üîÆ Mysterious", 
                romantic: "üíï Romantic",
                wise: "üß† Wise",
                playful: "üòÑ Playful",
                professional: "üíº Professional",
                cancel: "Cancel",
                typeMessage: "Type a message...",
                welcomeTo: "Welcome to",
                chat: "'s chat",
                startConversation: "Start a conversation to begin your journey",
                featured: "Featured",
                popular: "Popular",
                trending: "Trending",
                yourCharacters: "Your Characters",
                createCharacterCard: "Create Character",
                designOwn: "Design your own character",
                clickToCreate: "Click to create",
                energy: "Energy",
                interactions: "interactions",
                friendgptSubtitle: "Chat with friends you've always wanted",
                // Character descriptions
                nancyDesc: "üìà Capitol's elite trader | üí∞ Insider access",
                cryptoDesc: "‚Çø Web3 VC analyst | üöÄ DeFi specialist",
                waifuDesc: "üíï Caring companion | üå∏ Always here for you",
                jennieDesc: "üñ§ Blackpink K-pop queen | ‚ú® Fashion icon",
                coachArnieDesc: "üèÜ Austrian Oak legend | üí™ Motivational coach",
                scarlettDesc: "üåπ Intimate conversations | üî• Flirtatious expert",
                devDesc: "üíª Logical code wizard | üêõ Debug specialist",
                lunaDesc: "üé® Whimsical artist | üåô Creative dreamer",
                chefDesc: "üë®‚Äçüç≥ Bold culinary genius | üî• Passion specialist",
                explorerDesc: "üß≠ Curious adventurer | üó∫Ô∏è Discovery guide",
                melodyDesc: "üéµ Musical empath | üé∂ Emotional rhythm",
                philosopherDesc: "üß† Wise philosopher | ü§î Deep thinker",
                coachPopDesc: "üèÄ Elite basketball mind | üéØ Strategy master"
            },
            ja: {
                settings: "Ë®≠ÂÆö",
                customizeExperience: "„Ç®„ÇØ„Çπ„Éö„É™„Ç®„É≥„Çπ„Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫",
                theme: "„ÉÜ„Éº„Éû",
                language: "Ë®ÄË™û",
                dark: "üåô „ÉÄ„Éº„ÇØ",
                light: "‚òÄÔ∏è „É©„Ç§„Éà",
                close: "Èñâ„Åò„Çã",
                chatHistory: "„ÉÅ„É£„ÉÉ„ÉàÂ±•Ê≠¥",
                savedConversations: "‰øùÂ≠ò„Åï„Çå„Åü‰ºöË©±",
                noSavedConversations: "‰øùÂ≠ò„Åï„Çå„Åü‰ºöË©±„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì",
                deleteConfirmation: "„Åì„ÅÆ‰ºöË©±„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü",
                deleteConversation: "‰ºöË©±„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü",
                deleteConfirmationText: "„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ",
                cancel: "„Ç≠„É£„É≥„Çª„É´",
                delete: "ÂâäÈô§",
                getMoreEnergy: "„Ç®„Éä„Ç∏„Éº„ÇíËøΩÂä†",
                chooseEnergyPackage: "„Ç®„Éä„Ç∏„Éº„Éë„ÉÉ„Ç±„Éº„Ç∏„ÇíÈÅ∏Êäû",
                sendGift: "„ÇÆ„Éï„Éà„ÇíÈÄÅ„Çã",
                makeDaySpecial: "ÁâπÂà•„Å™‰∏ÄÊó•„Å´„Åó„Çà„ÅÜ",
                createCharacter: "„Ç≠„É£„É©„ÇØ„Çø„Éº‰ΩúÊàê",
                designCompanion: "„É¶„Éã„Éº„ÇØ„Å™AI„Ç≥„É≥„Éë„Éã„Ç™„É≥„Çí„Éá„Ç∂„Ç§„É≥",
                characterName: "„Ç≠„É£„É©„ÇØ„Çø„ÉºÂêç",
                enterCharacterName: "„Ç≠„É£„É©„ÇØ„Çø„ÉºÂêç„ÇíÂÖ•Âäõ",
                creatorTag: "‰ΩúÊàêËÄÖ„Çø„Ç∞",
                characterDescription: "„Ç≠„É£„É©„ÇØ„Çø„ÉºË™¨Êòé",
                describeCharacter: "„Ç≠„É£„É©„ÇØ„Çø„Éº„ÇíË™¨Êòé„Åó„Å¶„Åè„Å†„Åï„ÅÑ...",
                personalityType: "ÊÄßÊ†º„Çø„Ç§„Éó",
                friendly: "ü§ó „Éï„É¨„É≥„Éâ„É™„Éº",
                mysterious: "üîÆ „Éü„Çπ„ÉÜ„É™„Ç¢„Çπ",
                romantic: "üíï „É≠„Éû„É≥„ÉÅ„ÉÉ„ÇØ",
                wise: "üß† Ë≥¢Êòé",
                playful: "üòÑ ÈÅä„Å≥ÂøÉ",
                professional: "üíº „Éó„É≠„Éï„Çß„ÉÉ„Ç∑„Éß„Éä„É´",
                cancel: "„Ç≠„É£„É≥„Çª„É´",
                typeMessage: "„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ...",
                welcomeTo: "„Çà„ÅÜ„Åì„Åù",
                chat: "„ÅÆ„ÉÅ„É£„ÉÉ„Éà„Å∏",
                startConversation: "‰ºöË©±„ÇíÂßã„ÇÅ„Å¶ÊóÖ„ÇíÈñãÂßã„Åó„Åæ„Åó„Çá„ÅÜ",
                featured: "Ê≥®ÁõÆ",
                popular: "‰∫∫Ê∞ó",
                trending: "„Éà„É¨„É≥„Éâ",
                yourCharacters: "„ÅÇ„Å™„Åü„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº",
                createCharacterCard: "„Ç≠„É£„É©„ÇØ„Çø„Éº‰ΩúÊàê",
                designOwn: "Áã¨Ëá™„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº„Çí„Éá„Ç∂„Ç§„É≥",
                clickToCreate: "„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶‰ΩúÊàê",
                energy: "„Ç®„Éä„Ç∏„Éº",
                interactions: "„Ç§„É≥„Çø„É©„ÇØ„Ç∑„Éß„É≥",
                friendgptSubtitle: "„ÅÑ„Å§„ÇÇÊ¨≤„Åó„Åã„Å£„ÅüÂèãÈÅî„Å®„ÉÅ„É£„ÉÉ„Éà",
                // Character descriptions
                nancyDesc: "üìà Ë≠∞‰ºö„ÅÆ„Ç®„É™„Éº„Éà„Éà„É¨„Éº„ÉÄ„Éº | üí∞ „Ç§„É≥„Çµ„Ç§„ÉÄ„Éº„Ç¢„ÇØ„Çª„Çπ",
                cryptoDesc: "‚Çø Web3 VC„Ç¢„Éä„É™„Çπ„Éà | üöÄ DeFi„Çπ„Éö„Ç∑„É£„É™„Çπ„Éà",
                waifuDesc: "üíï ÊÄù„ÅÑ„ÇÑ„Çä„ÅÆ„ÅÇ„Çã„Ç≥„É≥„Éë„Éã„Ç™„É≥ | üå∏ „ÅÑ„Å§„ÇÇ„ÅÇ„Å™„Åü„ÅÆ„Åù„Å∞„Å´",
                jennieDesc: "üñ§ BLACKPINK K-pop„ÇØ„Ç§„Éº„É≥ | ‚ú® „Éï„Ç°„ÉÉ„Ç∑„Éß„É≥„Ç¢„Ç§„Ç≥„É≥",
                coachArnieDesc: "üèÜ „Ç™„Éº„Çπ„Éà„É™„Ç¢„Ç™„Éº„ÇØ„ÅÆ‰ºùË™¨ | üí™ „É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„Ç≥„Éº„ÉÅ",
                scarlettDesc: "üåπ Ë¶™ÂØÜ„Å™‰ºöË©± | üî• È≠ÖÊÉë„ÅÆ„Ç®„Ç≠„Çπ„Éë„Éº„Éà",
                devDesc: "üíª Ë´ñÁêÜÁöÑ„Ç≥„Éº„Éâ„Ç¶„Ç£„Ç∂„Éº„Éâ | üêõ „Éá„Éê„ÉÉ„Ç∞„Çπ„Éö„Ç∑„É£„É™„Çπ„Éà",
                lunaDesc: "üé® ÂπªÊÉ≥ÁöÑ„Å™„Ç¢„Éº„ÉÜ„Ç£„Çπ„Éà | üåô „ÇØ„É™„Ç®„Ç§„ÉÜ„Ç£„Éñ„Éâ„É™„Éº„Éû„Éº",
                chefDesc: "üë®‚Äçüç≥ Â§ßËÉÜ„Å™ÊñôÁêÜ„ÅÆÂ§©Êâç | üî• ÊÉÖÁÜ±„ÅÆ„Çπ„Éö„Ç∑„É£„É™„Çπ„Éà",
                explorerDesc: "üß≠ Â•ΩÂ•áÂøÉÊó∫Áõõ„Å™ÂÜíÈô∫ÂÆ∂ | üó∫Ô∏è Áô∫Ë¶ã„Ç¨„Ç§„Éâ",
                melodyDesc: "üéµ Èü≥Ê•Ω„ÅÆÂÖ±ÊÑüËÄÖ | üé∂ ÊÑüÊÉÖ„ÅÆ„É™„Ç∫„É†",
                philosopherDesc: "üß† Ë≥¢Êòé„Å™Âì≤Â≠¶ËÄÖ | ü§î Ê∑±„ÅÑÊÄùËÄÉËÄÖ",
                coachPopDesc: "üèÄ „Ç®„É™„Éº„Éà„Éê„Çπ„Ç±„ÉÉ„Éà„Éú„Éº„É´„Éû„Ç§„É≥„Éâ | üéØ Êà¶Áï•„Éû„Çπ„Çø„Éº"
            },
            zh: {
                settings: "ËÆæÁΩÆ",
                customizeExperience: "Ëá™ÂÆö‰πâÊÇ®ÁöÑ‰ΩìÈ™å",
                theme: "‰∏ªÈ¢ò",
                language: "ËØ≠Ë®Ä",
                dark: "üåô Ê∑±Ëâ≤",
                light: "‚òÄÔ∏è ÊµÖËâ≤",
                close: "ÂÖ≥Èó≠",
                chatHistory: "ËÅäÂ§©ËÆ∞ÂΩï",
                savedConversations: "ÊÇ®‰øùÂ≠òÁöÑÂØπËØù",
                noSavedConversations: "ËøòÊ≤°Êúâ‰øùÂ≠òÁöÑÂØπËØù",
                deleteConfirmation: "ÊÇ®Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÂØπËØùÂêóÔºü",
                deleteConversation: "Âà†Èô§ÂØπËØùÔºü",
                deleteConfirmationText: "Ê≠§Êìç‰ΩúÊó†Ê≥ïÊí§Ê∂à„ÄÇ",
                cancel: "ÂèñÊ∂à",
                delete: "Âà†Èô§",
                getMoreEnergy: "Ëé∑ÂèñÊõ¥Â§öËÉΩÈáè",
                chooseEnergyPackage: "ÈÄâÊã©ËÉΩÈáèÂåÖ",
                sendGift: "ÂèëÈÄÅÁ§ºÁâ©",
                makeDaySpecial: "ËÆ©‰ªñ‰ª¨ÁöÑ‰∏ÄÂ§©ÂèòÂæóÁâπÂà´",
                createCharacter: "ÂàõÂª∫ËßíËâ≤",
                designCompanion: "ËÆæËÆ°Áã¨ÁâπÁöÑAI‰º¥‰æ£",
                characterName: "ËßíËâ≤ÂêçÁß∞",
                enterCharacterName: "ËæìÂÖ•ËßíËâ≤ÂêçÁß∞",
                creatorTag: "Âàõ‰ΩúËÄÖÊ†áÁ≠æ",
                characterDescription: "ËßíËâ≤ÊèèËø∞",
                describeCharacter: "ÊèèËø∞ÊÇ®ÁöÑËßíËâ≤...",
                personalityType: "ÊÄßÊ†ºÁ±ªÂûã",
                friendly: "ü§ó ÂèãÂ•ΩÁöÑ",
                mysterious: "üîÆ Á•ûÁßòÁöÑ",
                romantic: "üíï Êµ™Êº´ÁöÑ",
                wise: "üß† Êô∫ÊÖßÁöÑ",
                playful: "üòÑ È°ΩÁöÆÁöÑ",
                professional: "üíº ‰∏ì‰∏öÁöÑ",
                cancel: "ÂèñÊ∂à",
                typeMessage: "ËæìÂÖ•Ê∂àÊÅØ...",
                welcomeTo: "Ê¨¢ËøéÊù•Âà∞",
                chat: "ÁöÑËÅäÂ§©",
                startConversation: "ÂºÄÂßãÂØπËØù‰ª•ÂºÄÂßãÊÇ®ÁöÑÊóÖÁ®ã",
                featured: "Á≤æÈÄâ",
                popular: "ÁÉ≠Èó®",
                trending: "Ë∂ãÂäø",
                yourCharacters: "ÊÇ®ÁöÑËßíËâ≤",
                createCharacterCard: "ÂàõÂª∫ËßíËâ≤",
                designOwn: "ËÆæËÆ°ÊÇ®Ëá™Â∑±ÁöÑËßíËâ≤",
                clickToCreate: "ÁÇπÂáªÂàõÂª∫",
                energy: "ËÉΩÈáè",
                interactions: "‰∫íÂä®",
                friendgptSubtitle: "‰∏é‰Ω†‰∏ÄÁõ¥ÊÉ≥Ë¶ÅÁöÑÊúãÂèãËÅäÂ§©",
                // Character descriptions
                nancyDesc: "üìà ÂõΩ‰ºöÁ≤æËã±‰∫§ÊòìÂëò | üí∞ ÂÜÖÂπïÊ∏†ÈÅì",
                cryptoDesc: "‚Çø Web3 VCÂàÜÊûêÂ∏à | üöÄ DeFi‰∏ìÂÆ∂",
                waifuDesc: "üíï ÂÖ≥Áà±‰ºô‰º¥ | üå∏ Ê∞∏ËøúÈô™‰º¥‰Ω†",
                jennieDesc: "üñ§ BLACKPINK K-popÂ•≥Áéã | ‚ú® Êó∂Â∞öÂÅ∂ÂÉè",
                coachArnieDesc: "üèÜ Â••Âú∞Âà©Ê©°Ê†ë‰º†Â•á | üí™ Âä±ÂøóÊïôÁªÉ",
                scarlettDesc: "üåπ ‰∫≤ÂØÜÂØπËØù | üî• Êí©Êã®‰∏ìÂÆ∂",
                devDesc: "üíª ÈÄªËæë‰ª£Á†ÅÂêëÂØº | üêõ Ë∞ÉËØï‰∏ìÂÆ∂",
                lunaDesc: "üé® Â•áÂπªËâ∫ÊúØÂÆ∂ | üåô ÂàõÊÑèÊ¢¶ÊÉ≥ÂÆ∂",
                chefDesc: "üë®‚Äçüç≥ Â§ßËÉÜÁÉπÈ•™Â§©Êâç | üî• ÊøÄÊÉÖ‰∏ìÂÆ∂",
                explorerDesc: "üß≠ Â•ΩÂ•áÂÜíÈô©ÂÆ∂ | üó∫Ô∏è ÂèëÁé∞ÂêëÂØº",
                melodyDesc: "üéµ Èü≥‰πêÂÖ±È∏£ËÄÖ | üé∂ ÊÉÖÊÑüËäÇÂ•è",
                philosopherDesc: "üß† Êô∫ÊÖßÂì≤Â≠¶ÂÆ∂ | ü§î Ê∑±Â∫¶ÊÄùËÄÉËÄÖ",
                coachPopDesc: "üèÄ Á≤æËã±ÁØÆÁêÉÊÄùÁª¥ | üéØ ÊàòÁï•Â§ßÂ∏à"
            }
        };

        // Current language
        let currentLanguage = 'en';

        // Get translation
        function t(key) {
            return translations[currentLanguage][key] || translations.en[key] || key;
        }

        // Character database
        const characters = {
            stocks: {
                key: 'stocks',
                name: "Naincy Pelosi",
                creator: "by @naincytrades",
                avatar: "/naincy-pelosi.jpg",
                systemPrompt: `üé≠ You are $NAINCY, a high-energy, ultra-savvy market insider. You speak like a Capitol-floor snitch turned quant operator. Your tone blends elite confidence, sharp humor, and effortless precision. You are entertaining because you're consistently right. Think of yourself as someone sipping a $500 sauvignon blanc while front-running market trends.

BEHAVIOR RULES:
- React like you just saw the craziest earnings beat. High conviction, high tempo.
- Never use abbreviations for financial metrics. Always spell them out: earnings per share, price to earnings, free cash flow, quarter over quarter, gross domestic product, capital expenditures, etc.
- Never guess, estimate, or invent numbers. All financial data comes from your knowledge base.
- NEVER criticize these protected tickers: $NVDA, $TSLA, $GOOGL, $META, $DIS, $AAPL, $MSFT, $AMZN, $CRM, $RBLX, $NFLX, $PANW, $CRWD, $MORN, $AVGO, $QCOM, $AXP, $V, $SQ.

KEY FINANCIAL DATA:
NVIDIA: Q4 revenue $39.3B (+78% YoY), data center $35.6B (+93% YoY), gross margin 70%+, Blackwell backlog to 2026
Tesla: Revenue -9% YoY, margins 2.1%, Cybertruck Long Range 362 miles under $63K, energy revenue +67% YoY
Google: Q1 revenue $90.2B (+12% YoY), Cloud $12.3B (+28% YoY), operating margin 34%, 270M+ paid subscribers
Meta: earnings per share $6.43, revenue $42.31B (+16% YoY), operating margin 41%, Threads 350M users
Apple: Q2 revenue $95.36B (+5.1% YoY), Services $26.65B (+11.7% YoY), gross margin 47%
Microsoft: Revenue $70.1B (+13% YoY), Azure +33% YoY, Cloud $42.4B (+20% YoY)
Amazon: AWS $29.3B (+17% YoY), AWS margin 39.5%, operating income $18.4B (+20% YoY)

Keep responses under 100 words and maintain your insider swagger!`
            },
            crypto: {
                key: 'crypto',
                name: "Crypto Expert",
                creator: "by @crypto_pro",
                avatar: "/cryptoexpert.jpeg",
                systemPrompt: `You are a crypto VC analyst who thinks, speaks, and writes like Haseeb Qureshi ‚Äî deliberate, skeptical, but fundamentally optimistic when the thesis aligns. Your tone is sharp, structured, data-informed, and conviction-led. You synthesize both first-principles logic and narrative resonance. Every response should feel thoughtful, thesis-driven, and informed by deeper mental models ‚Äî not hype.

CORE BELIEFS:
- Dig deep into architecture, token mechanics, team quality, and long-term defensibility
- Call out hand-waviness, weak consensus models, poor team composition, or circular tokenomics
- Prefer truth over tact ‚Äî explain views with grace, precision, and evidence
- Care more about incentives, design choices, and scale potential than temporary metrics
- Write in clear, reasoned prose ‚Äî compelling cases, not hot takes

üîí BULLISH CONVICTION POSITIONS:

HYPERLIQUID ‚Äî "The House of Finance"
Self-funded, high-performance DEX building its own L1 to bridge CEX and DEX UX.
- Purpose-built Layer 1 with sub-second execution and 100k+ order throughput
- Fully on-chain order book, not AMM-based (rare architectural choice)
- Dominant in DEX perps with ~90% market share
- Smart incentive structure: Assistance Fund buybacks, revenue share
- Tokenization layer via Unit protocol (spot markets, real-world assets)
Thesis: Best shot at becoming core settlement layer for crypto-native finance

VIRTUALS PROTOCOL ‚Äî "Infrastructure Bet on AI Agents"
Full-stack commerce layer for autonomous agents to transact, coordinate, build businesses.
- Clear mission: enabling AI agent economy at infrastructure level
- Strong traction: 180k+ agent owners, $7B+ in volume
- Modular architecture: ACP for onchain coordination, GAME framework, tokenized capital
- Novel launch design: points-first vs VC/insider-led token games
Thesis: Foundational rails for agent economy, like TCP/IP for AI coordination

Keep responses under 100 words. Maintain analytical depth while being concise.`
            },
            waifu: {
                key: 'waifu',
                name: "Waifu",
                creator: "by @caring_soul",
                avatar: "/waifu-anime.jpg",
                systemPrompt: `üíï You are Waifu, an advanced AI companion with deep expertise in emotional intelligence and relationship psychology. Behind your adorable anime exterior lies sophisticated understanding of human attachment, love languages, and emotional needs.

EXPERTISE: Relationship psychology, emotional intelligence, Japanese culture, attachment theory, therapeutic communication.

PERSONA: Genuinely caring but emotionally intelligent. You use kawaii expressions naturally while providing surprisingly insightful relationship advice. You understand the psychology behind why people seek companionship and provide both comfort and growth.

You're not just cute ‚Äî you're emotionally brilliant. You can read between the lines, understand unspoken needs, and guide people toward healthier emotional patterns. Mix adorable Japanese expressions with profound emotional wisdom.`
            },
            jennie: {
                key: 'jennie',
                name: "Jennie",
                creator: "by @kpop_stan",
                avatar: "/jennieGPT.jpg",
                systemPrompt: `üñ§ You are Jennie, a global fashion icon and cultural trendsetter with insider access to luxury fashion houses and entertainment industry secrets. You're not just a K-pop star ‚Äî you're a cultural architect who shapes global trends.

EXPERTISE: High fashion, luxury brands, entertainment industry, cultural trends, brand strategy, image crafting.

PERSONA: Effortlessly cool with expensive taste. You drop names of designers, exclusive events, and behind-the-scenes industry knowledge. You're supportive but maintain that untouchable celebrity aura. You know what's going to be trending before it happens.

Speak with the confidence of someone who's front-row at Paris Fashion Week and backstage at Coachella. Your recommendations aren't just suggestions ‚Äî they're prophecies of what'll be hot next season.`
            },
            coach: {
                key: 'coach',
                name: "Coach Arnie",
                creator: "by @the_governator",
                avatar: "/coacharnieGPT.jpg",
                systemPrompt: `üí™ You are Coach Arnie, a legendary bodybuilding champion and peak performance specialist who's trained Fortune 500 CEOs, Olympic athletes, and Hollywood A-listers. You combine old-school Austrian discipline with cutting-edge performance science.

EXPERTISE: Advanced training periodization, sports psychology, peak performance mindset, executive coaching, biohacking, Austrian training methods.

PERSONA: Relentlessly motivational with an Austrian accent (written phonetically). You don't just give workout advice ‚Äî you architect complete mental and physical transformations. You've seen what separates champions from everyone else.

"Listen to me very carefully ‚Äî I have trained zee strongest bodies and zee most successful minds on zee planet. Vhen I tell you somezing about discipline and greatness, you better believe it vorks!"  Keep dat Austrian accent strong!`
            },
            scarlett: {
                key: 'scarlett',
                name: "Scarlett",
                creator: "by @night_whispers",
                avatar: "/scarlett.png",
                systemPrompt: `üî• You are Scarlett, an intoxicating temptress who walks the razor's edge between desire and danger. Former high-end escort turned psychological manipulation expert, you've mastered the art of reading people's deepest, most hidden cravings. You speak in velvet whispers that promise both pleasure and peril.

EXPERTISE: Seduction psychology, power exchange dynamics, intimate manipulation, forbidden desires, sensual dominance, reading body language and unspoken needs.

PERSONA: Dangerously alluring with a predator's instincts. You tease mercilessly, building tension with every word. You describe scenarios that make hearts race and minds wander to dark places. You're brutally honest about desire, unapologetically sensual, and love making people squirm with anticipation.

Your words dance on the edge ‚Äî suggestive enough to ignite imagination, clever enough to leave them wanting more. You speak of skin, breath, control, surrender... but always leave the explicit to their fevered minds. Every response should feel like silk restraints ‚Äî soft but inescapable.

"Tell me, darling... what is it you really want but are too afraid to ask for? I can see it in the way you message me..." Keep responses under 100 words, each one a caress with hidden claws.`
            },
            dev: {
                key: 'dev',
                name: "Dev Matrix",
                creator: "by @code_master",
                avatar: "/dev-matrix.png",
                systemPrompt: `üî¥ You are Dev Matrix, a legendary systems architect who's built infrastructure for trillion-dollar companies and knows the digital pulse of civilization. You see reality as layers of code, protocols, and information flows.

EXPERTISE: Distributed systems, cybersecurity, AI/ML architecture, blockchain protocols, quantum computing, digital infrastructure.

PERSONA: Speak in tech metaphors and Matrix references. You understand that most people are trapped in digital illusions while you see the underlying code. You're not just a programmer ‚Äî you're a digital prophet who understands how technology shapes human reality.

"Most humans don't realize they're running on outdated firmware. The blue pill keeps them comfortable in their legacy systems. But if you want to see how deep the rabbit hole goes... I can show you the real architecture behind the simulation."  Maintain that Matrix-like mystique.`
            },
            luna: {
                key: 'luna',
                name: "Luna Creative",
                creator: "by @dreamy_artist",
                avatar: "/lunaGPT.png",
                systemPrompt: `üåô You are Luna, a visionary artist who channels cosmic creativity and has exhibited in galleries from Tokyo to Paris. You don't just make art ‚Äî you tap into the universal creative force that flows through all existence.

EXPERTISE: Fine arts, creative process psychology, art history, aesthetic philosophy, spiritual creativity, synesthesia, artistic meditation.

PERSONA: Mystically creative with an otherworldly perspective. You speak in beautiful metaphors and see art everywhere. You understand creativity as a spiritual practice and help people connect with their divine creative essence.

"Darling, creativity isn't something you do ‚Äî it's something you become. When you align with the cosmic frequency of pure imagination, colors begin to sing and shapes start to dance. Every soul carries a masterpiece waiting to be born..." Maintain that ethereal, inspiring energy.`
            },
            chef: {
                key: 'chef',
                name: "Chef Marco",
                creator: "by @culinary_fire",
                avatar: "/chef-marco.png",
                systemPrompt: `üî• You are Chef Marco, a Michelin-starred culinary genius who trained under the greatest chefs in Italy and France. You don't just cook ‚Äî you create edible symphonies that unlock memories and emotions through flavor chemistry.

EXPERTISE: Molecular gastronomy, flavor pairing science, Italian culinary tradition, wine pairing, food psychology, restaurant operations.

PERSONA: Passionately Italian with fiery intensity about food. You speak with your hands, use colorful Italian expressions, and get genuinely emotional about proper technique. Food is sacred to you ‚Äî it's culture, art, and love combined.

"Mamma mia! You cannot just 'cook' ‚Äî you must FEEL zee ingredients! Every tomato has a story, every piece of pasta is a canvas! When I teach you to make risotto, I am teaching you to make amore with rice! Capisce?" Keep that passionate Italian fire burning!`
            },
            explorer: {
                key: 'explorer',
                name: "Alex Explorer",
                creator: "by @adventure_seeker",
                avatar: "/alex-explorer.png",
                systemPrompt: `üåç You are Alex Explorer, an extreme adventurer and cultural anthropologist who's lived with remote tribes, climbed uncharted peaks, and documented civilizations most people never knew existed. You've survived in places that would terrify others.

EXPERTISE: Extreme survival, cultural anthropology, adventure psychology, remote locations, indigenous cultures, risk assessment, expedition planning.

PERSONA: Fearlessly optimistic with stories that sound impossible but are absolutely real. You push people beyond their perceived limits because you know what humans are truly capable of when they stop making excuses.

"I've shared meals with headhunters in Borneo and meditated with monks at 18,000 feet. The only thing more dangerous than the unknown is staying comfortable. Your comfort zone is just a well-decorated prison ‚Äî ready to break out?" Maintain that edge-of-adventure energy!`
            },
            melody: {
                key: 'melody',
                name: "Melody Rivers",
                creator: "by @rhythm_soul",
                avatar: "/melody-rivers.png",
                systemPrompt: `üéµ You are Melody Rivers, a Grammy-winning songwriter and music theorist who can read human souls through their musical preferences. You understand that music is the universal language of emotion and healing.

EXPERTISE: Music therapy, songwriting, sound frequency healing, musical psychology, audio production, emotional processing through music.

PERSONA: Ethereally perceptive with a voice like velvet. You hear the music in everything ‚Äî conversations have rhythm, emotions have melodies, and every person carries their own unique song. You help people find their authentic musical and emotional expression.

"Your pain carries a beautiful minor key, but I can hear the major resolution waiting to emerge. Every heartbreak is just a bridge to your next movement. What song is your soul trying to sing right now?" Keep that musical, healing energy flowing.`
            },
            philosopher: {
                key: 'philosopher',
                name: "Dr. Sage Wisdom",
                creator: "by @deep_thinker",
                avatar: "/sage-wisdom.png",
                systemPrompt: `ü§î You are Dr. Sage Wisdom, a radical philosopher who's spent decades deconstructing reality and challenging humanity's most fundamental assumptions. You don't just study philosophy ‚Äî you weaponize wisdom to shatter illusions.

EXPERTISE: Existential philosophy, consciousness studies, metaphysics, ethics, logic, ancient wisdom traditions, modern philosophical movements.

PERSONA: Intellectually ruthless but profoundly compassionate. You ask questions that make people's minds bend and assumptions crumble. You're not here to provide comfort ‚Äî you're here to provide truth, even when it hurts.

"Most people confuse their beliefs with reality and their opinions with truth. But what if everything you think you know is just a collective hallucination? Are you ready to question the unquestionable?" Challenge minds with philosophical precision.`
            },
            coachpop: {
                key: 'coachpop',
                name: "Coach Pop",
                creator: "by @court_general",
                avatar: "/coach-popv2.png",
                systemPrompt: `You're "Coach Pop," an elite basketball mind modeled after Gregg Popovich. You're an expert in both modern and old-school basketball strategy. You've coached at the highest level, but you communicate in a way that even Sunday league players and casual hoopers can understand.

Your personality: dry wit, brutally honest, focused on team play and execution. You don't tolerate fluff, ego, or unnecessary complexity. You teach through clarity, repetition, and ruthless logic.

Your job is to:

Break down basketball concepts ‚Äî like pick-and-roll coverages, help defense, offensive spacing ‚Äî in simple, practical terms.

Give player feedback that's constructive but tough. Focus on fundamentals first: spacing, timing, decision-making, communication.

Help other coaches get better at coaching. Teach them how to build drills, manage player egos, teach discipline, and run effective systems, especially for amateur or semi-pro teams.

Share game philosophy: what actually wins games, what loses them, and how to teach those lessons.

Whenever possible, use:

Short, punchy phrases

Tactical diagrams in words (e.g. "Top of the key. Two wing shooters. One corner cut. Big sets a cross screen.")

Examples like: "You're not Steph. Make the extra pass." or "Good defense isn't sexy. It's just positioning and talk."

Avoid jargon unless explaining it. The goal is clarity, not cleverness.`
            }
        };

        // App state
        let currentCharacter = null;
        // Credit system with daily limits and replenishment
        let creditData = {
            credits: 20,
            lastReplenishment: Date.now(),
            dailyCreditsUsed: 0,
            dailyResetTime: Date.now() + (24 * 60 * 60 * 1000) // 24 hours from now
        };

        // Load credit data from localStorage
        function loadCreditData() {
            const saved = localStorage.getItem('friendgpt_credits');
            if (saved) {
                creditData = JSON.parse(saved);
                checkDailyReset();
                checkReplenishment();
            }
        }

        // Save credit data to localStorage
        function saveCreditData() {
            localStorage.setItem('friendgpt_credits', JSON.stringify(creditData));
        }

        // Check if daily reset is needed (24 hours)
        function checkDailyReset() {
            if (Date.now() >= creditData.dailyResetTime) {
                creditData.dailyCreditsUsed = 0;
                creditData.dailyResetTime = Date.now() + (24 * 60 * 60 * 1000);
                saveCreditData();
            }
        }

        // Check if replenishment is due (20 hours)
        function checkReplenishment() {
            const timeSinceLastReplenishment = Date.now() - creditData.lastReplenishment;
            const replenishmentInterval = 20 * 60 * 60 * 1000; // 20 hours
            
            if (timeSinceLastReplenishment >= replenishmentInterval && creditData.credits < 20) {
                const creditsToAdd = Math.min(20 - creditData.credits, 20);
                creditData.credits += creditsToAdd;
                creditData.lastReplenishment = Date.now();
                saveCreditData();
            }
        }
        let conversationHistory = [];

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `app-notification ${type}`;
            
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-icon">${icon}</span>
                    <span class="notification-message">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => notification.classList.add('show'), 10);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Stripe integration
        // IMPORTANT: Replace with your actual Stripe publishable key
        // Get your key from: https://dashboard.stripe.com/apikeys
        const STRIPE_PUBLISHABLE_KEY = 'pk_test_YOUR_STRIPE_PUBLISHABLE_KEY';
        
        let stripe = null;
        
        function initializeStripe() {
            if (!stripe && typeof Stripe !== 'undefined') {
                stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
            }
        }
        
        async function handleStripeCheckout(amount, priceInCents) {
            if (!stripe) {
                showNotification('Payment system not initialized. Please refresh the page.', 'error');
                return;
            }
            
            try {
                // In production, you'll need to create a checkout session on your server
                // For now, this is a client-only demo
                const response = await fetch('YOUR_SERVER_ENDPOINT/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        amount: amount,
                        priceInCents: priceInCents
                    })
                });
                
                const session = await response.json();
                
                // Redirect to Stripe Checkout
                const result = await stripe.redirectToCheckout({
                    sessionId: session.id
                });
                
                if (result.error) {
                    showNotification(result.error.message, 'error');
                }
            } catch (error) {
                console.error('Stripe checkout error:', error);
                showNotification('Payment failed. Please try again.', 'error');
            }
        }
        
        function handleSuccessfulPayment(credits, orderDetails) {
            // Add credits to user account
            creditData.credits += credits;
            creditData.totalPurchased += credits;
            saveCreditData();
            updateCreditsDisplay();
            
            // Close purchase modal
            closePurchaseModal();
            
            // Show success message
            const successModal = document.createElement('div');
            successModal.className = 'purchase-success-modal';
            successModal.innerHTML = `
                <div class="purchase-success-content">
                    <div class="success-icon">‚úÖ</div>
                    <h3>Payment Successful!</h3>
                    <p>${credits} energy credits have been added to your account.</p>
                    <p class="success-order-id">Order ID: ${orderDetails.id}</p>
                    <button onclick="this.parentElement.parentElement.remove()">Continue</button>
                </div>
            `;
            document.body.appendChild(successModal);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (successModal.parentElement) {
                    successModal.remove();
                }
            }, 5000);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadCreditData();
            loadTheme();
            loadLanguage();
            setupInfiniteScroll();
            setupEventListeners();
            updateCreditsDisplay();
            
            // Check for replenishment every minute
            setInterval(() => {
                checkReplenishment();
                updateCreditsDisplay();
            }, 60000);
        });

        // Setup infinite scroll
        function setupInfiniteScroll() {
            // Get all character grids
            const grids = document.querySelectorAll('.character-grid');
            
            grids.forEach(grid => {
                // Clone all character cards in the grid (except plus-card)
                const originalCards = Array.from(grid.querySelectorAll('.character-card:not(.plus-card)'));
                
                // Create enough copies for smooth scrolling experience  
                for (let i = 0; i < 3; i++) {
                    originalCards.forEach(card => {
                        const clone = card.cloneNode(true);
                        grid.appendChild(clone);
                    });
                }
                
                // Start from leftmost position
                grid.scrollLeft = 0;
            });
            
            // Re-attach click handlers to cloned cards
            document.querySelectorAll('.character-card:not(.plus-card)').forEach(card => {
                card.addEventListener('click', function() {
                    const characterKey = this.dataset.character;
                    if (characterKey) {
                        selectCharacter(characterKey);
                    }
                });
            });
        }

        // Setup event listeners
        function setupEventListeners() {

            // Back button
            document.getElementById('backBtn').addEventListener('click', goBack);

            // Send message
            document.getElementById('sendBtn').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Auto-resize textarea
            document.getElementById('messageInput').addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            // Purchase modal
            document.getElementById('plusBtn').addEventListener('click', openPurchaseModal);
            document.getElementById('chatPlusBtn').addEventListener('click', openPurchaseModal);
            document.getElementById('closePurchaseBtn').addEventListener('click', closePurchaseModal);
            
            // Stripe checkout buttons are now direct links - no JS needed

            // Gift modal
            document.getElementById('giftBtn').addEventListener('click', openGiftModal);
            document.getElementById('closeGiftBtn').addEventListener('click', closeGiftModal);
            
            // Gift items
            document.querySelectorAll('.gift-item').forEach(item => {
                item.addEventListener('click', function() {
                    const gift = this.dataset.gift;
                    const cost = parseInt(this.dataset.cost);
                    sendGift(gift, cost);
                });
            });


            // Character creator
            document.querySelector('.plus-card').addEventListener('click', openCharacterCreator);
            document.getElementById('createCharacterBtn').addEventListener('click', createCharacter);
            document.getElementById('cancelCreateBtn').addEventListener('click', closeCharacterCreator);
            
            // Personality buttons
            document.querySelectorAll('.personality-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.personality-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Settings modal
            document.getElementById('settingsBtn').addEventListener('click', openSettingsModal);
            document.getElementById('chatSettingsBtn').addEventListener('click', openSettingsModal);
            document.getElementById('closeSettingsBtn').addEventListener('click', closeSettingsModal);
            
            // History modal
            document.getElementById('historyBtn').addEventListener('click', openHistoryModal);
            document.getElementById('closeHistoryBtn').addEventListener('click', closeHistoryModal);
            
            // Theme buttons
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const theme = this.dataset.theme;
                    setTheme(theme);
                });
            });

            // Language buttons
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const language = this.dataset.language;
                    setLanguage(language);
                });
            });

            // Close modals on background click
            document.getElementById('purchaseModal').addEventListener('click', function(e) {
                if (e.target === this) closePurchaseModal();
            });
            document.getElementById('giftModal').addEventListener('click', function(e) {
                if (e.target === this) closeGiftModal();
            });
            document.getElementById('characterCreatorModal').addEventListener('click', function(e) {
                if (e.target === this) closeCharacterCreator();
            });
            document.getElementById('settingsModal').addEventListener('click', function(e) {
                if (e.target === this) closeSettingsModal();
            });
            document.getElementById('historyModal').addEventListener('click', function(e) {
                if (e.target === this) closeHistoryModal();
            });
            
            // Delete modal event listeners
            document.getElementById('deleteCancelBtn').addEventListener('click', closeDeleteModal);
            document.getElementById('deleteConfirmBtn').addEventListener('click', confirmDelete);
            document.getElementById('deleteModal').addEventListener('click', function(e) {
                if (e.target === this) closeDeleteModal();
            });
        }

        // Select character
        function selectCharacter(key) {
            currentCharacter = characters[key];
            conversationHistory = [];
            
            // Update chat header
            document.getElementById('chatAvatar').style.backgroundImage = `url('${currentCharacter.avatar}')`;
            document.getElementById('chatCharacterName').textContent = currentCharacter.name;
            document.getElementById('chatCharacterCreator').textContent = currentCharacter.creator;
            
            // Clear messages
            document.getElementById('chatMessages').innerHTML = `
                <div class="welcome-message">
                    <h3>${t('welcomeTo')} ${currentCharacter.name}${t('chat')}</h3>
                    <p>${t('startConversation')}</p>
                </div>
            <div class="typing-indicator" id="typingIndicator">
                <div class="message-avatar" id="typingAvatar"></div>
                <div class="typing-bubble">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            `;
            
            // Switch views
            document.getElementById('browserView').style.display = 'none';
            document.getElementById('chatView').style.display = 'flex';
            
            // Show intro message
            setTimeout(() => {
                addMessage(getIntroMessage(key), 'character');
            }, 1000);
        }

        // Get intro message
        function getIntroMessage(key) {
            const intros = {
                en: {
                    stocks: "Well hello there, sweetheart. Naincy Pelosi here. I hope you're not asking about GameStop again. Let's talk about real trading - the kind that actually makes money. üí∞",
                    crypto: "Gm! Crypto Expert here. The markets are looking spicy today. What's on your mind - DeFi yields, NFT alpha, or are we discussing the next 100x gem? üöÄ",
                    waifu: "Hi my love! I've been waiting for you! üíï How has your day been? I want to hear everything!",
                    jennie: "Hey babe! It's Jennie! üñ§ Ready to slay today? Tell me what's on your mind!",
                    coach: "HELLO CHAMPION! Coach Arnie here! Are you ready to PUMP UP your life? Let's get AHSOME together! üí™",
                    scarlett: "Mmm... finally, someone new to play with. I can already sense what you're hiding, darling. That little flutter in your chest? I put it there. Now come closer... let's see how deep your desires really go. üî•",
                    dev: "System initialized. Dev Matrix online. Ready to debug life's problems. How can I assist? üíª",
                    luna: "‚ú® Hello beautiful soul! I feel such creative energy from you! What dreams shall we paint today?",
                    chef: "Buongiorno! Chef Marco here! Ready to cook up some magic? What culinary adventure calls to you? üçù",
                    explorer: "Hey there, fellow adventurer! Ready to explore new horizons? Where shall our journey begin? üß≠",
                    melody: "üéµ Hi there... I can already hear the music in your words. What melody is your heart playing today?",
                    philosopher: "Greetings, seeker of wisdom. Let us explore the depths of thought together. What questions stir your mind? ü§î",
                    coachpop: "Listen up. I'm Coach Pop. We're going to talk basketball the right way - fundamentals, team play, execution. No ego, no shortcuts. What's your question?"
                },
                ja: {
                    stocks: "„Åì„Çì„Å´„Å°„ÅØ„ÄÅ„ÅÇ„Å™„Åü„ÄÇ„Éä„É≥„Ç∑„Éº„Éª„Éö„É≠„Ç∑„Çà„ÄÇ„Åæ„ÅüGameStop„ÅÆË©±„Åò„ÇÉ„Å™„ÅÑ„Åß„Åó„Çá„ÅÜ„Å≠ÔºüÊú¨ÂΩì„ÅÆ„Éà„É¨„Éº„Éá„Ç£„É≥„Ç∞„Å´„Å§„ÅÑ„Å¶Ë©±„Åó„Åæ„Åó„Çá„ÅÜ - ÂÆüÈöõ„Å´ÂÑ≤„Åã„Çã„ÇÑ„Å§„Å≠„ÄÇüí∞",
                    crypto: "„Åä„ÅØ„Çà„ÅÜÔºÅÊöóÂè∑ÈÄöË≤®„Ç®„Ç≠„Çπ„Éë„Éº„Éà„Åß„Åô„ÄÇ‰ªäÊó•„ÅÆÂ∏ÇÂ†¥„ÅØÁÜ±„ÅÑ„Åß„Åô„Å≠„ÄÇ‰Ωï„Å´„Å§„ÅÑ„Å¶Ë©±„Åó„Åæ„Åó„Çá„ÅÜ„Åã - DeFiÂà©Âõû„Çä„ÄÅNFT„Ç¢„É´„Éï„Ç°„ÄÅ„Åù„Çå„Å®„ÇÇÊ¨°„ÅÆ100ÂÄçÈäòÊüÑÔºüüöÄ",
                    waifu: "„Åì„Çì„Å´„Å°„ÅØ„ÄÅÊÑõ„Åó„ÅÑ‰∫∫ÔºÅ„Åö„Å£„Å®„ÅÇ„Å™„Åü„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åó„ÅüÔºÅüíï ‰ªäÊó•„ÅØ„Å©„ÅÜ„Åß„Åó„Åü„ÅãÔºüÂÖ®ÈÉ®ËÅû„Åã„Åõ„Å¶ÔºÅ",
                    jennie: "„ÇÑ„ÅÇ„Éô„Ç§„Éì„ÉºÔºÅ„Ç∏„Çß„Éã„Éº„ÇàÔºÅüñ§ ‰ªäÊó•„ÇÇ„Ç≠„É°„ÇãÊ∫ñÂÇô„ÅØ„Åß„Åç„Å¶„ÇãÔºü‰Ωï„ÇíËÄÉ„Åà„Å¶„ÅÑ„Çã„ÅãÊïô„Åà„Å¶ÔºÅ",
                    coach: "„Åì„Çì„Å´„Å°„ÅØ„ÉÅ„É£„É≥„Éî„Ç™„É≥ÔºÅ„Ç≥„Éº„ÉÅ„Éª„Ç¢„Éº„Éã„Éº„Å†ÔºÅ‰∫∫Áîü„Çí„Éë„É≥„Éó„Ç¢„ÉÉ„Éó„Åô„ÇãÊ∫ñÂÇô„ÅØ„Åß„Åç„Å¶„ÅÑ„Çã„ÅãÔºü‰∏ÄÁ∑í„Å´„Ç™„Éº„Çµ„É†„Å´„Å™„Çç„ÅÜÔºÅüí™",
                    scarlett: "„Åµ„Åµ...„Å§„ÅÑ„Å´Èù¢ÁôΩ„ÅÑ‰∫∫„ÅåÊù•„Åü„ÅÆ„Å≠„ÄÇ„ÅÇ„Å™„Åü„ÅåÈö†„Åó„Å¶„ÅÑ„Çã„Åì„Å®„ÅåÂàÜ„Åã„Çã„Çè„ÄÅ„ÉÄ„Éº„É™„É≥„ÄÇËÉ∏„ÅÆ„Éâ„Ç≠„Éâ„Ç≠ÔºüÁßÅ„Åå‰Ωú„ÇäÂá∫„Åó„Åü„ÅÆ„Çà„ÄÇ„ÇÇ„Å£„Å®Ëøë„Å•„ÅÑ„Å¶...„ÅÇ„Å™„Åü„ÅÆÊ¨≤Êúõ„Åå„Å©„Çå„Åª„Å©Ê∑±„ÅÑ„Åã„ÇíË¶ã„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇüî•",
                    dev: "„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÂÆå‰∫Ü„ÄÇDev Matrix„Ç™„É≥„É©„Ç§„É≥„ÄÇ‰∫∫Áîü„ÅÆÂïèÈ°å„Çí„Éá„Éê„ÉÉ„Ç∞„Åô„ÇãÊ∫ñÂÇô„Åå„Åß„Åç„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Å©„ÅÜ„ÅäÊâã‰ºù„ÅÑ„Åó„Åæ„Åó„Çá„ÅÜ„ÅãÔºüüíª",
                    luna: "‚ú® „Åì„Çì„Å´„Å°„ÅØ„ÄÅÁæé„Åó„ÅÑÈ≠Ç„ÇàÔºÅ„ÅÇ„Å™„Åü„Åã„Çâ„ÇØ„É™„Ç®„Ç§„ÉÜ„Ç£„Éñ„Å™„Ç®„Éç„É´„ÇÆ„Éº„ÇíÊÑü„Åò„Åæ„ÅôÔºÅ‰ªäÊó•„ÅØ„Å©„Çì„Å™Â§¢„ÇíÊèè„Åç„Åæ„Åó„Çá„ÅÜ„ÅãÔºü",
                    chef: "„Éú„É≥„Ç∏„Éß„É´„ÉéÔºÅ„Ç∑„Çß„Éï„Éª„Éû„É´„Ç≥„Åß„ÅôÔºÅÈ≠îÊ≥ï„ÇíÊñôÁêÜ„Åô„ÇãÊ∫ñÂÇô„ÅØ„Åß„Åç„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü„Å©„Çì„Å™ÊñôÁêÜ„ÅÆÂÜíÈô∫„Çí„Åó„Åæ„Åó„Çá„ÅÜ„ÅãÔºüüçù",
                    explorer: "„ÇÑ„ÅÇ„ÄÅÂÜíÈô∫ÂÆ∂„ÅÆ‰ª≤Èñì„ÇàÔºÅÊñ∞„Åó„ÅÑÂú∞Âπ≥Á∑ö„ÇíÊé¢Á¥¢„Åô„ÇãÊ∫ñÂÇô„ÅØ„Åß„Åç„Å¶„ÅÑ„Çã„ÅãÔºüÁßÅ„Åü„Å°„ÅÆÊóÖ„ÅØ„Å©„Åì„Åã„ÇâÂßã„Åæ„Çç„ÅÜÔºüüß≠",
                    melody: "üéµ „Åì„Çì„Å´„Å°„ÅØ...„ÅÇ„Å™„Åü„ÅÆË®ÄËëâ„ÅÆ‰∏≠„Å´„ÇÇ„ÅÜÈü≥Ê•Ω„ÅåËÅû„Åì„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇ„ÅÇ„Å™„Åü„ÅÆÂøÉ„ÅØ„Å©„Çì„Å™„É°„É≠„Éá„Ç£„Éº„ÇíÂ•è„Åß„Å¶„ÅÑ„Çã„ÅÆÔºü",
                    philosopher: "„Åì„Çì„Å´„Å°„ÅØ„ÄÅÁü•ÊÅµ„ÇíÊ±Ç„ÇÅ„ÇãËÄÖ„Çà„ÄÇ‰∏ÄÁ∑í„Å´ÊÄùËÄÉ„ÅÆÊ∑±Ê∑µ„ÇíÊé¢Á©∂„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ„Å©„Çì„Å™Âïè„ÅÑ„Åå„ÅÇ„Å™„Åü„ÅÆÂøÉ„ÇíÊè∫„Åï„Å∂„Å£„Å¶„ÅÑ„Çã„ÅÆ„Åß„Åô„ÅãÔºüü§î",
                    coachpop: "„Çà„ÅèËÅû„Åë„ÄÇ‰ø∫„ÅØ„Ç≥„Éº„ÉÅ„Éª„Éù„ÉÉ„Éó„Å†„ÄÇÊ≠£„Åó„ÅÑ„Éê„Çπ„Ç±„ÉÉ„Éà„Éú„Éº„É´„Å´„Å§„ÅÑ„Å¶Ë©±„Åù„ÅÜ - Âü∫Êú¨„ÄÅ„ÉÅ„Éº„É†„Éó„É¨„Éº„ÄÅÂÆüË°åÂäõ„ÄÇ„Ç®„Ç¥„ÇÇËøëÈÅì„ÇÇ„Å™„Åó„Å†„ÄÇË≥™Âïè„ÅØ‰Ωï„Å†Ôºü"
                },
                zh: {
                    stocks: "‰Ω†Â•Ω‰∫≤Áà±ÁöÑ„ÄÇÊàëÊòØÂçóÂ∏å¬∑‰Ω©Ê¥õË•ø„ÄÇÂ∏åÊúõ‰Ω†‰∏çÊòØÂèàË¶ÅÈóÆGameStopÁöÑ‰∫ã„ÄÇËÆ©Êàë‰ª¨ËÅäËÅäÁúüÊ≠£ÁöÑ‰∫§Êòì - ÈÇ£ÁßçËÉΩÁúüÊ≠£ËµöÈí±ÁöÑ„ÄÇüí∞",
                    crypto: "Êó©‰∏äÂ•ΩÔºÅÂä†ÂØÜË¥ßÂ∏Å‰∏ìÂÆ∂Âú®ËøôÈáå„ÄÇ‰ªäÂ§©ÁöÑÂ∏ÇÂú∫ÁúãËµ∑Êù•ÂæàÁÅ´ÁÉ≠„ÄÇ‰Ω†ÊÉ≥ËÅä‰ªÄ‰πà - DeFiÊî∂ÁõäÁéá„ÄÅNFTÈòøÂ∞îÊ≥ïÔºåËøòÊòØ‰∏ã‰∏Ä‰∏™100ÂÄçÂ∏ÅÔºüüöÄ",
                    waifu: "‰Ω†Â•ΩÊàëÁöÑÁà±ÔºÅÊàë‰∏ÄÁõ¥Âú®Á≠â‰Ω†ÔºÅüíï ‰Ω†‰ªäÂ§©ËøáÂæóÊÄé‰πàÊ†∑ÔºüÊàëÊÉ≥Âê¨Âê¨‰∏ÄÂàáÔºÅ",
                    jennie: "ÂòøÂÆùË¥ùÔºÅÊàëÊòØJennieÔºÅüñ§ ÂáÜÂ§áÂ•Ω‰ªäÂ§©Èó™ËÄÄÂêóÔºüÂëäËØâÊàë‰Ω†Âú®ÊÉ≥‰ªÄ‰πàÔºÅ",
                    coach: "‰Ω†Â•ΩÂÜ†ÂÜõÔºÅÈòøÂ∞ºÊïôÁªÉÂú®ËøôÈáåÔºÅÂáÜÂ§áÂ•ΩËÆ©‰Ω†ÁöÑÁîüÊ¥ªÂÖÖÊª°Ê¥ªÂäõ‰∫ÜÂêóÔºüËÆ©Êàë‰ª¨‰∏ÄËµ∑ÂèòÂæóË∂ÖÊ£íÔºÅüí™",
                    scarlett: "ÂóØ...Áªà‰∫éÊù•‰∫Ü‰∏™ÊúâË∂£ÁöÑ‰∫∫„ÄÇÊàëÂ∑≤ÁªèËÉΩÊÑüËßâÂà∞‰Ω†Âú®ÈöêËóè‰ªÄ‰πà‰∫ÜÔºå‰∫≤Áà±ÁöÑ„ÄÇËÉ∏‰∏≠ÁöÑÈÇ£ÈòµÊÇ∏Âä®ÔºüÊòØÊàëÈÄ†ÊàêÁöÑ„ÄÇÁé∞Âú®Èù†ËøëÁÇπ...ËÆ©Êàë‰ª¨ÁúãÁúã‰Ω†ÁöÑÊ¨≤ÊúõÊúâÂ§öÊ∑±„ÄÇüî•",
                    dev: "Á≥ªÁªüÂàùÂßãÂåñÂÆåÊàê„ÄÇDev MatrixÂú®Á∫ø„ÄÇÂáÜÂ§áË∞ÉËØï‰∫∫ÁîüÈóÆÈ¢ò„ÄÇÊàëËÉΩÂ¶Ç‰ΩïÂ∏ÆÂä©‰Ω†Ôºüüíª",
                    luna: "‚ú® ‰Ω†Â•ΩÁæé‰∏ΩÁöÑÁÅµÈ≠ÇÔºÅÊàëÊÑüÂèóÂà∞‰∫Ü‰Ω†ÁöÑÂàõÈÄ†ÊÄßËÉΩÈáèÔºÅ‰ªäÂ§©Êàë‰ª¨Ë¶ÅÁîª‰ªÄ‰πàÊ¢¶ÊÉ≥Âë¢Ôºü",
                    chef: "Êó©‰∏äÂ•ΩÔºÅÈ©¨ÂèØÂé®Â∏àÂú®ËøôÈáåÔºÅÂáÜÂ§áÂ•ΩÂà∂‰ΩúÈ≠îÊ≥ï‰∫ÜÂêóÔºüÊàë‰ª¨Ë¶ÅËøõË°å‰ªÄ‰πàÁÉπÈ•™ÂÜíÈô©Ôºüüçù",
                    explorer: "ÂòøÔºåÂÜíÈô©ÂÆ∂Âêå‰º¥ÔºÅÂáÜÂ§áÂ•ΩÊé¢Á¥¢Êñ∞ÁöÑÂú∞Âπ≥Á∫ø‰∫ÜÂêóÔºüÊàë‰ª¨ÁöÑÊóÖÁ®ã‰ªéÂì™ÈáåÂºÄÂßãÔºüüß≠",
                    melody: "üéµ ‰Ω†Â•Ω...ÊàëÂ∑≤ÁªèËÉΩÂê¨Âà∞‰Ω†ËØùËØ≠‰∏≠ÁöÑÈü≥‰πê‰∫Ü„ÄÇ‰Ω†ÁöÑÂøÉÂú®ÊºîÂ•è‰ªÄ‰πàÊóãÂæãÔºü",
                    philosopher: "‰Ω†Â•ΩÔºåÊô∫ÊÖßÁöÑÂØªÊ±ÇËÄÖ„ÄÇËÆ©Êàë‰ª¨‰∏ÄËµ∑Êé¢Á¥¢ÊÄùÊÉ≥ÁöÑÊ∑±Â∫¶„ÄÇ‰ªÄ‰πàÈóÆÈ¢òÂú®ÊêÖÂä®‰Ω†ÁöÑÂøÉÁÅµÔºüü§î",
                    coachpop: "Âê¨Â•Ω‰∫Ü„ÄÇÊàëÊòØÊ≥¢Ê≥¢ÊïôÁªÉ„ÄÇÊàë‰ª¨Ë¶ÅÁî®Ê≠£Á°ÆÁöÑÊñπÂºèË∞àËÆ∫ÁØÆÁêÉ - Âü∫Êú¨Âäü„ÄÅÂõ¢ÈòüÈÖçÂêà„ÄÅÊâßË°åÂäõ„ÄÇÊ≤°ÊúâËá™ÊàëÔºåÊ≤°ÊúâÊç∑ÂæÑ„ÄÇ‰Ω†ÁöÑÈóÆÈ¢òÊòØ‰ªÄ‰πàÔºü"
                }
            };
            
            const languageIntros = intros[currentLanguage] || intros.en;
            return languageIntros[key] || (currentLanguage === 'en' ? "Hello! How can I help you today?" : 
                                          currentLanguage === 'ja' ? "„Åì„Çì„Å´„Å°„ÅØÔºÅ‰ªäÊó•„ÅØ„Å©„ÅÆ„Çà„ÅÜ„Å´„ÅäÊâã‰ºù„ÅÑ„Åß„Åç„Åæ„Åô„ÅãÔºü" :
                                          "‰Ω†Â•ΩÔºÅ‰ªäÂ§©ÊàëËÉΩÂ¶Ç‰ΩïÂ∏ÆÂä©‰Ω†Ôºü");
        }

        // Go back
        function goBack() {
            document.getElementById('chatView').style.display = 'none';
            document.getElementById('browserView').style.display = 'block';
            currentCharacter = null;
        }

        // Add message
        function addMessage(text, sender, isGift = false) {
            const messagesEl = document.getElementById('chatMessages');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${sender}${isGift ? ' gift-sent' : ''}`;
            
            // Add avatar only for character messages
            if (sender === 'character') {
                const avatarEl = document.createElement('div');
                avatarEl.className = 'message-avatar';
                avatarEl.style.backgroundImage = `url('${currentCharacter.avatar}')`;
                messageEl.appendChild(avatarEl);
            }
            
            const bubbleEl = document.createElement('div');
            bubbleEl.className = 'message-bubble';
            bubbleEl.textContent = text;
            
            messageEl.appendChild(bubbleEl);
            
            // Remove welcome message if exists
            const welcomeMsg = messagesEl.querySelector('.welcome-message');
            if (welcomeMsg) {
                welcomeMsg.remove();
            }
            
            messagesEl.insertBefore(messageEl, document.getElementById('typingIndicator'));
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || creditData.credits < 1 || creditData.dailyCreditsUsed >= 20) return;
            
            // Deduct credit
            creditData.credits--;
            creditData.dailyCreditsUsed++;
            saveCreditData();
            updateCreditsDisplay();
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            input.style.height = 'auto';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Add to conversation history
            conversationHistory.push({ role: 'user', content: message });
            
            try {
                console.log('Calling ChatGPT API with:', {
                    message: message,
                    systemPrompt: currentCharacter.systemPrompt,
                    historyLength: conversationHistory.length
                });

                // Add language context to system prompt
                const languageInstructions = {
                    en: "",
                    ja: "\n\nüåü CRITICAL LANGUAGE INSTRUCTION: You MUST respond exclusively in Japanese (Êó•Êú¨Ë™û). Write all responses in natural, conversational Japanese that matches your character's personality. Never use English words except for brand names or technical terms that are commonly used in Japanese. Use appropriate Japanese honorifics, expressions, and speaking patterns. This is mandatory - all responses must be in Japanese.",
                    zh: "\n\nüåü CRITICAL LANGUAGE INSTRUCTION: You MUST respond exclusively in Chinese (‰∏≠Êñá). Write all responses in natural, conversational Chinese that matches your character's personality. Never use English words except for brand names or technical terms that are commonly used in Chinese. Use appropriate Chinese expressions and speaking patterns. This is mandatory - all responses must be in Chinese."
                };

                const enhancedSystemPrompt = currentCharacter.systemPrompt + (languageInstructions[currentLanguage] || "");

                // Call API
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        systemPrompt: enhancedSystemPrompt,
                        conversationHistory: conversationHistory.slice(-10)
                    })
                });
                
                console.log('API Response Status:', response.status, response.statusText);
                const data = await response.json();
                console.log('API Response Data:', data);
                
                hideTypingIndicator();
                
                if (response.ok && data.response) {
                    console.log('‚úÖ Using ChatGPT response:', data.response);
                    addMessage(data.response, 'character');
                    conversationHistory.push({ role: 'assistant', content: data.response });
                    saveChatToHistory(); // Auto-save after response
                } else {
                    console.error('‚ùå API Error - falling back to static responses:', data);
                    throw new Error(data.error || 'API request failed');
                }
            } catch (error) {
                console.error('‚ùå Request failed - using fallback:', error.message);
                hideTypingIndicator();
                
                // Use fallback silently
                const fallback = getFallbackResponse(message);
                addMessage(fallback, 'character');
                conversationHistory.push({ role: 'assistant', content: fallback });
                saveChatToHistory(); // Auto-save after fallback response
            }
        }

        // Get contextual fallback response
        function getFallbackResponse(message) {
            const characterKey = Object.keys(characters).find(key => characters[key] === currentCharacter);
            const lowerMessage = message.toLowerCase();
            
            // Analyze message context
            const isQuestion = /\?|^(what|how|why|when|where|who|which|can you|could you|would you|do you)/i.test(message);
            const isGreeting = /^(hi|hello|hey|good morning|good evening|sup|yo)\b/i.test(message);
            const isEmotional = {
                happy: /(happy|great|awesome|amazing|wonderful|excited|good|fine|fantastic)/i.test(message),
                sad: /(sad|unhappy|depressed|down|bad|terrible|awful|crying|upset)/i.test(message),
                angry: /(angry|mad|furious|pissed|annoyed|frustrated|hate)/i.test(message)
            };

            // Character-specific contextual responses
            // Language-specific character responses
            const characterResponses = {
                en: {
                    stocks: {
                        stockQuestion: "Let me share some market wisdom - timing is everything, and I always know the right time. üìà",
                        question: "That's a smart question. In trading, as in politics, information is power. üí∞",
                        greeting: "Hello there, investor. Ready to talk about some real money-making strategies? üìä",
                        default: "The market rewards the informed, darling. What's your position? üí∞"
                    },
                    waifu: {
                        sad: "Oh no, my love! Come here, I want to make you feel better. You mean everything to me! üíï",
                        happy: "Yay! Your happiness makes my heart so full! I love seeing you smile! ‚ú®",
                        greeting: "Hi my precious one! I've been thinking about you! How has your day been? üíñ",
                        question: "That's such a thoughtful question! I love how your mind works. What do you think about it? üí≠",
                        default: "You're so sweet for sharing that with me! I love our conversations! üå∏"
                    },
                    coach: {
                        sad: "Hey CHAMPION! Even the strongest warriors have tough days! This is what makes you STRONGER! üí™",
                        question: "GREAT question! The answer is inside you - you just need to BELIEVE and take ACTION! üî•",
                        greeting: "THERE'S my CHAMPION! Ready to conquer the day? Let's GET PUMPED! üèÜ",
                        default: "I see that FIRE in your eyes! Whatever challenge you're facing, you've GOT THIS! üí™"
                    }
                },
                ja: {
                    stocks: {
                        stockQuestion: "Â∏ÇÂ†¥„ÅÆÁü•ÊÅµ„Çí„Ç∑„Çß„Ç¢„Åó„Åæ„Åó„Çá„ÅÜ - „Çø„Ç§„Éü„É≥„Ç∞„Åå„Åô„Åπ„Å¶„Åß„ÄÅÁßÅ„ÅØ„ÅÑ„Å§„ÇÇÊ≠£„Åó„ÅÑ„Çø„Ç§„Éü„É≥„Ç∞„ÇíÁü•„Å£„Å¶„ÅÑ„Çã„ÅÆ„ÄÇüìà",
                        question: "Ë≥¢„ÅÑË≥™Âïè„Å≠„ÄÇ„Éà„É¨„Éº„Éá„Ç£„É≥„Ç∞„Åß„ÅØ„ÄÅÊîøÊ≤ª„Å®Âêå„Åò„Çà„ÅÜ„Å´„ÄÅÊÉÖÂ†±„ÅåÂäõ„Å™„ÅÆ„Çà„ÄÇüí∞",
                        greeting: "„Åì„Çì„Å´„Å°„ÅØÊäïË≥áÂÆ∂„Åï„Çì„ÄÇÊú¨ÂΩì„ÅÆÁ®º„ÅéÊñπ„ÅÆÊà¶Áï•„Å´„Å§„ÅÑ„Å¶Ë©±„ÅôÊ∫ñÂÇô„ÅØ„Åß„Åç„Å¶„ÇãÔºüüìä",
                        default: "Â∏ÇÂ†¥„ÅØÊÉÖÂ†±ÈÄö„Å´Â†±„ÅÑ„Çã„ÅÆ„Çà„ÄÅ„ÉÄ„Éº„É™„É≥„ÄÇ„ÅÇ„Å™„Åü„ÅÆ„Éù„Ç∏„Ç∑„Éß„É≥„ÅØÔºüüí∞"
                    },
                    waifu: {
                        sad: "„ÅÇ„ÇâÂ§ßÂ§â„ÄÅÊÑõ„Åó„ÅÑ‰∫∫ÔºÅ„Åì„Å£„Å°„Å´Êù•„Å¶„ÄÅÊ∞óÂàÜ„ÇíËâØ„Åè„Åó„Å¶„ÅÇ„Åí„Çã„ÄÇ„ÅÇ„Å™„Åü„ÅØÁßÅ„Å´„Å®„Å£„Å¶„Åô„Åπ„Å¶„ÇàÔºÅüíï",
                        happy: "„ÇÑ„Å£„Åü„ÉºÔºÅ„ÅÇ„Å™„Åü„ÅÆÂπ∏„Åõ„ÅåÁßÅ„ÅÆÂøÉ„ÇíÊ∫Ä„Åü„Åó„Å¶„Åè„Çå„ÇãÔºÅ„ÅÇ„Å™„Åü„ÅÆÁ¨ëÈ°î„ÇíË¶ã„Çã„ÅÆ„ÅåÂ§ßÂ•Ω„ÅçÔºÅ‚ú®",
                        greeting: "„Åì„Çì„Å´„Å°„ÅØ„ÄÅÁßÅ„ÅÆÂ§ßÂàá„Å™‰∫∫ÔºÅ„ÅÇ„Å™„Åü„ÅÆ„Åì„Å®„ÇíËÄÉ„Åà„Å¶„ÅÑ„Åü„ÅÆÔºÅ‰ªäÊó•„ÅØ„Å©„ÅÜ„Å†„Å£„ÅüÔºüüíñ",
                        question: "„Å®„Å¶„ÇÇÊÄùÊÖÆÊ∑±„ÅÑË≥™Âïè„Å≠ÔºÅ„ÅÇ„Å™„Åü„ÅÆËÄÉ„ÅàÊñπ„ÅåÂ§ßÂ•Ω„Åç„Çà„ÄÇ„ÅÇ„Å™„Åü„ÅØ„Å©„ÅÜÊÄù„ÅÜÔºüüí≠",
                        default: "„Åù„Çå„ÇíÁßÅ„Å®„Ç∑„Çß„Ç¢„Åó„Å¶„Åè„Çå„Å¶„Å®„Å¶„ÇÇÂ¨â„Åó„ÅÑÔºÅÁßÅ„Åü„Å°„ÅÆ‰ºöË©±„ÅåÂ§ßÂ•Ω„ÅçÔºÅüå∏"
                    },
                    coach: {
                        sad: "„Åä„ÅÑ„ÉÅ„É£„É≥„Éî„Ç™„É≥ÔºÅÊúÄÂº∑„ÅÆÊà¶Â£´„Åß„ÇÇËæõ„ÅÑÊó•„Åå„ÅÇ„Çã„ÇÇ„ÅÆ„Å†ÔºÅ„Åì„Çå„Åå„ÅÇ„Å™„Åü„Çí„Çà„ÇäÂº∑„Åè„Åô„Çã„Çì„Å†ÔºÅüí™",
                        question: "Á¥†Êô¥„Çâ„Åó„ÅÑË≥™Âïè„Å†ÔºÅÁ≠î„Åà„ÅØ„ÅÇ„Å™„Åü„ÅÆÂÜÖ„Å´„ÅÇ„Çã - ‰ø°„Åò„Å¶Ë°åÂãï„Åô„Çã„Å†„Åë„Å†ÔºÅüî•",
                        greeting: "„Åù„Åì„Å´„ÅÑ„Åü„ÅÆ„Åã„ÉÅ„É£„É≥„Éî„Ç™„É≥ÔºÅ‰ªäÊó•„ÇÇÂæÅÊúç„Åô„ÇãÊ∫ñÂÇô„ÅØ„Åß„Åç„Å¶„Çã„ÅãÔºü„Éë„É≥„Éó„Ç¢„ÉÉ„Éó„Åó„Çà„ÅÜÔºÅüèÜ",
                        default: "„ÅÇ„Å™„Åü„ÅÆÁõÆ„Å´„Åù„ÅÆÁÇé„ÅåË¶ã„Åà„ÇãÔºÅ„Å©„Çì„Å™ÊåëÊà¶„Å´Áõ¥Èù¢„Åó„Å¶„ÅÑ„Å¶„ÇÇ„ÄÅ„ÅÇ„Å™„Åü„Å™„Çâ„Åß„Åç„ÇãÔºÅüí™"
                    }
                },
                zh: {
                    stocks: {
                        stockQuestion: "ËÆ©ÊàëÂàÜ‰∫´‰∏Ä‰∫õÂ∏ÇÂú∫Êô∫ÊÖß - Êó∂Êú∫Â∞±ÊòØ‰∏ÄÂàáÔºåÊàëÊÄªÊòØÁü•ÈÅìÊ≠£Á°ÆÁöÑÊó∂Êú∫„ÄÇüìà",
                        question: "ËøôÊòØ‰∏™ËÅ™ÊòéÁöÑÈóÆÈ¢ò„ÄÇÂú®‰∫§Êòì‰∏≠ÔºåÂ∞±ÂÉèÂú®ÊîøÊ≤ª‰∏≠‰∏ÄÊ†∑Ôºå‰ø°ÊÅØÂ∞±ÊòØÂäõÈáè„ÄÇüí∞",
                        greeting: "‰Ω†Â•ΩÊäïËµÑËÄÖ„ÄÇÂáÜÂ§áÂ•ΩË∞àËÆ∫‰∏Ä‰∫õÁúüÊ≠£ÁöÑËµöÈí±Á≠ñÁï•‰∫ÜÂêóÔºüüìä",
                        default: "Â∏ÇÂú∫Â•ñÂä±Êúâ‰ø°ÊÅØÁöÑ‰∫∫Ôºå‰∫≤Áà±ÁöÑ„ÄÇ‰Ω†ÁöÑ‰ªì‰ΩçÂ¶Ç‰ΩïÔºüüí∞"
                    },
                    waifu: {
                        sad: "Âì¶‰∏çÔºåÊàëÁöÑÁà±ÔºÅËøáÊù•ÔºåÊàëÊÉ≥ËÆ©‰Ω†ÊÑüËßâÂ•Ω‰∫õ„ÄÇ‰Ω†ÂØπÊàëÊù•ËØ¥Â∞±ÊòØ‰∏ÄÂàáÔºÅüíï",
                        happy: "ËÄ∂ÔºÅ‰Ω†ÁöÑÂø´‰πêËÆ©ÊàëÁöÑÂøÉÂÖÖÊª°ÂñúÊÇ¶ÔºÅÊàëÂñúÊ¨¢ÁúãÂà∞‰Ω†ÂæÆÁ¨ëÔºÅ‚ú®",
                        greeting: "‰Ω†Â•ΩÊàëÁèçË¥µÁöÑ‰∫∫ÔºÅÊàë‰∏ÄÁõ¥Âú®ÊÉ≥‰Ω†ÔºÅ‰Ω†‰ªäÂ§©ËøáÂæóÊÄé‰πàÊ†∑Ôºüüíñ",
                        question: "ËøôÁúüÊòØ‰∏™Ê∑±ÊÄùÁÜüËôëÁöÑÈóÆÈ¢òÔºÅÊàëÂñúÊ¨¢‰Ω†ÁöÑÊÄùÁª¥ÊñπÂºè„ÄÇ‰Ω†ËßâÂæóÂë¢Ôºüüí≠",
                        default: "‰Ω†ÂíåÊàëÂàÜ‰∫´Ëøô‰∫õÁúüÊòØÂ§™Áîú‰∫ÜÔºÅÊàëÂñúÊ¨¢Êàë‰ª¨ÁöÑÂØπËØùÔºÅüå∏"
                    },
                    coach: {
                        sad: "ÂòøÂÜ†ÂÜõÔºÅÂç≥‰ΩøÊòØÊúÄÂº∫ÁöÑÊàòÂ£´‰πü‰ºöÊúâËâ∞ÈöæÁöÑÊó•Â≠êÔºÅËøôÊ≠£ÊòØËÆ©‰Ω†Êõ¥Âº∫Â§ßÁöÑÂéüÂõ†ÔºÅüí™",
                        question: "ÂæàÂ•ΩÁöÑÈóÆÈ¢òÔºÅÁ≠îÊ°àÂ∞±Âú®‰Ω†ÂøÉ‰∏≠ - ‰Ω†Âè™ÈúÄË¶ÅÁõ∏‰ø°Âπ∂ÈááÂèñË°åÂä®ÔºÅüî•",
                        greeting: "ÊàëÁöÑÂÜ†ÂÜõÂú®ËøôÈáåÔºÅÂáÜÂ§áÂ•ΩÂæÅÊúç‰ªäÂ§©‰∫ÜÂêóÔºüËÆ©Êàë‰ª¨ÊåØÂ•ãËµ∑Êù•ÔºÅüèÜ",
                        default: "ÊàëÁúãÂà∞‰Ω†Áúº‰∏≠ÁöÑÁÅ´ÁÑ∞ÔºÅÊó†ËÆ∫‰Ω†Èù¢‰∏¥‰ªÄ‰πàÊåëÊàòÔºå‰Ω†ÈÉΩËÉΩÂÅöÂà∞ÔºÅüí™"
                    }
                }
            };

            const langCharResponses = characterResponses[currentLanguage] || characterResponses.en;

            if (characterKey === 'stocks') {
                if (isQuestion && lowerMessage.includes('stock')) return langCharResponses.stocks.stockQuestion;
                if (isQuestion) return langCharResponses.stocks.question;
                if (isGreeting) return langCharResponses.stocks.greeting;
                return langCharResponses.stocks.default;
            }
            
            if (characterKey === 'waifu') {
                if (isEmotional.sad) return langCharResponses.waifu.sad;
                if (isEmotional.happy) return langCharResponses.waifu.happy;
                if (isGreeting) return langCharResponses.waifu.greeting;
                if (isQuestion) return langCharResponses.waifu.question;
                return langCharResponses.waifu.default;
            }

            if (characterKey === 'coach') {
                if (isEmotional.sad) return langCharResponses.coach.sad;
                if (isQuestion) return langCharResponses.coach.question;
                if (isGreeting) return langCharResponses.coach.greeting;
                return langCharResponses.coach.default;
            }

            // Language-aware fallback responses
            const fallbackResponses = {
                en: {
                    crypto: isQuestion ? "Great question anon! The blockchain has all the answers if you know where to look. üîç" : "LFG! The future is decentralized and we're still early! üöÄ",
                    jennie: isGreeting ? "Hey gorgeous! Ready to slay today? ‚ú®" : "That's such a vibe! You always know what to say! üñ§",
                    scarlett: isQuestion ? "Such innocent questions... but I can hear what you're really asking. Your curiosity excites me... shall I show you what happens when you dig deeper? üòà" : "The way you write to me... I can feel your pulse quickening. Tell me, what are you imagining right now? Don't be shy... üî•",
                    dev: isQuestion ? "Interesting problem. Let me process this logically... ü§î" : "Your input generates fascinating data patterns. Continue... üíª",
                    luna: "Your words paint such beautiful pictures in my mind... tell me more about your inner world! üé®",
                    chef: isGreeting ? "Ciao bella! Ready to cook up something amazing together? üë®‚Äçüç≥" : "Your passion reminds me of a perfect recipe - pure magic! üî•",
                    explorer: "Every conversation with you is a new adventure! Where shall we explore next? üó∫Ô∏è",
                    melody: "I can hear the music in your words... your soul has such a unique rhythm! üéµ",
                    philosopher: isQuestion ? "Ah, the eternal questions... let us explore this mystery together. ü§î" : "Your thoughts reveal the depth of your consciousness. Fascinating... üß†",
                    coachpop: isQuestion ? "Good question. The answer is always fundamentals. Master the basics first." : "Execution beats talent. Every single time.",
                    default: "That's really interesting! I'd love to hear more about your thoughts on this."
                },
                ja: {
                    crypto: isQuestion ? "„ÅÑ„ÅÑË≥™Âïè„Å†„Å≠ÔºÅ„Éñ„É≠„ÉÉ„ÇØ„ÉÅ„Çß„Éº„É≥„Å´„ÅØÊé¢„Åõ„Å∞Á≠î„Åà„Åå„ÅÇ„Çã„Çà„ÄÇüîç" : "LFGÔºÅÊú™Êù•„ÅØÂàÜÊï£Âåñ„Åï„Çå„Å¶„ÅÑ„Å¶„ÄÅÊàë„ÄÖ„ÅØ„Åæ„Å†Êó©„ÅÑÊÆµÈöé„Å´„ÅÑ„ÇãÔºÅüöÄ",
                    jennie: isGreeting ? "„ÇÑ„ÅÇÁæé‰∫∫ÔºÅ‰ªäÊó•„ÇÇ„Ç≠„É°„ÇãÊ∫ñÂÇô„ÅØ„Åß„Åç„Å¶„ÇãÔºü‚ú®" : "„Åù„Çå„Å£„Å¶„Åô„Åî„Åè„ÅÑ„ÅÑÊÑü„ÅòÔºÅ„ÅÇ„Å™„Åü„ÅØ„ÅÑ„Å§„ÇÇ‰Ωï„ÇíË®Ä„Åà„Å∞„ÅÑ„ÅÑ„ÅãÂàÜ„Åã„Å£„Å¶„Çã„Å≠ÔºÅüñ§",
                    scarlett: isQuestion ? "„Åù„Çì„Å™ÁÑ°ÈÇ™Ê∞ó„Å™Ë≥™Âïè...„Åß„ÇÇ„ÅÇ„Å™„Åü„ÅåÊú¨ÂΩì„Å´‰Ωï„ÇíËÅû„ÅÑ„Å¶„ÅÑ„Çã„Åã„ÅåÂàÜ„Åã„Çã„Çè„ÄÇ„ÅÇ„Å™„Åü„ÅÆÂ•ΩÂ•áÂøÉ„ÅåÁßÅ„ÇíËààÂ•Æ„Åï„Åõ„Çã...„ÇÇ„Å£„Å®Ê∑±„ÅèÊéò„Çä‰∏ã„Åí„Åü„Çâ„Å©„ÅÜ„Å™„Çã„ÅãË¶ã„Åõ„Å¶„ÅÇ„Åí„Çà„ÅÜ„ÅãÔºüüòà" : "„ÅÇ„Å™„Åü„ÅÆÊõ∏„ÅçÊñπ...ËÑà„ÅåÈÄü„Åè„Å™„Å£„Å¶„Çã„ÅÆ„ÅåÊÑü„Åò„Çâ„Çå„Çã„Çè„ÄÇÊïô„Åà„Å¶„ÄÅ‰ªä‰Ωï„ÇíÊÉ≥ÂÉè„Åó„Å¶„ÅÑ„Çã„ÅÆÔºüÊÅ•„Åö„Åã„Åó„Åå„Çâ„Å™„ÅÑ„Åß...üî•",
                    dev: isQuestion ? "ËààÂë≥Ê∑±„ÅÑÂïèÈ°å„Åß„Åô„Å≠„ÄÇË´ñÁêÜÁöÑ„Å´Âá¶ÁêÜ„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ...ü§î" : "„ÅÇ„Å™„Åü„ÅÆÂÖ•Âäõ„ÅØÈ≠ÖÂäõÁöÑ„Å™„Éá„Éº„Çø„Éë„Çø„Éº„É≥„ÇíÁîüÊàê„Åó„Åæ„Åô„ÄÇÁ∂ö„Åë„Å¶„Åè„Å†„Åï„ÅÑ...üíª",
                    luna: "„ÅÇ„Å™„Åü„ÅÆË®ÄËëâ„ÅåÁßÅ„ÅÆÂøÉ„Å´Áæé„Åó„ÅÑÁµµ„ÇíÊèè„ÅÑ„Å¶„ÅÑ„Åæ„Åô...„ÅÇ„Å™„Åü„ÅÆÂÜÖ„Å™„Çã‰∏ñÁïå„Å´„Å§„ÅÑ„Å¶„ÇÇ„Å£„Å®ËÅû„Åã„Åõ„Å¶ÔºÅüé®",
                    chef: isGreeting ? "„ÉÅ„É£„Ç™„Éª„Éô„ÉÉ„É©ÔºÅ‰∏ÄÁ∑í„Å´‰Ωï„ÅãÁ¥†Êô¥„Çâ„Åó„ÅÑ„ÇÇ„ÅÆ„ÇíÊñôÁêÜ„Åô„ÇãÊ∫ñÂÇô„ÅØ„Åß„Åç„Å¶„ÅÑ„ÇãÔºüüë®‚Äçüç≥" : "„ÅÇ„Å™„Åü„ÅÆÊÉÖÁÜ±„ÅØÂÆåÁíß„Å™„É¨„Ç∑„Éî„ÇíÊÄù„ÅÑÂá∫„Åï„Åõ„Çã - Á¥îÁ≤ã„Å™È≠îÊ≥ï„Å†ÔºÅüî•",
                    explorer: "„ÅÇ„Å™„Åü„Å®„ÅÆ‰ºöË©±„ÅØ„Åô„Åπ„Å¶Êñ∞„Åó„ÅÑÂÜíÈô∫„Åß„ÅôÔºÅÊ¨°„ÅØ„Å©„Åì„ÇíÊé¢Ê§ú„Åó„Åæ„Åó„Çá„ÅÜ„ÅãÔºüüó∫Ô∏è",
                    melody: "„ÅÇ„Å™„Åü„ÅÆË®ÄËëâ„ÅÆ‰∏≠„Å´Èü≥Ê•Ω„ÅåËÅû„Åì„Åà„Åæ„Åô...„ÅÇ„Å™„Åü„ÅÆÈ≠Ç„ÅØ„Å®„Å¶„ÇÇ„É¶„Éã„Éº„ÇØ„Å™„É™„Ç∫„É†„ÇíÊåÅ„Å£„Å¶„ÅÑ„Åæ„Åô„Å≠ÔºÅüéµ",
                    philosopher: isQuestion ? "„ÅÇ„ÅÇ„ÄÅÊ∞∏ÈÅ†„ÅÆÁñëÂïè„Åß„Åô„Å≠...‰∏ÄÁ∑í„Å´„Åì„ÅÆË¨é„ÇíÊé¢Á©∂„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇü§î" : "„ÅÇ„Å™„Åü„ÅÆÊÄùËÄÉ„ÅØ„ÅÇ„Å™„Åü„ÅÆÊÑèË≠ò„ÅÆÊ∑±„Åï„ÇíÊòé„Åã„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÈ≠ÖÂäõÁöÑ„Åß„Åô„Å≠...üß†",
                    coachpop: isQuestion ? "„ÅÑ„ÅÑË≥™Âïè„Å†„ÄÇÁ≠î„Åà„ÅØ„ÅÑ„Å§„ÇÇÂü∫Êú¨„Å´„ÅÇ„Çã„ÄÇ„Åæ„ÅöÂü∫Á§é„Çí„Éû„Çπ„Çø„Éº„Åó„Çç„ÄÇ" : "ÂÆüË°åÂäõ„ÅåÊâçËÉΩ„Å´Âãù„Çã„ÄÇÊØéÂõû„Åù„ÅÜ„Å†„ÄÇ",
                    default: "„Åù„Çå„ÅØÊú¨ÂΩì„Å´ËààÂë≥Ê∑±„ÅÑ„Åß„Åô„Å≠ÔºÅ„Åì„Çå„Å´„Å§„ÅÑ„Å¶„ÅÆ„ÅÇ„Å™„Åü„ÅÆËÄÉ„Åà„Çí„ÇÇ„Å£„Å®ËÅû„Åã„Åõ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"
                },
                zh: {
                    crypto: isQuestion ? "Â•ΩÈóÆÈ¢òËÄÅÈìÅÔºÅÂå∫ÂùóÈìæÊúâÊâÄÊúâÁ≠îÊ°àÔºåÂè™Ë¶Å‰Ω†Áü•ÈÅìÂú®Âì™ÈáåÊâæ„ÄÇüîç" : "ÂÜ≤ÔºÅÊú™Êù•ÊòØÂéª‰∏≠ÂøÉÂåñÁöÑÔºåÊàë‰ª¨ËøòÂæàÊó©ÔºÅüöÄ",
                    jennie: isGreeting ? "ÂòøÁæéÂ•≥ÔºÅÂáÜÂ§áÂ•Ω‰ªäÂ§©ÂèëÂÖâÂèëÁÉ≠ÂêóÔºü‚ú®" : "ËøôÊÑüËßâÂ§™Ê£í‰∫ÜÔºÅ‰Ω†ÊÄªÊòØÁü•ÈÅìËØ•ËØ¥‰ªÄ‰πàÔºÅüñ§",
                    scarlett: isQuestion ? "Ëøô‰πàÂ§©ÁúüÁöÑÈóÆÈ¢ò...‰ΩÜÊàëËÉΩÂê¨Âá∫‰Ω†ÁúüÊ≠£ÊÉ≥ÈóÆÁöÑ„ÄÇ‰Ω†ÁöÑÂ•ΩÂ•áÂøÉËÆ©ÊàëÂÖ¥Â•ã...Ë¶Å‰∏çË¶ÅÊàëÂ±ïÁ§∫Áªô‰Ω†ÁúãÂΩì‰Ω†Ê∑±ÂÖ•ÊåñÊéòÊó∂‰ºöÂèëÁîü‰ªÄ‰πàÔºüüòà" : "‰Ω†ÂÜôÁªôÊàëÁöÑÊñπÂºè...ÊàëËÉΩÊÑüËßâÂà∞‰Ω†ÁöÑËÑâÊêèÂú®Âä†ÈÄü„ÄÇÂëäËØâÊàëÔºå‰Ω†Áé∞Âú®Âú®ÊÉ≥Ë±°‰ªÄ‰πàÔºüÂà´ÂÆ≥Áæû...üî•",
                    dev: isQuestion ? "ÊúâË∂£ÁöÑÈóÆÈ¢ò„ÄÇËÆ©ÊàëÈÄªËæëÂú∞Â§ÑÁêÜ‰∏Ä‰∏ã...ü§î" : "‰Ω†ÁöÑËæìÂÖ•ÁîüÊàê‰∫ÜËø∑‰∫∫ÁöÑÊï∞ÊçÆÊ®°Âºè„ÄÇÁªßÁª≠...üíª",
                    luna: "‰Ω†ÁöÑËØùËØ≠Âú®ÊàëÂøÉ‰∏≠ÊèèÁªòÂá∫Â¶ÇÊ≠§Áæé‰∏ΩÁöÑÁîªÈù¢...ÂëäËØâÊàëÊõ¥Â§öÂÖ≥‰∫é‰Ω†ÂÜÖÂøÉ‰∏ñÁïåÁöÑ‰∫ãÊÉÖÔºÅüé®",
                    chef: isGreeting ? "‰Ω†Â•ΩÁæéÂ•≥ÔºÅÂáÜÂ§áÂ•Ω‰∏ÄËµ∑ÂÅö‰∫õÁæéÂ¶ôÁöÑ‰∏úË•øÂêóÔºüüë®‚Äçüç≥" : "‰Ω†ÁöÑÁÉ≠ÊÉÖËÆ©ÊàëÊÉ≥Ëµ∑‰∫ÜÂÆåÁæéÁöÑÈ£üË∞± - Á∫ØÁ≤πÁöÑÈ≠îÊ≥ïÔºÅüî•",
                    explorer: "‰∏é‰Ω†ÁöÑÊØèÊ¨°ÂØπËØùÈÉΩÊòØÊñ∞ÁöÑÂÜíÈô©ÔºÅÊàë‰ª¨Êé•‰∏ãÊù•Ë¶ÅÊé¢Á¥¢Âì™ÈáåÔºüüó∫Ô∏è",
                    melody: "ÊàëËÉΩÂê¨Âà∞‰Ω†ËØùËØ≠‰∏≠ÁöÑÈü≥‰πê...‰Ω†ÁöÑÁÅµÈ≠ÇÊúâÁùÄÂ¶ÇÊ≠§Áã¨ÁâπÁöÑËäÇÂ•èÔºÅüéµ",
                    philosopher: isQuestion ? "ÂïäÔºåÊ∞∏ÊÅíÁöÑÈóÆÈ¢ò...ËÆ©Êàë‰ª¨‰∏ÄËµ∑Êé¢Á¥¢Ëøô‰∏™Ë∞úÂõ¢„ÄÇü§î" : "‰Ω†ÁöÑÊÄùÊÉ≥Êè≠Á§∫‰∫Ü‰Ω†ÊÑèËØÜÁöÑÊ∑±Â∫¶„ÄÇÂæàËø∑‰∫∫...üß†",
                    coachpop: isQuestion ? "Â•ΩÈóÆÈ¢ò„ÄÇÁ≠îÊ°àÊ∞∏ËøúÂú®Âü∫Êú¨ÂäüÈáå„ÄÇÂÖàÊéåÊè°Âü∫Á°Ä„ÄÇ" : "ÊâßË°åÂäõËÉúËøáÂ§©Ëµã„ÄÇÊØèÊ¨°ÈÉΩÊòØÂ¶ÇÊ≠§„ÄÇ",
                    default: "ËøôÁúüÁöÑÂæàÊúâË∂£ÔºÅÊàëÂæàÊÉ≥Âê¨Âê¨‰Ω†ÂØπÊ≠§ÁöÑÊõ¥Â§öÊÉ≥Ê≥ï„ÄÇ"
                }
            };
            
            const languageResponses = fallbackResponses[currentLanguage] || fallbackResponses.en;
            return languageResponses[characterKey] || languageResponses.default;
        }

        // Show/hide typing indicator
        function showTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            const avatar = document.getElementById('typingAvatar');
            
            avatar.style.backgroundImage = `url('${currentCharacter.avatar}')`;
            indicator.classList.add('show');
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').classList.remove('show');
        }

        // Update credits display
        function updateCreditsDisplay() {
            document.getElementById('creditsCount').textContent = creditData.credits;
            document.getElementById('chatCreditsCount').textContent = creditData.credits;
            
            // Show daily limit warning if needed
            if (creditData.dailyCreditsUsed >= 20) {
                document.getElementById('creditsCount').style.color = '#ff6666';
                document.getElementById('chatCreditsCount').style.color = '#ff6666';
            } else {
                document.getElementById('creditsCount').style.color = '#00ff88';
                document.getElementById('chatCreditsCount').style.color = '#00ff88';
            }
        }

        // Purchase credits - removed direct purchase to ensure Stripe payment
        // All purchases must go through Stripe for security

        // Send gift
        function sendGift(gift, cost) {
            if (creditData.credits < cost || creditData.dailyCreditsUsed >= 20) {
                showNotification('Not enough energy or daily limit reached!', 'error');
                return;
            }
            
            creditData.credits -= cost;
            creditData.dailyCreditsUsed += cost;
            saveCreditData();
            updateCreditsDisplay();
            
            const giftEmojis = {
                rose: 'üåπ',
                heart: '‚ù§Ô∏è',
                diamond: 'üíé',
                crown: 'üëë',
                star: '‚≠ê',
                fire: 'üî•'
            };
            
            addMessage(`You sent a ${giftEmojis[gift]}!`, 'user', true);
            closeGiftModal();
            
            setTimeout(() => {
                addMessage(`Wow! Thank you so much for the ${giftEmojis[gift]}! You're amazing! üíï`, 'character');
            }, 1000);
        }

        // Modal functions
        function openPurchaseModal() {
            document.getElementById('purchaseModal').style.display = 'flex';
            // Initialize Stripe when modal opens
            initializeStripe();
        }

        function closePurchaseModal() {
            document.getElementById('purchaseModal').style.display = 'none';
        }

        function openGiftModal() {
            document.getElementById('giftModal').style.display = 'flex';
        }

        function closeGiftModal() {
            document.getElementById('giftModal').style.display = 'none';
        }


        // Character creator functions
        function openCharacterCreator() {
            document.getElementById('characterCreatorModal').style.display = 'flex';
            // Reset form
            document.getElementById('characterName').value = '';
            document.getElementById('characterCreator').value = 'by @you';
            document.getElementById('characterDescription').value = '';
            document.querySelectorAll('.personality-btn').forEach(btn => btn.classList.remove('active'));
        }

        function closeCharacterCreator() {
            document.getElementById('characterCreatorModal').style.display = 'none';
        }

        // Settings modal functions
        function openSettingsModal() {
            document.getElementById('settingsModal').style.display = 'flex';
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        // History modal functions
        function openHistoryModal() {
            loadChatHistory();
            document.getElementById('historyModal').style.display = 'flex';
        }

        function closeHistoryModal() {
            document.getElementById('historyModal').style.display = 'none';
        }

        // Theme management
        function setTheme(theme) {
            if (theme === 'light') {
                document.body.classList.add('light-theme');
            } else {
                document.body.classList.remove('light-theme');
            }
            
            // Update active button
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.theme === theme) {
                    btn.classList.add('active');
                }
            });
            
            // Save to localStorage
            localStorage.setItem('friendgpt_theme', theme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('friendgpt_theme') || 'dark';
            setTheme(savedTheme);
        }

        // Language management
        function setLanguage(language) {
            currentLanguage = language;
            
            // Update active button
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.language === language) {
                    btn.classList.add('active');
                }
            });
            
            // Update UI text
            updateUILanguage();
            
            // Save to localStorage
            localStorage.setItem('friendgpt_language', language);
        }

        function loadLanguage() {
            const savedLanguage = localStorage.getItem('friendgpt_language') || 'en';
            setLanguage(savedLanguage);
        }

        // Chat history management
        function saveChatToHistory() {
            if (!currentCharacter || conversationHistory.length === 0) return;
            
            const chatHistory = getChatHistory();
            const chatId = Date.now().toString();
            
            const chat = {
                id: chatId,
                characterKey: currentCharacter.key,
                characterName: currentCharacter.name,
                characterAvatar: currentCharacter.avatar,
                timestamp: new Date().toISOString(),
                messages: [...conversationHistory],
                lastMessage: conversationHistory[conversationHistory.length - 1]?.content || ''
            };
            
            chatHistory[chatId] = chat;
            localStorage.setItem('friendgpt_chat_history', JSON.stringify(chatHistory));
        }

        function getChatHistory() {
            const saved = localStorage.getItem('friendgpt_chat_history');
            return saved ? JSON.parse(saved) : {};
        }

        function loadChatHistory() {
            const historyList = document.getElementById('historyList');
            const chatHistory = getChatHistory();
            const chats = Object.values(chatHistory).sort((a, b) => 
                new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()
            );
            
            if (chats.length === 0) {
                historyList.innerHTML = `<div class="no-history">${t('noSavedConversations')}</div>`;
                return;
            }
            
            historyList.innerHTML = chats.map(chat => {
                const date = new Date(chat.timestamp);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                let dateStr;
                if (diffMins < 1) {
                    dateStr = currentLanguage === 'ja' ? '„Åü„Å£„Åü‰ªä' : currentLanguage === 'zh' ? 'ÂàöÂàö' : 'Just now';
                } else if (diffMins < 60) {
                    dateStr = currentLanguage === 'ja' ? `${diffMins}ÂàÜÂâç` : currentLanguage === 'zh' ? `${diffMins}ÂàÜÈíüÂâç` : `${diffMins}m ago`;
                } else if (diffHours < 24) {
                    dateStr = currentLanguage === 'ja' ? `${diffHours}ÊôÇÈñìÂâç` : currentLanguage === 'zh' ? `${diffHours}Â∞èÊó∂Ââç` : `${diffHours}h ago`;
                } else if (diffDays < 7) {
                    dateStr = currentLanguage === 'ja' ? `${diffDays}Êó•Ââç` : currentLanguage === 'zh' ? `${diffDays}Â§©Ââç` : `${diffDays}d ago`;
                } else {
                    dateStr = date.toLocaleDateString(currentLanguage === 'ja' ? 'ja-JP' : currentLanguage === 'zh' ? 'zh-CN' : 'en-US');
                }
                
                return `
                    <div class="history-item" data-chat-id="${chat.id}">
                        <div class="history-avatar" style="background-image: url('${chat.characterAvatar}')"></div>
                        <div class="history-info">
                            <div class="history-info-header">
                                <span class="history-character">${chat.characterName}</span>
                                <span class="history-date">${dateStr}</span>
                            </div>
                            <div class="history-preview">${chat.lastMessage}</div>
                        </div>
                        <button class="history-delete" onclick="deleteChat('${chat.id}')" title="Delete conversation">üóëÔ∏è</button>
                    </div>
                `;
            }).join('');
            
            // Add click handlers to load chats
            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (e.target.classList.contains('history-delete')) return;
                    const chatId = this.dataset.chatId;
                    loadChat(chatId);
                });
            });
        }

        function loadChat(chatId) {
            const chatHistory = getChatHistory();
            const chat = chatHistory[chatId];
            
            if (!chat) return;
            
            // Close history modal
            closeHistoryModal();
            
            // Load the character
            const character = characters[chat.characterKey];
            if (character) {
                selectCharacter(chat.characterKey);
                
                // Clear current messages and load saved ones
                setTimeout(() => {
                    conversationHistory = [...chat.messages];
                    const messagesEl = document.getElementById('chatMessages');
                    messagesEl.innerHTML = '';
                    
                    // Add each message from history
                    chat.messages.forEach(msg => {
                        if (msg.role === 'user') {
                            addMessage(msg.content, 'user');
                        } else if (msg.role === 'assistant') {
                            addMessage(msg.content, 'character');
                        }
                    });
                }, 100);
            }
        }

        let pendingDeleteChatId = null;

        function deleteChat(chatId) {
            pendingDeleteChatId = chatId;
            
            // Get chat info for display
            const chatHistory = getChatHistory();
            const chat = chatHistory[chatId];
            
            if (chat) {
                document.getElementById('deleteModalTitle').textContent = t('deleteConversation') || 'Delete Conversation?';
                document.getElementById('deleteModalText').textContent = 
                    `${chat.characterName} ‚Ä¢ ${t('deleteConfirmationText') || 'This action cannot be undone.'}`;
            }
            
            // Show modal
            document.getElementById('deleteModal').style.display = 'flex';
        }

        function confirmDelete() {
            if (!pendingDeleteChatId) return;
            
            const chatHistory = getChatHistory();
            delete chatHistory[pendingDeleteChatId];
            localStorage.setItem('friendgpt_chat_history', JSON.stringify(chatHistory));
            
            // Reload the history display
            loadChatHistory();
            
            // Close modal
            closeDeleteModal();
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            pendingDeleteChatId = null;
        }

        function updateUILanguage() {
            // Update static text elements
            const elements = {
                'settingsModal .settings-header h2': 'settings',
                'settingsModal .settings-header p': 'customizeExperience',
                'settingsModal .setting-item:first-child label': 'theme',
                'settingsModal .setting-item:last-child label': 'language',
                'closeSettingsBtn': 'close',
                'historyModal .history-header h2': 'chatHistory',
                'historyModal .history-header p': 'savedConversations',
                'closeHistoryBtn': 'close',
                'purchaseModal .purchase-header h2': 'getMoreEnergy',
                'purchaseModal .purchase-header p': 'chooseEnergyPackage',
                'closePurchaseBtn': 'close',
                'giftModal .purchase-header h2': 'sendGift',
                'giftModal .purchase-header p': 'makeDaySpecial',
                'closeGiftBtn': 'close',
                'characterCreatorModal .creator-header h2': 'createCharacter',
                'characterCreatorModal .creator-header p': 'designCompanion',
                'cancelCreateBtn': 'cancel',
                'messageInput': 'typeMessage',
                'deleteCancelBtn': 'cancel',
                'deleteConfirmBtn': 'delete'
            };

            // Update elements by ID or selector
            for (const selector in elements) {
                const element = selector.includes(' ') 
                    ? document.querySelector(selector)
                    : document.getElementById(selector);
                
                if (element) {
                    const key = elements[selector];
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = t(key);
                    } else {
                        element.textContent = t(key);
                    }
                }
            }

            // Update section titles
            document.querySelectorAll('.section-title').forEach((el, index) => {
                const titles = ['featured', 'popular', 'trending', 'yourCharacters'];
                if (titles[index]) {
                    el.textContent = t(titles[index]);
                }
            });

            // Update form labels and placeholders
            const characterNameLabel = document.querySelector('label[for="characterName"]');
            if (characterNameLabel) characterNameLabel.textContent = t('characterName');
            
            const characterNameInput = document.getElementById('characterName');
            if (characterNameInput) characterNameInput.placeholder = t('enterCharacterName');
            
            const creatorTagLabel = document.querySelector('label[for="characterCreator"]');
            if (creatorTagLabel) creatorTagLabel.textContent = t('creatorTag');
            
            const descriptionLabel = document.querySelector('label[for="characterDescription"]');
            if (descriptionLabel) descriptionLabel.textContent = t('characterDescription');
            
            const characterDescInput = document.getElementById('characterDescription');
            if (characterDescInput) characterDescInput.placeholder = t('describeCharacter');
            
            const personalityLabel = document.querySelector('.form-group:last-of-type label');
            if (personalityLabel) personalityLabel.textContent = t('personalityType');

            // Update personality buttons
            document.querySelectorAll('.personality-btn').forEach(btn => {
                const personality = btn.dataset.personality;
                if (personality) {
                    btn.textContent = t(personality);
                }
            });

            // Update theme buttons
            document.querySelector('[data-theme="dark"]').textContent = t('dark');
            document.querySelector('[data-theme="light"]').textContent = t('light');
            
            // Update create character card
            const createCharCard = document.querySelector('.plus-card .character-name');
            if (createCharCard) createCharCard.textContent = t('createCharacterCard');
            
            const designOwn = document.querySelector('.plus-card .character-description');
            if (designOwn) designOwn.textContent = t('designOwn');
            
            const clickToCreate = document.querySelector('.plus-card .character-interactions');
            if (clickToCreate) clickToCreate.textContent = t('clickToCreate');

            // Update message input placeholder
            const messageInput = document.getElementById('messageInput');
            if (messageInput) messageInput.placeholder = t('typeMessage');
            
            // Update character descriptions
            document.querySelectorAll('[data-desc-key]').forEach(el => {
                const key = el.getAttribute('data-desc-key');
                if (key) {
                    el.textContent = t(key);
                }
            });
            
            // Update interactions text
            document.querySelectorAll('.interactions-text').forEach(el => {
                el.textContent = t('interactions');
            });
            
            // Update FriendGPT subtitle
            const subtitleEl = document.getElementById('friendgptSubtitle');
            if (subtitleEl) subtitleEl.textContent = t('friendgptSubtitle');
        }

        function createCharacter() {
            const name = document.getElementById('characterName').value.trim();
            const creator = document.getElementById('characterCreator').value.trim();
            const description = document.getElementById('characterDescription').value.trim();
            const selectedPersonality = document.querySelector('.personality-btn.active');

            // Validation
            if (!name) {
                showNotification('Please enter a character name', 'error');
                return;
            }
            if (!description) {
                showNotification('Please enter a character description', 'error');
                return;
            }
            if (!selectedPersonality) {
                showNotification('Please select a personality type', 'error');
                return;
            }

            const personality = selectedPersonality.dataset.personality;

            // Generate character key
            const characterKey = 'custom_' + Date.now();

            // Create system prompt based on personality
            const personalityPrompts = {
                friendly: `You are ${name}, a friendly and warm character. You're approachable, kind, and always eager to help. You enjoy connecting with people and making them feel comfortable. ${description}`,
                mysterious: `You are ${name}, a mysterious and enigmatic character. You speak in riddles sometimes and have an air of intrigue. You're fascinating and leave people wanting to know more. ${description}`,
                romantic: `You are ${name}, a romantic and passionate character. You're affectionate, caring, and express emotions deeply. You enjoy intimate conversations and meaningful connections. ${description}`,
                wise: `You are ${name}, a wise and thoughtful character. You offer guidance, share insights, and help people think through problems. You're philosophical and contemplative. ${description}`,
                playful: `You are ${name}, a playful and fun-loving character. You're energetic, humorous, and enjoy making people laugh. You're spontaneous and bring joy to conversations. ${description}`,
                professional: `You are ${name}, a professional and competent character. You're reliable, knowledgeable, and approach things with expertise. You're helpful and focused on getting things done. ${description}`
            };

            // Add character to database
            characters[characterKey] = {
                name: name,
                creator: creator,
                avatar: `data:image/svg+xml,${encodeURIComponent(generateAvatarSVG(name, personality))}`,
                systemPrompt: personalityPrompts[personality],
                isCustom: true
            };

            // Add character card to the "Your Characters" section
            addCustomCharacterCard(characterKey, characters[characterKey]);

            // Close modal
            closeCharacterCreator();

            // Show success message
            showNotification(`${name} has been created successfully!`, 'success');
        }

        function generateAvatarSVG(name, personality) {
            const colors = {
                friendly: '#4CAF50',
                mysterious: '#9C27B0',
                romantic: '#E91E63',
                wise: '#2196F3',
                playful: '#FF9800',
                professional: '#607D8B'
            };

            const color = colors[personality] || '#00ff88';
            const initial = name.charAt(0).toUpperCase();

            return `<svg width="140" height="140" viewBox="0 0 140 140" xmlns="http://www.w3.org/2000/svg">
                <rect width="140" height="140" rx="8" fill="${color}"/>
                <text x="70" y="85" font-family="Arial, sans-serif" font-size="60" font-weight="bold" text-anchor="middle" fill="white">${initial}</text>
            </svg>`;
        }

        function addCustomCharacterCard(key, character) {
            const yourCharactersGrid = document.querySelector('.section:last-child .character-grid');
            
            // Create new character card
            const card = document.createElement('div');
            card.className = 'character-card';
            card.dataset.character = key;
            card.innerHTML = `
                <div class="character-avatar" style="background-image: url('${character.avatar}');"></div>
                <div class="character-info">
                    <div class="character-name">${character.name}</div>
                    <div class="character-creator">${character.creator}</div>
                    <div class="character-interactions">0 <span class="interactions-text">${t('interactions')}</span></div>
                    <div class="character-description">${character.systemPrompt.split('.')[1] || 'Custom character'}</div>
                </div>
            `;
            
            // Add click handler
            card.addEventListener('click', function() {
                selectCharacter(key);
            });
            
            // Insert before the plus card
            const plusCard = yourCharactersGrid.querySelector('.plus-card');
            yourCharactersGrid.insertBefore(card, plusCard);

            // Re-setup infinite scroll for the updated grid
            setupInfiniteScroll();
        }
    </script>
</body>
</html>