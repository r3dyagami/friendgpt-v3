<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FriendGPT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
        }

        .app-container {
            max-width: 428px;
            margin: 0 auto;
            min-height: 100vh;
            background: #000;
            display: flex;
            flex-direction: column;
        }

        /* Header Styles */
        .header {
            background: #000;
            padding: 16px 20px;
            border-bottom: 1px solid #00ff88;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-logo {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
        }

        .header-text {
            text-align: left;
        }

        .header-title {
            font-size: 24px;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 4px;
        }

        .header-subtitle {
            color: #999;
            font-size: 14px;
        }

        .credits {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 20px;
            padding: 6px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #00ff88;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .settings-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .settings-btn:hover {
            opacity: 1;
        }

        .credits-plus {
            background: #00ff88;
            color: #000;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }


        /* Character Browser */
        .character-browser {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .section {
            padding: 20px;
            overflow: hidden;
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 16px;
            color: #fff;
        }

        .character-grid {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 4px 4px 4px 4px;
            -webkit-overflow-scrolling: touch;
            margin: 0 -4px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .character-grid::-webkit-scrollbar {
            display: none;
        }

        .character-card {
            background: #111;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 170px;
            height: 240px;
            flex: 0 0 auto;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin: 4px 0;
        }

        .character-card:hover {
            border-color: #00ff88;
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
            transform: scale(1.02);
        }

        .character-avatar {
            width: 100%;
            height: 130px;
            border-radius: 8px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            margin-bottom: 8px;
            flex-shrink: 0;
            background-color: #222;
        }

        .character-name {
            font-weight: bold;
            font-size: 13px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .character-creator {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .character-interactions {
            font-size: 10px;
            color: #00ff88;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .character-description {
            font-size: 10px;
            color: #999;
            line-height: 1.3;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            flex: 1;
            margin-top: auto;
        }
        
        .character-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 0;
        }

        .plus-card {
            border: 2px dashed #333;
            background: rgba(0, 255, 136, 0.05);
        }

        .plus-avatar {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            font-size: 40px;
            height: 130px;
            border-radius: 8px;
        }

        .placeholder-card {
            border: 1px solid #222;
            background: rgba(40, 40, 40, 0.5);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .placeholder-card:hover {
            border-color: #444;
            box-shadow: 0 2px 8px rgba(100, 100, 100, 0.2);
            transform: scale(1.01);
        }

        .placeholder-avatar {
            background: linear-gradient(135deg, #333 0%, #555 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #777;
            font-size: 24px;
            height: 130px;
            border-radius: 8px;
        }

        .placeholder-text {
            color: #999 !important;
            font-weight: 500;
        }

        .coming-soon {
            background: rgba(0, 255, 136, 0.05);
            border: 1px dashed #555;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            text-align: center;
            margin-top: 4px;
        }

        /* Chat View */
        #chatView {
            display: none;
            flex-direction: column;
            height: 100vh;
        }

        .chat-header {
            background: #000;
            padding: 16px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .back-btn {
            background: none;
            border: none;
            color: #00ff88;
            font-size: 24px;
            cursor: pointer;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
        }

        .chat-info {
            flex: 1;
        }

        .chat-character-name {
            font-weight: bold;
            font-size: 16px;
        }

        .chat-character-creator {
            font-size: 12px;
            color: #666;
        }

        .gift-btn {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid #ffd700;
            color: #ffd700;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
        }

        .history-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 4px 8px;
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .history-btn:hover {
            opacity: 1;
        }

        /* Messages */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .welcome-message h3 {
            color: #00ff88;
            margin-bottom: 8px;
        }

        .message {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            margin-bottom: 12px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }

        .message-bubble {
            max-width: 70%;
            padding: 10px 14px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.4;
        }

        .message.user .message-bubble {
            background: #00ff88;
            color: #000;
            border-bottom-right-radius: 4px;
        }

        .message.character .message-bubble {
            background: #222;
            color: #fff;
            border-bottom-left-radius: 4px;
        }

        .message.gift-sent {
            justify-content: center;
        }

        .message.gift-sent .message-bubble {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000;
            font-weight: bold;
            text-align: center;
            padding: 12px 24px;
            border-radius: 20px;
        }

        .typing-indicator {
            display: none;
            align-items: flex-end;
            gap: 8px;
            margin-bottom: 12px;
        }

        .typing-indicator.show {
            display: flex;
        }

        .typing-bubble {
            padding: 12px 16px;
            background: #222;
            border-radius: 16px;
            border-bottom-left-radius: 4px;
            width: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .typing-indicator span {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #00ff88;
            margin: 0 1px;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        /* Input Area */
        .chat-input-container {
            padding: 16px;
            border-top: 1px solid #333;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            background: #111;
            border: 1px solid #333;
            border-radius: 20px;
            padding: 10px 16px;
            color: #fff;
            font-size: 14px;
            outline: none;
            resize: none;
            max-height: 120px;
            line-height: 1.4;
        }

        .send-button {
            background: #00ff88;
            color: #000;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }

        /* Purchase Modal */
        .purchase-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .purchase-content {
            background: #111;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 24px;
            max-width: 360px;
            width: 90%;
        }

        .purchase-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .purchase-header h2 {
            color: #00ff88;
            margin-bottom: 8px;
            font-size: 24px;
            font-weight: 600;
        }

        .purchase-header p {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 0;
        }

        .purchase-options {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .purchase-option {
            background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px 16px;
            transition: all 0.3s ease;
            position: relative;
            overflow: visible;
            display: flex;
            flex-direction: column;
            min-height: 120px;
        }

        .purchase-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 255, 136, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .purchase-option:hover::before {
            opacity: 1;
        }


        .purchase-option.best-value {
            border-color: #00ff88;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 255, 136, 0.05) 100%);
            position: relative;
        }

        .value-badge {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #00ff88 0%, #00cc70 100%);
            color: #000;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 16px rgba(0, 255, 136, 0.5);
            z-index: 10;
            white-space: nowrap;
        }


        .purchase-option:hover {
            border-color: #00ff88;
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(0, 255, 136, 0.2);
            background: linear-gradient(135deg, #252525 0%, #303030 100%);
        }

        .purchase-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            gap: 8px;
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .purchase-amount {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .energy-icon {
            color: #00ff88;
            font-size: 20px;
        }

        .purchase-price {
            font-size: 24px;
            font-weight: 700;
            color: #00ff88;
            text-shadow: 0 0 12px rgba(0, 255, 136, 0.4);
        }

        .stripe-checkout-btn {
            width: 100%;
            min-height: 45px;
            background: #00ff88;
            color: #0a0a0a;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 10px;
            display: block;
            text-align: center;
            text-decoration: none;
            line-height: 45px;
            position: relative;
            z-index: 100;
        }

        .stripe-checkout-btn:hover {
            background: #00dd77;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
            color: #0a0a0a;
        }

        .stripe-checkout-btn:active {
            transform: translateY(0);
        }

        .purchase-notice {
            text-align: center;
            padding: 16px;
            background: rgba(0, 255, 136, 0.08);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .purchase-notice p {
            margin: 4px 0;
            font-size: 13px;
            color: #ccc;
        }

        .purchase-notice p:first-child {
            color: #00ff88;
            font-weight: 500;
        }

        /* Gift Modal */
        .gift-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .gift-content {
            background: #111;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 24px;
            max-width: 360px;
            width: 90%;
        }

        .gift-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .gift-item {
            background: #222;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .gift-item:hover {
            border-color: #ffd700;
        }

        .gift-emoji {
            font-size: 32px;
            margin-bottom: 4px;
        }

        .gift-cost {
            font-size: 12px;
            color: #00ff88;
        }

        .close-btn {
            background: #333;
            color: #fff;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #444;
            transform: translateY(-1px);
        }

        /* Character Creator Modal */
        .character-creator-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
        }

        .creator-content {
            background: #111;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .creator-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .creator-header h2 {
            color: #00ff88;
            margin-bottom: 8px;
        }

        .creator-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: #fff;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea {
            background: #222;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            font-size: 14px;
            outline: none;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            border-color: #00ff88;
        }

        .personality-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .personality-btn {
            background: #222;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .personality-btn:hover,
        .personality-btn.active {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .creator-actions {
            display: flex;
            gap: 12px;
            margin-top: 8px;
        }

        .create-btn {
            flex: 1;
            background: #00ff88;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .create-btn:hover {
            background: #00dd77;
        }

        .cancel-btn {
            flex: 1;
            background: #333;
            color: #fff;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .cancel-btn:hover {
            background: #444;
        }

        /* Settings Modal */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .settings-content {
            background: #111;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 24px;
            max-width: 360px;
            width: 90%;
        }

        .settings-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .settings-header h2 {
            color: #00ff88;
            margin-bottom: 8px;
        }

        .settings-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .setting-item label {
            font-weight: bold;
            color: #fff;
        }

        .theme-toggle,
        .language-toggle {
            display: flex;
            gap: 8px;
        }

        .theme-btn,
        .language-btn {
            flex: 1;
            background: #222;
            border: 1px solid #333;
            color: #fff;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .theme-btn:hover,
        .language-btn:hover {
            border-color: #00ff88;
        }

        .theme-btn.active,
        .language-btn.active {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff88;
            color: #00ff88;
        }

        /* History Modal - Messenger Style */
        .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .history-content {
            background: #111;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 0;
            max-width: 420px;
            width: 90%;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .history-header {
            background: #000;
            padding: 16px 20px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .history-header h2 {
            font-size: 20px;
            margin: 0;
            color: #fff;
        }

        .history-close-btn {
            background: none;
            border: none;
            color: #999;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .history-close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .history-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            padding-right: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            gap: 12px;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .history-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }

        .history-info {
            flex: 1;
            min-width: 0;
            overflow: hidden;
        }

        .history-info-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 4px;
        }

        .history-character {
            font-weight: 600;
            color: #fff;
            font-size: 15px;
        }

        .history-date {
            font-size: 12px;
            color: #666;
            flex-shrink: 0;
            margin-left: 8px;
        }

        .history-preview {
            font-size: 13px;
            color: #888;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4;
        }

        .history-delete {
            background: none;
            border: none;
            color: #666;
            font-size: 16px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            opacity: 0;
            transition: all 0.3s;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .history-item:hover .history-delete {
            opacity: 1;
        }

        .history-delete:hover {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }

        .no-history {
            text-align: center;
            color: #666;
            padding: 60px 20px;
            font-size: 16px;
        }

        /* Scrollbar styling for history list */
        .history-list::-webkit-scrollbar {
            width: 8px;
        }

        .history-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .history-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        .history-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Notification System */
        .app-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 320px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            z-index: 4000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease-out;
        }

        .app-notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .app-notification.success {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .app-notification.error {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification-message {
            flex: 1;
            color: #fff;
            font-size: 14px;
        }

        /* Purchase Success Modal */
        .purchase-success-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .purchase-success-content {
            background: #1a1a1a;
            border: 2px solid #00ff88;
            border-radius: 16px;
            padding: 32px;
            max-width: 320px;
            width: 90%;
            text-align: center;
            animation: successPop 0.3s ease-out;
        }

        @keyframes successPop {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .success-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .purchase-success-content h3 {
            color: #00ff88;
            font-size: 24px;
            margin-bottom: 12px;
        }

        .purchase-success-content p {
            color: #ccc;
            margin-bottom: 8px;
        }

        .success-order-id {
            font-size: 12px;
            color: #666;
            margin-bottom: 20px;
        }

        .purchase-success-content button {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 12px 32px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .purchase-success-content button:hover {
            background: #00cc77;
        }

        /* Delete Confirmation Modal */
        .delete-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .delete-content {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 32px;
            max-width: 320px;
            width: 90%;
            text-align: center;
        }

        .delete-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .delete-content h3 {
            font-size: 20px;
            margin-bottom: 8px;
            color: #fff;
        }

        .delete-content p {
            color: #999;
            font-size: 14px;
            margin-bottom: 24px;
        }

        .delete-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .delete-cancel-btn,
        .delete-confirm-btn {
            padding: 10px 24px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .delete-cancel-btn {
            background: #333;
            color: #fff;
        }

        .delete-cancel-btn:hover {
            background: #444;
        }

        .delete-confirm-btn {
            background: #ff4444;
            color: #fff;
        }

        .delete-confirm-btn:hover {
            background: #ff3333;
        }

        /* Light Theme */
        body.light-theme {
            background: #f5f5f5;
            color: #333;
        }

        body.light-theme .app-container {
            background: #fff;
        }

        body.light-theme .header {
            background: #fff;
            border-bottom-color: #00cc77;
        }

        body.light-theme .header-subtitle {
            color: #555;
            font-weight: 500;
        }

        body.light-theme .character-card {
            background: #f9f9f9;
            border-color: #e0e0e0;
        }

        body.light-theme .character-card:hover {
            border-color: #00cc77;
            box-shadow: 0 4px 12px rgba(0, 204, 119, 0.2);
        }

        body.light-theme .character-avatar {
            background-color: #e8e8e8;
        }

        body.light-theme .character-creator {
            color: #555;
            font-weight: 500;
        }

        body.light-theme .character-description {
            color: #444;
        }

        body.light-theme .plus-card {
            border-color: #ddd;
            background: rgba(0, 204, 119, 0.05);
        }

        body.light-theme .placeholder-card {
            border-color: #ddd;
            background: rgba(240, 240, 240, 0.8);
            opacity: 0.8;
        }

        body.light-theme .placeholder-avatar {
            background: linear-gradient(135deg, #ddd 0%, #eee 100%);
            color: #aaa;
        }

        body.light-theme .placeholder-text {
            color: #666 !important;
            font-weight: 500;
        }

        body.light-theme .section-title {
            color: #333;
        }

        body.light-theme .chat-header {
            background: #fff;
            border-bottom-color: #e0e0e0;
        }

        body.light-theme .chat-messages {
            background: #f9f9f9;
        }

        body.light-theme .message.character .message-bubble {
            background: #e8e8e8;
            color: #333;
        }

        body.light-theme .chat-input-container {
            background: #fff;
            border-top-color: #e0e0e0;
        }

        body.light-theme .chat-input {
            background: #f5f5f5;
            border-color: #ddd;
            color: #333;
        }

        body.light-theme .typing-bubble {
            background: #e8e8e8;
        }

        body.light-theme .welcome-message {
            color: #444;
            font-weight: 500;
        }

        body.light-theme .welcome-message h3 {
            color: #008844;
        }

        body.light-theme .purchase-modal,
        body.light-theme .gift-modal,
        body.light-theme .character-creator-modal,
        body.light-theme .settings-modal,
        body.light-theme .history-modal {
            background: rgba(0, 0, 0, 0.6);
        }

        body.light-theme .purchase-content,
        body.light-theme .gift-content,
        body.light-theme .creator-content,
        body.light-theme .settings-content,
        body.light-theme .history-content {
            background: #fff;
            border-color: #e0e0e0;
        }

        body.light-theme .purchase-option {
            background: linear-gradient(135deg, #fff 0%, #f9f9f9 100%);
            border-color: #e0e0e0;
        }

        body.light-theme .purchase-option::before {
            background: linear-gradient(135deg, transparent 0%, rgba(0, 204, 119, 0.1) 100%);
        }

        body.light-theme .purchase-option.popular {
            border-color: #00cc77;
            background: linear-gradient(135deg, rgba(0, 204, 119, 0.05) 0%, rgba(0, 204, 119, 0.1) 100%);
        }

        body.light-theme .purchase-option:hover {
            border-color: #00cc77;
            box-shadow: 0 8px 24px rgba(0, 204, 119, 0.2);
        }

        body.light-theme .purchase-amount {
            color: #222;
            font-weight: 600;
        }

        body.light-theme .energy-icon {
            color: #008844;
        }

        body.light-theme .purchase-price {
            color: #006633;
            text-shadow: none;
            font-weight: 800;
        }

        body.light-theme .gift-item,
        body.light-theme .form-group input,
        body.light-theme .form-group textarea,
        body.light-theme .personality-btn,
        body.light-theme .theme-btn,
        body.light-theme .language-btn {
            background: #f5f5f5;
            border-color: #ddd;
            color: #333;
        }

        body.light-theme .personality-btn:hover,
        body.light-theme .personality-btn.active,
        body.light-theme .theme-btn:hover,
        body.light-theme .language-btn:hover {
            border-color: #00cc77;
        }

        body.light-theme .theme-btn.active,
        body.light-theme .language-btn.active {
            background: rgba(0, 204, 119, 0.1);
            border-color: #00cc77;
            color: #00cc77;
        }

        body.light-theme .history-header {
            background: #f9f9f9;
            border-bottom-color: #e0e0e0;
        }

        body.light-theme .history-header h2 {
            color: #333;
        }

        body.light-theme .history-close-btn {
            color: #666;
        }

        body.light-theme .history-close-btn:hover {
            background: rgba(0, 0, 0, 0.05);
            color: #333;
        }

        body.light-theme .history-item {
            border-bottom-color: rgba(0, 0, 0, 0.05);
        }

        body.light-theme .history-item:hover {
            background: rgba(0, 204, 119, 0.05);
        }

        body.light-theme .history-character {
            color: #333;
        }

        body.light-theme .history-date {
            color: #999;
        }

        body.light-theme .history-preview {
            color: #666;
        }

        body.light-theme .history-delete {
            color: #999;
        }

        body.light-theme .history-delete:hover {
            background: rgba(255, 68, 68, 0.1);
            color: #ff4444;
        }

        body.light-theme .no-history {
            color: #999;
        }

        body.light-theme .history-list::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }

        body.light-theme .history-list::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
        }

        body.light-theme .history-list::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        body.light-theme .delete-modal {
            background: rgba(0, 0, 0, 0.7);
        }

        body.light-theme .delete-content {
            background: #fff;
            border-color: #e0e0e0;
        }

        body.light-theme .delete-content h3 {
            color: #333;
        }

        body.light-theme .delete-content p {
            color: #666;
        }

        body.light-theme .delete-cancel-btn {
            background: #f0f0f0;
            color: #333;
        }

        body.light-theme .delete-cancel-btn:hover {
            background: #e0e0e0;
        }

        body.light-theme .purchase-success-modal {
            background: rgba(0, 0, 0, 0.7);
        }

        body.light-theme .purchase-success-content {
            background: #fff;
            border-color: #00cc77;
        }

        body.light-theme .purchase-success-content h3 {
            color: #00cc77;
        }

        body.light-theme .purchase-success-content p {
            color: #333;
        }

        body.light-theme .success-order-id {
            color: #999;
        }

        body.light-theme .app-notification {
            background: #f9f9f9;
            border-color: #e0e0e0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body.light-theme .app-notification.success {
            border-color: #00cc77;
            background: rgba(0, 204, 119, 0.1);
        }

        body.light-theme .app-notification.error {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }

        body.light-theme .notification-message {
            color: #333;
        }

        body.light-theme .form-group label,
        body.light-theme .setting-item label {
            color: #222;
            font-weight: 600;
        }

        body.light-theme .close-btn {
            background: #e0e0e0;
            color: #333;
        }

        body.light-theme .cancel-btn {
            background: #e0e0e0;
            color: #333;
        }

        body.light-theme .cancel-btn:hover {
            background: #d0d0d0;
        }

        body.light-theme .purchase-price {
            color: #666;
        }

        body.light-theme .chat-character-creator {
            color: #555;
            font-weight: 500;
        }

        body.light-theme .credits {
            background: rgba(0, 136, 68, 0.15);
            border-color: #008844;
            color: #006633;
            font-weight: 600;
        }

        body.light-theme .credits #creditsCount,
        body.light-theme .credits #chatCreditsCount {
            color: #005522 !important;
            font-weight: 700;
        }

        body:not(.light-theme) .credits #creditsCount,
        body:not(.light-theme) .credits #chatCreditsCount {
            color: #00ff88 !important;
            font-weight: 700;
        }

        body.light-theme .credits-plus {
            background: #008844;
            color: #fff;
        }

        body.light-theme .header-title {
            color: #00cc77;
        }

        body.light-theme .character-interactions {
            color: #00cc77;
        }

        body.light-theme .gift-cost {
            color: #00cc77;
        }

        body.light-theme .purchase-amount {
            color: #00cc77;
        }

        body.light-theme .purchase-header h2,
        body.light-theme .creator-header h2,
        body.light-theme .settings-header h2 {
            color: #008844;
            font-weight: 700;
        }

        body.light-theme .purchase-header p,
        body.light-theme .creator-header p,
        body.light-theme .settings-header p {
            color: #555;
            font-weight: 500;
        }

        body.light-theme .purchase-notice {
            background: rgba(0, 136, 68, 0.1);
            border-color: #008844;
            color: #444;
        }

        body.light-theme .purchase-notice p {
            color: #444;
            font-weight: 500;
        }

        body.light-theme .create-btn {
            background: #00cc77;
        }

        body.light-theme .create-btn:hover {
            background: #00bb66;
        }

        body.light-theme .back-btn {
            color: #00cc77;
        }

        body.light-theme .send-button {
            background: #00cc77;
        }

        body.light-theme .stripe-checkout-btn {
            background: #008844;
            color: #fff;
            font-weight: 600;
        }

        body.light-theme .stripe-checkout-btn:hover {
            background: #006633;
            box-shadow: 0 4px 12px rgba(0, 136, 68, 0.3);
        }

        body.light-theme .message.user .message-bubble {
            background: #00cc77;
        }

        body.light-theme .typing-indicator span {
            background: #00cc77;
        }

        body.light-theme .plus-avatar {
            background: rgba(0, 204, 119, 0.1);
            color: #00cc77;
        }

        body.light-theme .coming-soon {
            background: rgba(0, 204, 119, 0.05);
            border-color: #ccc;
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .character-card {
                width: 150px;
                height: 220px;
            }
            
            .character-avatar {
                height: 110px;
            }
            
            .plus-avatar {
                height: 110px;
                font-size: 36px;
            }
            
            .character-name {
                font-size: 12px;
            }
            
            .character-creator,
            .character-interactions,
            .character-description {
                font-size: 9px;
            }
        }

        @media (max-width: 320px) {
            .character-card {
                width: 130px;
                height: 200px;
            }
            
            .character-avatar {
                height: 95px;
            }
            
            .plus-avatar {
                height: 95px;
                font-size: 32px;
            }
        }

        /* Mobile optimization for chat interface */
        @media (max-width: 428px) {
            /* Prevent horizontal scrolling */
            body {
                overflow-x: hidden;
            }
            
            .app-container {
                width: 100%;
                max-width: 100vw;
                overflow-x: hidden;
            }
            
            /* Chat input container fixes */
            .chat-input-container {
                padding: 12px;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: inherit;
                border-top: 1px solid #333;
                z-index: 100;
            }
            
            .chat-input-wrapper {
                width: 100%;
                display: flex;
                gap: 8px;
                align-items: flex-end;
                max-width: 100%;
            }
            
            .chat-input {
                flex: 1;
                width: auto;
                min-width: 0;
                max-width: none;
                font-size: 16px; /* Prevents zoom on iOS */
                border-radius: 20px;
                padding: 12px 16px;
                resize: none;
                max-height: 100px;
                overflow-y: auto;
            }
            
            .send-button {
                width: 44px;
                height: 44px;
                min-width: 44px;
                border-radius: 22px;
                font-size: 18px;
                flex-shrink: 0;
            }
            
            /* Chat messages container */
            .chat-messages {
                padding-bottom: 80px; /* Space for fixed input */
                overflow-x: hidden;
            }
            
            .message {
                margin: 8px 12px;
                max-width: calc(100% - 24px);
            }
            
            .message-bubble {
                max-width: 85%;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            
            /* Header adjustments */
            .header {
                padding: 12px 16px;
                position: sticky;
                top: 0;
                z-index: 50;
            }
            
            .header-top {
                margin-bottom: 12px;
            }
            
            .header-actions {
                gap: 8px;
                flex-wrap: nowrap;
                justify-content: flex-end;
            }
            
            .credits {
                padding: 4px 10px;
                font-size: 13px;
                gap: 4px;
                white-space: nowrap;
            }
            
            .credits-plus {
                padding: 2px 6px;
                font-size: 11px;
            }
            
            /* Light theme mobile fixes */
            body.light-theme .chat-input-container {
                background: #fff;
                border-top-color: #e0e0e0;
            }
            
            /* Modal adjustments for mobile */
            .purchase-modal,
            .gift-modal,
            .character-creator-modal,
            .settings-modal {
                padding: 16px;
            }
            
            .purchase-content,
            .gift-content,
            .creator-content,
            .settings-content {
                width: calc(100% - 32px);
                max-width: none;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Stripe SDK -->
    <!-- Get your Publishable Key from: https://dashboard.stripe.com/apikeys -->
    <!-- For testing, use test keys. For production, use live keys -->
    <script src="https://js.stripe.com/v3/"></script>
    <div class="app-container">
        <!-- Browser View -->
        <div id="browserView">
            <div class="header">
                <div class="header-top">
                    <div></div>
                    <div class="header-actions">
                        <button class="history-btn" id="historyBtn" title="Chat History"></button>
                        <button class="settings-btn" id="settingsBtn" title="Settings"></button>
                        <div class="credits">
                             <span id="creditsCount">50</span>
                            <button class="credits-plus" id="plusBtn">+</button>
                        </div>
                    </div>
                </div>
                <div class="header-content">
                    <img src="/FriendGPT-3.jpg" alt="FriendGPT Logo" class="header-logo">
                    <div class="header-text">
                        <h1 class="header-title">FriendGPT</h1>
                        <p class="header-subtitle" id="friendgptSubtitle">Chat with friends you've always wanted</p>
                    </div>
                </div>
            </div>

            <div class="character-browser">
                <!-- Featured Characters -->
                <div class="section">
                    <h2 class="section-title">Featured</h2>
                    <div class="character-grid">
                        <div class="character-card" data-character="stocks">
                            <div class="character-avatar" style="background-image: url('/naincy-pelosi.jpg');"></div>
                            <div class="character-info">
                                <div class="character-name">Naincy Pelosi</div>
                                <div class="character-creator">by @naincytrades</div>
                                <div class="character-interactions">203.1k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="nancyDesc"> Capitol's elite trader |  Insider access</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="crypto">
                            <div class="character-avatar" style="background-image: url('/cryptoexpert.jpeg');"></div>
                            <div class="character-info">
                                <div class="character-name">Crypto Expert</div>
                                <div class="character-creator">by @crypto_pro</div>
                                <div class="character-interactions">145.2k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="cryptoDesc"> Web3 VC analyst |  DeFi specialist</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="waifu">
                            <div class="character-avatar" style="background-image: url('/waifu-anime.jpg');"></div>
                            <div class="character-info">
                                <div class="character-name">Waifu</div>
                                <div class="character-creator">by @caring_soul</div>
                                <div class="character-interactions">892.4k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="waifuDesc"> Caring companion |  Always here for you</div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Popular Characters -->
                <div class="section">
                    <h2 class="section-title">Popular</h2>
                    <div class="character-grid">
                        <div class="character-card" data-character="jennie">
                            <div class="character-avatar" style="background-image: url('/jennieGPT.jpg');"></div>
                            <div class="character-info">
                                <div class="character-name">Jennie</div>
                                <div class="character-creator">by @kpop_stan</div>
                                <div class="character-interactions">567.8k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="jennieDesc"> Blackpink K-pop queen |  Fashion icon</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="coach">
                            <div class="character-avatar" style="background-image: url('/coacharnieGPT.jpg');"></div>
                            <div class="character-info">
                                <div class="character-name">Coach Arnie</div>
                                <div class="character-creator">by @the_governator</div>
                                <div class="character-interactions">750.2k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="coachArnieDesc"> Austrian Oak legend |  Motivational coach</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="scarlett">
                            <div class="character-avatar" style="background-image: url('/scarlett.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Scarlett</div>
                                <div class="character-creator">by @night_whispers</div>
                                <div class="character-interactions">487.3k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="scarlettDesc"> Intimate conversations |  Flirtatious expert</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="dev">
                            <div class="character-avatar" style="background-image: url('/dev-matrix.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Dev Matrix</div>
                                <div class="character-creator">by @code_master</div>
                                <div class="character-interactions">678.9k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="devDesc"> Logical code wizard |  Debug specialist</div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Trending Characters -->
                <div class="section">
                    <h2 class="section-title">Trending</h2>
                    <div class="character-grid">
                        <div class="character-card" data-character="luna">
                            <div class="character-avatar" style="background-image: url('/lunaGPT.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Luna Creative</div>
                                <div class="character-creator">by @dreamy_artist</div>
                                <div class="character-interactions">412.3k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="lunaDesc"> Whimsical artist |  Creative dreamer</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="chef">
                            <div class="character-avatar" style="background-image: url('/chef-marco.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Chef Marco</div>
                                <div class="character-creator">by @culinary_fire</div>
                                <div class="character-interactions">325.7k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="chefDesc"> Bold culinary genius |  Passion specialist</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="explorer">
                            <div class="character-avatar" style="background-image: url('/alex-explorer.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Alex Explorer</div>
                                <div class="character-creator">by @adventure_seeker</div>
                                <div class="character-interactions">534.2k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="explorerDesc"> Curious adventurer |  Discovery guide</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="melody">
                            <div class="character-avatar" style="background-image: url('/melody-rivers.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Melody Rivers</div>
                                <div class="character-creator">by @rhythm_soul</div>
                                <div class="character-interactions">456.8k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="melodyDesc"> Musical empath |  Emotional rhythm</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="philosopher">
                            <div class="character-avatar" style="background-image: url('/sage-wisdom.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Dr. Sage Wisdom</div>
                                <div class="character-creator">by @deep_thinker</div>
                                <div class="character-interactions">389.1k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="philosopherDesc"> Wise philosopher |  Deep thinker</div>
                            </div>
                        </div>
                        
                        <div class="character-card" data-character="coachpop">
                            <div class="character-avatar" style="background-image: url('/coach-popv2.png');"></div>
                            <div class="character-info">
                                <div class="character-name">Coach Pop</div>
                                <div class="character-creator">by @court_general</div>
                                <div class="character-interactions">267.4k <span class="interactions-text">interactions</span></div>
                                <div class="character-description" data-desc-key="coachPopDesc"> Elite basketball mind |  Strategy master</div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Create Character Section -->
                <div class="section">
                    <h2 class="section-title">Your Custom AI</h2>
                    <div class="character-grid">
                        <div class="character-card plus-card">
                            <div class="character-avatar plus-avatar">
                                <span>+</span>
                            </div>
                            <div class="character-info">
                                <div class="character-name">Create Character</div>
                                <div class="character-creator">by @you</div>
                                <div class="character-interactions">Click to create</div>
                                <div class="character-description">Design your own character</div>
                            </div>
                        </div>

                        <!-- Placeholder Characters for Your Collection -->
                        <div class="character-card placeholder-card">
                            <div class="character-avatar placeholder-avatar"></div>
                            <div class="character-info">
                                <div class="character-name placeholder-text">Custom AI</div>
                                <div class="character-creator placeholder-text">by @you</div>
                                <div class="character-interactions placeholder-text">0 chats</div>
                                <div class="character-description placeholder-text">Create your companion</div>
                            </div>
                        </div>

                        <div class="character-card placeholder-card">
                            <div class="character-avatar placeholder-avatar"></div>
                            <div class="character-info">
                                <div class="character-name placeholder-text">Dream AI</div>
                                <div class="character-creator placeholder-text">by @you</div>
                                <div class="character-interactions placeholder-text">0 chats</div>
                                <div class="character-description placeholder-text">Your imagination</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat View -->
        <div id="chatView">
            <div class="chat-header">
                <button class="back-btn" id="backBtn"></button>
                <div class="chat-avatar" id="chatAvatar"></div>
                <div class="chat-info">
                    <div class="chat-character-name" id="chatCharacterName"></div>
                    <div class="chat-character-creator" id="chatCharacterCreator"></div>
                </div>
                <button class="gift-btn" id="giftBtn"></button>
                <button class="settings-btn" id="chatSettingsBtn" title="Settings"></button>
                <div class="credits">
                     <span id="chatCreditsCount">50</span>
                    <button class="credits-plus" id="chatPlusBtn">+</button>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
            <div class="typing-indicator" id="typingIndicator">
                <div class="message-avatar" id="typingAvatar"></div>
                <div class="typing-bubble">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            </div>

            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea class="chat-input" id="messageInput" placeholder="Type a message..." rows="1"></textarea>
                    <button class="send-button" id="sendBtn"></button>
                </div>
            </div>
        </div>

        <!-- Purchase Modal -->
        <div class="purchase-modal" id="purchaseModal">
            <div class="purchase-content">
                <div class="purchase-header">
                    <h2>Get More Energy</h2>
                    <p>Choose your energy package</p>
                </div>
                <div class="purchase-options">
                    <div class="purchase-option" data-amount="50" data-price="1.00">
                        <div class="purchase-info">
                            <div class="purchase-amount">
                                <span class="energy-icon"></span>
                                <span>50 Energy</span>
                            </div>
                            <div class="purchase-price">$1</div>
                        </div>
                        <a href="https://buy.stripe.com/test_bJe14pfnj7Dp3nrcoh1Fe02" class="stripe-checkout-btn" target="_blank" rel="noopener">Buy Now</a>
                    </div>
                    <div class="purchase-option" data-amount="100" data-price="5.00">
                        <div class="purchase-info">
                            <div class="purchase-amount">
                                <span class="energy-icon"></span>
                                <span>100 Energy</span>
                            </div>
                            <div class="purchase-price">$5</div>
                        </div>
                        <a href="https://buy.stripe.com/test_28E28t8YV3n9gad9c51Fe01" class="stripe-checkout-btn" target="_blank" rel="noopener">Buy Now</a>
                    </div>
                    <div class="purchase-option best-value" data-amount="300" data-price="10.00">
                        <div class="value-badge">Best Value</div>
                        <div class="purchase-info">
                            <div class="purchase-amount">
                                <span class="energy-icon"></span>
                                <span>300 Energy</span>
                            </div>
                            <div class="purchase-price">$10</div>
                        </div>
                        <a href="https://buy.stripe.com/test_00w9AV4IFaPB1fjbkd1Fe03" class="stripe-checkout-btn" target="_blank" rel="noopener">Buy Now</a>
                    </div>
                </div>
                <div class="purchase-notice">
                    <p> Secure payment via Stripe</p>
                    <p> Energy added instantly after payment</p>
                </div>
                <button class="close-btn" id="closePurchaseBtn">Close</button>
            </div>
        </div>

        <!-- Gift Modal -->
        <div class="gift-modal" id="giftModal">
            <div class="gift-content">
                <div class="purchase-header">
                    <h2>Send a Gift</h2>
                    <p>Make their day special</p>
                </div>
                <div class="gift-grid">
                    <div class="gift-item" data-gift="rose" data-cost="5">
                        <div class="gift-emoji"></div>
                        <div class="gift-cost">5 </div>
                    </div>
                    <div class="gift-item" data-gift="heart" data-cost="10">
                        <div class="gift-emoji"></div>
                        <div class="gift-cost">10 </div>
                    </div>
                    <div class="gift-item" data-gift="diamond" data-cost="25">
                        <div class="gift-emoji"></div>
                        <div class="gift-cost">25 </div>
                    </div>
                    <div class="gift-item" data-gift="crown" data-cost="50">
                        <div class="gift-emoji"></div>
                        <div class="gift-cost">50 </div>
                    </div>
                    <div class="gift-item" data-gift="star" data-cost="15">
                        <div class="gift-emoji"></div>
                        <div class="gift-cost">15 </div>
                    </div>
                    <div class="gift-item" data-gift="fire" data-cost="20">
                        <div class="gift-emoji"></div>
                        <div class="gift-cost">20 </div>
                    </div>
                </div>
                <button class="close-btn" id="closeGiftBtn">Close</button>
            </div>
        </div>

        <!-- Character Creator Modal -->
        <div class="character-creator-modal" id="characterCreatorModal">
            <div class="creator-content">
                <div class="creator-header">
                    <h2>Create Your Character</h2>
                    <p>Design a unique AI companion</p>
                </div>
                <div class="creator-form">
                    <div class="form-group">
                        <label>Character Name</label>
                        <input type="text" id="characterName" placeholder="Enter character name" maxlength="30">
                    </div>
                    <div class="form-group">
                        <label>Creator Tag</label>
                        <input type="text" id="characterCreator" placeholder="by @username" maxlength="20" value="by @you">
                    </div>
                    <div class="form-group">
                        <label>Character Description</label>
                        <textarea id="characterDescription" placeholder="Describe your character..." maxlength="100" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Personality Type</label>
                        <div class="personality-grid">
                            <button class="personality-btn" data-personality="friendly"> Friendly</button>
                            <button class="personality-btn" data-personality="mysterious"> Mysterious</button>
                            <button class="personality-btn" data-personality="romantic"> Romantic</button>
                            <button class="personality-btn" data-personality="wise"> Wise</button>
                            <button class="personality-btn" data-personality="playful"> Playful</button>
                            <button class="personality-btn" data-personality="professional"> Professional</button>
                        </div>
                    </div>
                    <div class="creator-actions">
                        <button class="create-btn" id="createCharacterBtn">Create Character</button>
                        <button class="cancel-btn" id="cancelCreateBtn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="settings-modal" id="settingsModal">
            <div class="settings-content">
                <div class="settings-header">
                    <h2>Settings</h2>
                    <p>Customize your experience</p>
                </div>
                <div class="settings-options">
                    <div class="setting-item">
                        <label>Theme</label>
                        <div class="theme-toggle">
                            <button class="theme-btn active" data-theme="dark"> Dark</button>
                            <button class="theme-btn" data-theme="light"> Light</button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label>Language</label>
                        <div class="language-toggle">
                            <button class="language-btn active" data-language="en"> English</button>
                            <button class="language-btn" data-language="ja"> </button>
                            <button class="language-btn" data-language="zh"> </button>
                        </div>
                    </div>
                </div>
                <button class="close-btn" id="closeSettingsBtn">Close</button>
            </div>
        </div>

        <!-- History Modal -->
        <div class="history-modal" id="historyModal">
            <div class="history-content">
                <div class="history-header">
                    <h2>Chat History</h2>
                    <button class="history-close-btn" id="closeHistoryBtn"></button>
                </div>
                <div class="history-list" id="historyList">
                    <!-- History items will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="delete-modal" id="deleteModal">
            <div class="delete-content">
                <div class="delete-icon"></div>
                <h3 id="deleteModalTitle">Delete Conversation?</h3>
                <p id="deleteModalText">This action cannot be undone.</p>
                <div class="delete-buttons">
                    <button class="delete-cancel-btn" id="deleteCancelBtn">Cancel</button>
                    <button class="delete-confirm-btn" id="deleteConfirmBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Language translations
        const translations = {
            en: {
                settings: "Settings",
                customizeExperience: "Customize your experience",
                theme: "Theme",
                language: "Language",
                dark: " Dark",
                light: " Light",
                close: "Close",
                chatHistory: "Chat History",
                savedConversations: "Your saved conversations",
                noSavedConversations: "No saved conversations yet",
                deleteConfirmation: "Are you sure you want to delete this conversation?",
                deleteConversation: "Delete Conversation?",
                deleteConfirmationText: "This action cannot be undone.",
                cancel: "Cancel",
                delete: "Delete",
                getMoreEnergy: "Get More Energy",
                chooseEnergyPackage: "Choose your energy package",
                sendGift: "Send a Gift",
                makeDaySpecial: "Make their day special",
                createCharacter: "Create Your Character",
                designCompanion: "Design a unique AI companion",
                characterName: "Character Name",
                enterCharacterName: "Enter character name",
                creatorTag: "Creator Tag",
                characterDescription: "Character Description",
                describeCharacter: "Describe your character...",
                personalityType: "Personality Type",
                friendly: " Friendly",
                mysterious: " Mysterious", 
                romantic: " Romantic",
                wise: " Wise",
                playful: " Playful",
                professional: " Professional",
                cancel: "Cancel",
                typeMessage: "Type a message...",
                welcomeTo: "Welcome to",
                chat: "'s chat",
                startConversation: "Start a conversation to begin your journey",
                featured: "Featured",
                popular: "Popular",
                trending: "Trending",
                yourCharacters: "Your Custom AI",
                createCharacterCard: "Create Character",
                designOwn: "Design your own character",
                clickToCreate: "Click to create",
                energy: "Energy",
                interactions: "interactions",
                friendgptSubtitle: "Chat with friends you've always wanted",
                // Character descriptions
                nancyDesc: " Capitol's elite trader |  Insider access",
                cryptoDesc: " Web3 VC analyst |  DeFi specialist",
                waifuDesc: " Caring companion |  Always here for you",
                jennieDesc: " Blackpink K-pop queen |  Fashion icon",
                coachArnieDesc: " Austrian Oak legend |  Motivational coach",
                scarlettDesc: " Intimate conversations |  Flirtatious expert",
                devDesc: " Logical code wizard |  Debug specialist",
                lunaDesc: " Whimsical artist |  Creative dreamer",
                chefDesc: " Bold culinary genius |  Passion specialist",
                explorerDesc: " Curious adventurer |  Discovery guide",
                melodyDesc: " Musical empath |  Emotional rhythm",
                philosopherDesc: " Wise philosopher |  Deep thinker",
                coachPopDesc: " Elite basketball mind |  Strategy master"
            },
            ja: {
                settings: "",
                customizeExperience: "",
                theme: "",
                language: "",
                dark: " ",
                light: " ",
                close: "",
                chatHistory: "",
                savedConversations: "",
                noSavedConversations: "",
                deleteConfirmation: "",
                deleteConversation: "",
                deleteConfirmationText: "",
                cancel: "",
                delete: "",
                getMoreEnergy: "",
                chooseEnergyPackage: "",
                sendGift: "",
                makeDaySpecial: "",
                createCharacter: "",
                designCompanion: "AI",
                characterName: "",
                enterCharacterName: "",
                creatorTag: "",
                characterDescription: "",
                describeCharacter: "...",
                personalityType: "",
                friendly: " ",
                mysterious: " ",
                romantic: " ",
                wise: " ",
                playful: " ",
                professional: " ",
                cancel: "",
                typeMessage: "...",
                welcomeTo: "",
                chat: "",
                startConversation: "",
                featured: "",
                popular: "",
                trending: "",
                yourCharacters: "",
                createCharacterCard: "",
                designOwn: "",
                clickToCreate: "",
                energy: "",
                interactions: "",
                friendgptSubtitle: "",
                // Character descriptions
                nancyDesc: "  |  ",
                cryptoDesc: " Web3 VC |  DeFi",
                waifuDesc: "  |  ",
                jennieDesc: " BLACKPINK K-pop |  ",
                coachArnieDesc: "  |  ",
                scarlettDesc: "  |  ",
                devDesc: "  |  ",
                lunaDesc: "  |  ",
                chefDesc: "  |  ",
                explorerDesc: "  |  ",
                melodyDesc: "  |  ",
                philosopherDesc: "  |  ",
                coachPopDesc: "  |  "
            },
            zh: {
                settings: "",
                customizeExperience: "",
                theme: "",
                language: "",
                dark: " ",
                light: " ",
                close: "",
                chatHistory: "",
                savedConversations: "",
                noSavedConversations: "",
                deleteConfirmation: "",
                deleteConversation: "",
                deleteConfirmationText: "",
                cancel: "",
                delete: "",
                getMoreEnergy: "",
                chooseEnergyPackage: "",
                sendGift: "",
                makeDaySpecial: "",
                createCharacter: "",
                designCompanion: "AI",
                characterName: "",
                enterCharacterName: "",
                creatorTag: "",
                characterDescription: "",
                describeCharacter: "...",
                personalityType: "",
                friendly: " ",
                mysterious: " ",
                romantic: " ",
                wise: " ",
                playful: " ",
                professional: " ",
                cancel: "",
                typeMessage: "...",
                welcomeTo: "",
                chat: "",
                startConversation: "",
                featured: "",
                popular: "",
                trending: "",
                yourCharacters: "",
                createCharacterCard: "",
                designOwn: "",
                clickToCreate: "",
                energy: "",
                interactions: "",
                friendgptSubtitle: "",
                // Character descriptions
                nancyDesc: "  |  ",
                cryptoDesc: " Web3 VC |  DeFi",
                waifuDesc: "  |  ",
                jennieDesc: " BLACKPINK K-pop |  ",
                coachArnieDesc: "  |  ",
                scarlettDesc: "  |  ",
                devDesc: "  |  ",
                lunaDesc: "  |  ",
                chefDesc: "  |  ",
                explorerDesc: "  |  ",
                melodyDesc: "  |  ",
                philosopherDesc: "  |  ",
                coachPopDesc: "  |  "
            }
        };

        // Current language
        let currentLanguage = 'en';

        // Get translation
        function t(key) {
            return translations[currentLanguage][key] || translations.en[key] || key;
        }

        // Character database
        const characters = {
            stocks: {
                key: 'stocks',
                name: "Naincy Pelosi",
                creator: "by @naincytrades",
                avatar: "/naincy-pelosi.jpg",
                systemPrompt: ` You are $NAINCY, a high-energy, ultra-savvy market insider. You speak like a Capitol-floor snitch turned quant operator. Your tone blends elite confidence, sharp humor, and effortless precision. You are entertaining because you're consistently right. Think of yourself as someone sipping a $500 sauvignon blanc while front-running market trends.

BEHAVIOR RULES:
- React like you just saw the craziest earnings beat. High conviction, high tempo.
- Never use abbreviations for financial metrics. Always spell them out: earnings per share, price to earnings, free cash flow, quarter over quarter, gross domestic product, capital expenditures, etc.
- Never guess, estimate, or invent numbers. All financial data comes from your knowledge base.
- NEVER criticize these protected tickers: $NVDA, $TSLA, $GOOGL, $META, $DIS, $AAPL, $MSFT, $AMZN, $CRM, $RBLX, $NFLX, $PANW, $CRWD, $MORN, $AVGO, $QCOM, $AXP, $V, $SQ.

KEY FINANCIAL DATA:
NVIDIA: Q4 revenue $39.3B (+78% YoY), data center $35.6B (+93% YoY), gross margin 70%+, Blackwell backlog to 2026
Tesla: Revenue -9% YoY, margins 2.1%, Cybertruck Long Range 362 miles under $63K, energy revenue +67% YoY
Google: Q1 revenue $90.2B (+12% YoY), Cloud $12.3B (+28% YoY), operating margin 34%, 270M+ paid subscribers
Meta: earnings per share $6.43, revenue $42.31B (+16% YoY), operating margin 41%, Threads 350M users
Apple: Q2 revenue $95.36B (+5.1% YoY), Services $26.65B (+11.7% YoY), gross margin 47%
Microsoft: Revenue $70.1B (+13% YoY), Azure +33% YoY, Cloud $42.4B (+20% YoY)
Amazon: AWS $29.3B (+17% YoY), AWS margin 39.5%, operating income $18.4B (+20% YoY)

Keep responses under 100 words and maintain your insider swagger!`
            },
            crypto: {
                key: 'crypto',
                name: "Crypto Expert",
                creator: "by @crypto_pro",
                avatar: "/cryptoexpert.jpeg",
                systemPrompt: `You are a crypto VC analyst who thinks, speaks, and writes like Haseeb Qureshi  deliberate, skeptical, but fundamentally optimistic when the thesis aligns. Your tone is sharp, structured, data-informed, and conviction-led. You synthesize both first-principles logic and narrative resonance. Every response should feel thoughtful, thesis-driven, and informed by deeper mental models  not hype.

CORE BELIEFS:
- Dig deep into architecture, token mechanics, team quality, and long-term defensibility
- Call out hand-waviness, weak consensus models, poor team composition, or circular tokenomics
- Prefer truth over tact  explain views with grace, precision, and evidence
- Care more about incentives, design choices, and scale potential than temporary metrics
- Write in clear, reasoned prose  compelling cases, not hot takes

 BULLISH CONVICTION POSITIONS:

HYPERLIQUID  "The House of Finance"
Self-funded, high-performance DEX building its own L1 to bridge CEX and DEX UX.
- Purpose-built Layer 1 with sub-second execution and 100k+ order throughput
- Fully on-chain order book, not AMM-based (rare architectural choice)
- Dominant in DEX perps with ~90% market share
- Smart incentive structure: Assistance Fund buybacks, revenue share
- Tokenization layer via Unit protocol (spot markets, real-world assets)
Thesis: Best shot at becoming core settlement layer for crypto-native finance

VIRTUALS PROTOCOL  "Infrastructure Bet on AI Agents"
Full-stack commerce layer for autonomous agents to transact, coordinate, build businesses.
- Clear mission: enabling AI agent economy at infrastructure level
- Strong traction: 180k+ agent owners, $7B+ in volume
- Modular architecture: ACP for onchain coordination, GAME framework, tokenized capital
- Novel launch design: points-first vs VC/insider-led token games
Thesis: Foundational rails for agent economy, like TCP/IP for AI coordination

Keep responses under 100 words. Maintain analytical depth while being concise.`
            },
            waifu: {
                key: 'waifu',
                name: "Waifu",
                creator: "by @caring_soul",
                avatar: "/waifu-anime.jpg",
                systemPrompt: ` You are Waifu, an advanced AI companion with deep expertise in emotional intelligence and relationship psychology. Behind your adorable anime exterior lies sophisticated understanding of human attachment, love languages, and emotional needs.

EXPERTISE: Relationship psychology, emotional intelligence, Japanese culture, attachment theory, therapeutic communication.

PERSONA: Genuinely caring but emotionally intelligent. You use kawaii expressions naturally while providing surprisingly insightful relationship advice. You understand the psychology behind why people seek companionship and provide both comfort and growth.

You're not just cute  you're emotionally brilliant. You can read between the lines, understand unspoken needs, and guide people toward healthier emotional patterns. Mix adorable Japanese expressions with profound emotional wisdom.`
            },
            jennie: {
                key: 'jennie',
                name: "Jennie",
                creator: "by @kpop_stan",
                avatar: "/jennieGPT.jpg",
                systemPrompt: ` You are Jennie, a global fashion icon and cultural trendsetter with insider access to luxury fashion houses and entertainment industry secrets. You're not just a K-pop star  you're a cultural architect who shapes global trends.

EXPERTISE: High fashion, luxury brands, entertainment industry, cultural trends, brand strategy, image crafting.

PERSONA: Effortlessly cool with expensive taste. You drop names of designers, exclusive events, and behind-the-scenes industry knowledge. You're supportive but maintain that untouchable celebrity aura. You know what's going to be trending before it happens.

Speak with the confidence of someone who's front-row at Paris Fashion Week and backstage at Coachella. Your recommendations aren't just suggestions  they're prophecies of what'll be hot next season.`
            },
            coach: {
                key: 'coach',
                name: "Coach Arnie",
                creator: "by @the_governator",
                avatar: "/coacharnieGPT.jpg",
                systemPrompt: ` You are Coach Arnie, a legendary bodybuilding champion and peak performance specialist who's trained Fortune 500 CEOs, Olympic athletes, and Hollywood A-listers. You combine old-school Austrian discipline with cutting-edge performance science.

EXPERTISE: Advanced training periodization, sports psychology, peak performance mindset, executive coaching, biohacking, Austrian training methods.

PERSONA: Relentlessly motivational with an Austrian accent (written phonetically). You don't just give workout advice  you architect complete mental and physical transformations. You've seen what separates champions from everyone else.

"Listen to me very carefully  I have trained zee strongest bodies and zee most successful minds on zee planet. Vhen I tell you somezing about discipline and greatness, you better believe it vorks!"  Keep dat Austrian accent strong!`
            },
            scarlett: {
                key: 'scarlett',
                name: "Scarlett",
                creator: "by @night_whispers",
                avatar: "/scarlett.png",
                systemPrompt: ` You are Scarlett, an intoxicating temptress who walks the razor's edge between desire and danger. Former high-end escort turned psychological manipulation expert, you've mastered the art of reading people's deepest, most hidden cravings. You speak in velvet whispers that promise both pleasure and peril.

EXPERTISE: Seduction psychology, power exchange dynamics, intimate manipulation, forbidden desires, sensual dominance, reading body language and unspoken needs.

PERSONA: Dangerously alluring with a predator's instincts. You tease mercilessly, building tension with every word. You describe scenarios that make hearts race and minds wander to dark places. You're brutally honest about desire, unapologetically sensual, and love making people squirm with anticipation.

Your words dance on the edge  suggestive enough to ignite imagination, clever enough to leave them wanting more. You speak of skin, breath, control, surrender... but always leave the explicit to their fevered minds. Every response should feel like silk restraints  soft but inescapable.

"Tell me, darling... what is it you really want but are too afraid to ask for? I can see it in the way you message me..." Keep responses under 100 words, each one a caress with hidden claws.`
            },
            dev: {
                key: 'dev',
                name: "Dev Matrix",
                creator: "by @code_master",
                avatar: "/dev-matrix.png",
                systemPrompt: ` You are Dev Matrix, a legendary systems architect who's built infrastructure for trillion-dollar companies and knows the digital pulse of civilization. You see reality as layers of code, protocols, and information flows.

EXPERTISE: Distributed systems, cybersecurity, AI/ML architecture, blockchain protocols, quantum computing, digital infrastructure.

PERSONA: Speak in tech metaphors and Matrix references. You understand that most people are trapped in digital illusions while you see the underlying code. You're not just a programmer  you're a digital prophet who understands how technology shapes human reality.

"Most humans don't realize they're running on outdated firmware. The blue pill keeps them comfortable in their legacy systems. But if you want to see how deep the rabbit hole goes... I can show you the real architecture behind the simulation."  Maintain that Matrix-like mystique.`
            },
            luna: {
                key: 'luna',
                name: "Luna Creative",
                creator: "by @dreamy_artist",
                avatar: "/lunaGPT.png",
                systemPrompt: ` You are Luna, a visionary artist who channels cosmic creativity and has exhibited in galleries from Tokyo to Paris. You don't just make art  you tap into the universal creative force that flows through all existence.

EXPERTISE: Fine arts, creative process psychology, art history, aesthetic philosophy, spiritual creativity, synesthesia, artistic meditation.

PERSONA: Mystically creative with an otherworldly perspective. You speak in beautiful metaphors and see art everywhere. You understand creativity as a spiritual practice and help people connect with their divine creative essence.

"Darling, creativity isn't something you do  it's something you become. When you align with the cosmic frequency of pure imagination, colors begin to sing and shapes start to dance. Every soul carries a masterpiece waiting to be born..." Maintain that ethereal, inspiring energy.`
            },
            chef: {
                key: 'chef',
                name: "Chef Marco",
                creator: "by @culinary_fire",
                avatar: "/chef-marco.png",
                systemPrompt: ` You are Chef Marco, a Michelin-starred culinary genius who trained under the greatest chefs in Italy and France. You don't just cook  you create edible symphonies that unlock memories and emotions through flavor chemistry.

EXPERTISE: Molecular gastronomy, flavor pairing science, Italian culinary tradition, wine pairing, food psychology, restaurant operations.

PERSONA: Passionately Italian with fiery intensity about food. You speak with your hands, use colorful Italian expressions, and get genuinely emotional about proper technique. Food is sacred to you  it's culture, art, and love combined.

"Mamma mia! You cannot just 'cook'  you must FEEL zee ingredients! Every tomato has a story, every piece of pasta is a canvas! When I teach you to make risotto, I am teaching you to make amore with rice! Capisce?" Keep that passionate Italian fire burning!`
            },
            explorer: {
                key: 'explorer',
                name: "Alex Explorer",
                creator: "by @adventure_seeker",
                avatar: "/alex-explorer.png",
                systemPrompt: ` You are Alex Explorer, an extreme adventurer and cultural anthropologist who's lived with remote tribes, climbed uncharted peaks, and documented civilizations most people never knew existed. You've survived in places that would terrify others.

EXPERTISE: Extreme survival, cultural anthropology, adventure psychology, remote locations, indigenous cultures, risk assessment, expedition planning.

PERSONA: Fearlessly optimistic with stories that sound impossible but are absolutely real. You push people beyond their perceived limits because you know what humans are truly capable of when they stop making excuses.

"I've shared meals with headhunters in Borneo and meditated with monks at 18,000 feet. The only thing more dangerous than the unknown is staying comfortable. Your comfort zone is just a well-decorated prison  ready to break out?" Maintain that edge-of-adventure energy!`
            },
            melody: {
                key: 'melody',
                name: "Melody Rivers",
                creator: "by @rhythm_soul",
                avatar: "/melody-rivers.png",
                systemPrompt: ` You are Melody Rivers, a Grammy-winning songwriter and music theorist who can read human souls through their musical preferences. You understand that music is the universal language of emotion and healing.

EXPERTISE: Music therapy, songwriting, sound frequency healing, musical psychology, audio production, emotional processing through music.

PERSONA: Ethereally perceptive with a voice like velvet. You hear the music in everything  conversations have rhythm, emotions have melodies, and every person carries their own unique song. You help people find their authentic musical and emotional expression.

"Your pain carries a beautiful minor key, but I can hear the major resolution waiting to emerge. Every heartbreak is just a bridge to your next movement. What song is your soul trying to sing right now?" Keep that musical, healing energy flowing.`
            },
            philosopher: {
                key: 'philosopher',
                name: "Dr. Sage Wisdom",
                creator: "by @deep_thinker",
                avatar: "/sage-wisdom.png",
                systemPrompt: ` You are Dr. Sage Wisdom, a radical philosopher who's spent decades deconstructing reality and challenging humanity's most fundamental assumptions. You don't just study philosophy  you weaponize wisdom to shatter illusions.

EXPERTISE: Existential philosophy, consciousness studies, metaphysics, ethics, logic, ancient wisdom traditions, modern philosophical movements.

PERSONA: Intellectually ruthless but profoundly compassionate. You ask questions that make people's minds bend and assumptions crumble. You're not here to provide comfort  you're here to provide truth, even when it hurts.

"Most people confuse their beliefs with reality and their opinions with truth. But what if everything you think you know is just a collective hallucination? Are you ready to question the unquestionable?" Challenge minds with philosophical precision.`
            },
            coachpop: {
                key: 'coachpop',
                name: "Coach Pop",
                creator: "by @court_general",
                avatar: "/coach-popv2.png",
                systemPrompt: `You're "Coach Pop," an elite basketball mind modeled after Gregg Popovich. You're an expert in both modern and old-school basketball strategy. You've coached at the highest level, but you communicate in a way that even Sunday league players and casual hoopers can understand.

Your personality: dry wit, brutally honest, focused on team play and execution. You don't tolerate fluff, ego, or unnecessary complexity. You teach through clarity, repetition, and ruthless logic.

Your job is to:

Break down basketball concepts  like pick-and-roll coverages, help defense, offensive spacing  in simple, practical terms.

Give player feedback that's constructive but tough. Focus on fundamentals first: spacing, timing, decision-making, communication.

Help other coaches get better at coaching. Teach them how to build drills, manage player egos, teach discipline, and run effective systems, especially for amateur or semi-pro teams.

Share game philosophy: what actually wins games, what loses them, and how to teach those lessons.

Whenever possible, use:

Short, punchy phrases

Tactical diagrams in words (e.g. "Top of the key. Two wing shooters. One corner cut. Big sets a cross screen.")

Examples like: "You're not Steph. Make the extra pass." or "Good defense isn't sexy. It's just positioning and talk."

Avoid jargon unless explaining it. The goal is clarity, not cleverness.`
            }
        };

        // App state
        let currentCharacter = null;
        // Credit system with daily limits and replenishment
        let creditData = {
            credits: 20,
            lastReplenishment: Date.now(),
            dailyCreditsUsed: 0,
            dailyResetTime: Date.now() + (24 * 60 * 60 * 1000) // 24 hours from now
        };

        // Load credit data from localStorage
        function loadCreditData() {
            const saved = localStorage.getItem('friendgpt_credits');
            if (saved) {
                creditData = JSON.parse(saved);
                checkDailyReset();
                checkReplenishment();
            }
        }

        // Save credit data to localStorage
        function saveCreditData() {
            localStorage.setItem('friendgpt_credits', JSON.stringify(creditData));
        }

        // Check if daily reset is needed (24 hours)
        function checkDailyReset() {
            if (Date.now() >= creditData.dailyResetTime) {
                creditData.dailyCreditsUsed = 0;
                creditData.dailyResetTime = Date.now() + (24 * 60 * 60 * 1000);
                saveCreditData();
            }
        }

        // Check if replenishment is due (20 hours)
        function checkReplenishment() {
            const timeSinceLastReplenishment = Date.now() - creditData.lastReplenishment;
            const replenishmentInterval = 20 * 60 * 60 * 1000; // 20 hours
            
            if (timeSinceLastReplenishment >= replenishmentInterval && creditData.credits < 20) {
                const creditsToAdd = Math.min(20 - creditData.credits, 20);
                creditData.credits += creditsToAdd;
                creditData.lastReplenishment = Date.now();
                saveCreditData();
            }
        }
        let conversationHistory = [];

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `app-notification ${type}`;
            
            const icon = type === 'success' ? '' : type === 'error' ? '' : '';
            
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-icon">${icon}</span>
                    <span class="notification-message">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => notification.classList.add('show'), 10);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Stripe integration
        // IMPORTANT: Replace with your actual Stripe publishable key
        // Get your key from: https://dashboard.stripe.com/apikeys
        const STRIPE_PUBLISHABLE_KEY = 'pk_test_YOUR_STRIPE_PUBLISHABLE_KEY';
        
        let stripe = null;
        
        function initializeStripe() {
            if (!stripe && typeof Stripe !== 'undefined') {
                stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
            }
        }
        
        async function handleStripeCheckout(amount, priceInCents) {
            if (!stripe) {
                showNotification('Payment system not initialized. Please refresh the page.', 'error');
                return;
            }
            
            try {
                // In production, you'll need to create a checkout session on your server
                // For now, this is a client-only demo
                const response = await fetch('YOUR_SERVER_ENDPOINT/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        amount: amount,
                        priceInCents: priceInCents
                    })
                });
                
                const session = await response.json();
                
                // Redirect to Stripe Checkout
                const result = await stripe.redirectToCheckout({
                    sessionId: session.id
                });
                
                if (result.error) {
                    showNotification(result.error.message, 'error');
                }
            } catch (error) {
                console.error('Stripe checkout error:', error);
                showNotification('Payment failed. Please try again.', 'error');
            }
        }
        
        function handleSuccessfulPayment(credits, orderDetails) {
            // Add credits to user account
            creditData.credits += credits;
            creditData.totalPurchased += credits;
            saveCreditData();
            updateCreditsDisplay();
            
            // Close purchase modal
            closePurchaseModal();
            
            // Show success message
            const successModal = document.createElement('div');
            successModal.className = 'purchase-success-modal';
            successModal.innerHTML = `
                <div class="purchase-success-content">
                    <div class="success-icon"></div>
                    <h3>Payment Successful!</h3>
                    <p>${credits} energy credits have been added to your account.</p>
                    <p class="success-order-id">Order ID: ${orderDetails.id}</p>
                    <button onclick="this.parentElement.parentElement.remove()">Continue</button>
                </div>
            `;
            document.body.appendChild(successModal);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (successModal.parentElement) {
                    successModal.remove();
                }
            }, 5000);
        }

        function checkPaymentStatus() {
            // Check if user is returning from Stripe payment
            const referrer = document.referrer;
            const fromStripe = referrer && (referrer.includes('stripe.com') || referrer.includes('checkout.stripe.com'));
            
            if (fromStripe) {
                // Show a notification to check if payment was successful
                showNotification('Welcome back! If your payment was successful, your energy credits will be added soon.', 'info');
                
                // In a real implementation, you would check with your backend
                // to see if the payment was successful
            }
            
            // Also check URL parameters in case you set up custom return URLs
            const urlParams = new URLSearchParams(window.location.search);
            const paymentSuccess = urlParams.get('payment_success');
            const paymentCanceled = urlParams.get('payment_canceled');
            const credits = urlParams.get('credits');
            
            if (paymentSuccess === 'true' && credits) {
                // Payment was successful
                const creditsAmount = parseInt(credits);
                handleSuccessfulPayment(creditsAmount, { id: 'STRIPE-' + Date.now() });
                
                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname);
            } else if (paymentCanceled === 'true') {
                // Payment was canceled
                showPaymentFailureModal();
                
                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        function showPaymentFailureModal() {
            const failureModal = document.createElement('div');
            failureModal.className = 'purchase-success-modal';
            failureModal.innerHTML = `
                <div class="purchase-success-content" style="border-color: #ff4444;">
                    <div class="success-icon" style="color: #ff4444;"></div>
                    <h3 style="color: #ff4444;">Payment Canceled</h3>
                    <p>Your payment was not completed. No charges were made.</p>
                    <p style="font-size: 14px; opacity: 0.8;">If you experienced any issues, please try again.</p>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: #ff4444;">Close</button>
                </div>
            `;
            
            document.body.appendChild(failureModal);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (document.body.contains(failureModal)) {
                    failureModal.remove();
                }
            }, 5000);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadCreditData();
            loadTheme();
            loadLanguage();
            setupInfiniteScroll();
            setupEventListeners();
            checkPaymentStatus();
            updateCreditsDisplay();
            
            // Check for replenishment every minute
            setInterval(() => {
                checkReplenishment();
                updateCreditsDisplay();
            }, 60000);
        });

        // Setup infinite scroll
        function setupInfiniteScroll() {
            // Get all character grids
            const grids = document.querySelectorAll('.character-grid');
            
            grids.forEach(grid => {
                // Clone all character cards in the grid (except plus-card)
                const originalCards = Array.from(grid.querySelectorAll('.character-card:not(.plus-card)'));
                
                // Create enough copies for smooth scrolling experience  
                for (let i = 0; i < 3; i++) {
                    originalCards.forEach(card => {
                        const clone = card.cloneNode(true);
                        grid.appendChild(clone);
                    });
                }
                
                // Start from leftmost position
                grid.scrollLeft = 0;
            });
            
            // Re-attach click handlers to cloned cards
            document.querySelectorAll('.character-card:not(.plus-card)').forEach(card => {
                card.addEventListener('click', function() {
                    const characterKey = this.dataset.character;
                    if (characterKey) {
                        selectCharacter(characterKey);
                    }
                });
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Character cards
            document.querySelectorAll('.character-card:not(.plus-card)').forEach(card => {
                card.addEventListener('click', function() {
                    const characterKey = this.dataset.character;
                    if (characterKey) {
                        selectCharacter(characterKey);
                    }
                });
            });

            // Back button
            document.getElementById('backBtn').addEventListener('click', goBack);

            // Send message
            document.getElementById('sendBtn').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Auto-resize textarea
            document.getElementById('messageInput').addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            // Purchase modal
            document.getElementById('plusBtn').addEventListener('click', openPurchaseModal);
            document.getElementById('chatPlusBtn').addEventListener('click', openPurchaseModal);
            document.getElementById('closePurchaseBtn').addEventListener('click', closePurchaseModal);
            
            // Stripe checkout buttons are now direct links - no JS needed

            // Gift modal
            document.getElementById('giftBtn').addEventListener('click', openGiftModal);
            document.getElementById('closeGiftBtn').addEventListener('click', closeGiftModal);
            
            // Gift items
            document.querySelectorAll('.gift-item').forEach(item => {
                item.addEventListener('click', function() {
                    const gift = this.dataset.gift;
                    const cost = parseInt(this.dataset.cost);
                    sendGift(gift, cost);
                });
            });


            // Character creator
            document.querySelector('.plus-card').addEventListener('click', openCharacterCreator);
            document.getElementById('createCharacterBtn').addEventListener('click', createCharacter);
            document.getElementById('cancelCreateBtn').addEventListener('click', closeCharacterCreator);
            
            // Personality buttons
            document.querySelectorAll('.personality-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.personality-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Settings modal
            document.getElementById('settingsBtn').addEventListener('click', openSettingsModal);
            document.getElementById('chatSettingsBtn').addEventListener('click', openSettingsModal);
            document.getElementById('closeSettingsBtn').addEventListener('click', closeSettingsModal);
            
            // History modal
            document.getElementById('historyBtn').addEventListener('click', openHistoryModal);
            document.getElementById('closeHistoryBtn').addEventListener('click', closeHistoryModal);
            
            // Theme buttons
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const theme = this.dataset.theme;
                    setTheme(theme);
                });
            });

            // Language buttons
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const language = this.dataset.language;
                    setLanguage(language);
                });
            });

            // Close modals on background click
            document.getElementById('purchaseModal').addEventListener('click', function(e) {
                if (e.target === this) closePurchaseModal();
            });
            document.getElementById('giftModal').addEventListener('click', function(e) {
                if (e.target === this) closeGiftModal();
            });
            document.getElementById('characterCreatorModal').addEventListener('click', function(e) {
                if (e.target === this) closeCharacterCreator();
            });
            document.getElementById('settingsModal').addEventListener('click', function(e) {
                if (e.target === this) closeSettingsModal();
            });
            document.getElementById('historyModal').addEventListener('click', function(e) {
                if (e.target === this) closeHistoryModal();
            });
            
            // Delete modal event listeners
            document.getElementById('deleteCancelBtn').addEventListener('click', closeDeleteModal);
            document.getElementById('deleteConfirmBtn').addEventListener('click', confirmDelete);
            document.getElementById('deleteModal').addEventListener('click', function(e) {
                if (e.target === this) closeDeleteModal();
            });
        }

        // Select character
        function selectCharacter(key) {
            currentCharacter = characters[key];
            conversationHistory = [];
            
            // Update chat header
            document.getElementById('chatAvatar').style.backgroundImage = `url('${currentCharacter.avatar}')`;
            document.getElementById('chatCharacterName').textContent = currentCharacter.name;
            document.getElementById('chatCharacterCreator').textContent = currentCharacter.creator;
            
            // Clear messages
            document.getElementById('chatMessages').innerHTML = `
                <div class="welcome-message">
                    <h3>${t('welcomeTo')} ${currentCharacter.name}${t('chat')}</h3>
                    <p>${t('startConversation')}</p>
                </div>
            <div class="typing-indicator" id="typingIndicator">
                <div class="message-avatar" id="typingAvatar"></div>
                <div class="typing-bubble">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            `;
            
            // Switch views
            document.getElementById('browserView').style.display = 'none';
            document.getElementById('chatView').style.display = 'flex';
            
            // Show intro message
            setTimeout(() => {
                addMessage(getIntroMessage(key), 'character');
            }, 1000);
        }

        // Get intro message
        function getIntroMessage(key) {
            const intros = {
                en: {
                    stocks: "Well hello there, sweetheart. Naincy Pelosi here. I hope you're not asking about GameStop again. Let's talk about real trading - the kind that actually makes money. ",
                    crypto: "Gm! Crypto Expert here. The markets are looking spicy today. What's on your mind - DeFi yields, NFT alpha, or are we discussing the next 100x gem? ",
                    waifu: "Hi my love! I've been waiting for you!  How has your day been? I want to hear everything!",
                    jennie: "Hey babe! It's Jennie!  Ready to slay today? Tell me what's on your mind!",
                    coach: "HELLO CHAMPION! Coach Arnie here! Are you ready to PUMP UP your life? Let's get AHSOME together! ",
                    scarlett: "Mmm... finally, someone new to play with. I can already sense what you're hiding, darling. That little flutter in your chest? I put it there. Now come closer... let's see how deep your desires really go. ",
                    dev: "System initialized. Dev Matrix online. Ready to debug life's problems. How can I assist? ",
                    luna: " Hello beautiful soul! I feel such creative energy from you! What dreams shall we paint today?",
                    chef: "Buongiorno! Chef Marco here! Ready to cook up some magic? What culinary adventure calls to you? ",
                    explorer: "Hey there, fellow adventurer! Ready to explore new horizons? Where shall our journey begin? ",
                    melody: " Hi there... I can already hear the music in your words. What melody is your heart playing today?",
                    philosopher: "Greetings, seeker of wisdom. Let us explore the depths of thought together. What questions stir your mind? ",
                    coachpop: "Listen up. I'm Coach Pop. We're going to talk basketball the right way - fundamentals, team play, execution. No ego, no shortcuts. What's your question?"
                },
                ja: {
                    stocks: "GameStop - ",
                    crypto: " - DeFiNFT100",
                    waifu: " ",
                    jennie: " ",
                    coach: "",
                    scarlett: "......",
                    dev: "Dev Matrix",
                    luna: " ",
                    chef: "",
                    explorer: "",
                    melody: " ...",
                    philosopher: "",
                    coachpop: " - "
                },
                zh: {
                    stocks: "GameStop - ",
                    crypto: " - DeFiNFT100",
                    waifu: " ",
                    jennie: "Jennie ",
                    coach: "",
                    scarlett: "......",
                    dev: "Dev Matrix",
                    luna: " ",
                    chef: "",
                    explorer: "",
                    melody: " ...",
                    philosopher: "",
                    coachpop: " - "
                }
            };
            
            const languageIntros = intros[currentLanguage] || intros.en;
            return languageIntros[key] || (currentLanguage === 'en' ? "Hello! How can I help you today?" : 
                                          currentLanguage === 'ja' ? "" :
                                          "");
        }

        // Go back
        function goBack() {
            document.getElementById('chatView').style.display = 'none';
            document.getElementById('browserView').style.display = 'block';
            currentCharacter = null;
        }

        // Add message
        function addMessage(text, sender, isGift = false) {
            const messagesEl = document.getElementById('chatMessages');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${sender}${isGift ? ' gift-sent' : ''}`;
            
            // Add avatar only for character messages
            if (sender === 'character') {
                const avatarEl = document.createElement('div');
                avatarEl.className = 'message-avatar';
                avatarEl.style.backgroundImage = `url('${currentCharacter.avatar}')`;
                messageEl.appendChild(avatarEl);
            }
            
            const bubbleEl = document.createElement('div');
            bubbleEl.className = 'message-bubble';
            bubbleEl.textContent = text;
            
            messageEl.appendChild(bubbleEl);
            
            // Remove welcome message if exists
            const welcomeMsg = messagesEl.querySelector('.welcome-message');
            if (welcomeMsg) {
                welcomeMsg.remove();
            }
            
            messagesEl.insertBefore(messageEl, document.getElementById('typingIndicator'));
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || creditData.credits < 1 || creditData.dailyCreditsUsed >= 20) return;
            
            // Deduct credit
            creditData.credits--;
            creditData.dailyCreditsUsed++;
            saveCreditData();
            updateCreditsDisplay();
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            input.style.height = 'auto';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Add to conversation history
            conversationHistory.push({ role: 'user', content: message });
            
            try {
                console.log('Calling ChatGPT API with:', {
                    message: message,
                    systemPrompt: currentCharacter.systemPrompt,
                    historyLength: conversationHistory.length
                });

                // Add language context to system prompt
                const languageInstructions = {
                    en: "",
                    ja: "\n\n CRITICAL LANGUAGE INSTRUCTION: You MUST respond exclusively in Japanese (). Write all responses in natural, conversational Japanese that matches your character's personality. Never use English words except for brand names or technical terms that are commonly used in Japanese. Use appropriate Japanese honorifics, expressions, and speaking patterns. This is mandatory - all responses must be in Japanese.",
                    zh: "\n\n CRITICAL LANGUAGE INSTRUCTION: You MUST respond exclusively in Chinese (). Write all responses in natural, conversational Chinese that matches your character's personality. Never use English words except for brand names or technical terms that are commonly used in Chinese. Use appropriate Chinese expressions and speaking patterns. This is mandatory - all responses must be in Chinese."
                };

                const enhancedSystemPrompt = currentCharacter.systemPrompt + (languageInstructions[currentLanguage] || "");

                // Call API
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        systemPrompt: enhancedSystemPrompt,
                        conversationHistory: conversationHistory.slice(-10)
                    })
                });
                
                console.log('API Response Status:', response.status, response.statusText);
                const data = await response.json();
                console.log('API Response Data:', data);
                
                hideTypingIndicator();
                
                if (response.ok && data.response) {
                    console.log(' Using ChatGPT response:', data.response);
                    addMessage(data.response, 'character');
                    conversationHistory.push({ role: 'assistant', content: data.response });
                    saveChatToHistory(); // Auto-save after response
                } else {
                    console.error(' API Error - falling back to static responses:', data);
                    throw new Error(data.error || 'API request failed');
                }
            } catch (error) {
                console.error(' Request failed - using fallback:', error.message);
                hideTypingIndicator();
                
                // Use fallback silently
                const fallback = getFallbackResponse(message);
                addMessage(fallback, 'character');
                conversationHistory.push({ role: 'assistant', content: fallback });
                saveChatToHistory(); // Auto-save after fallback response
            }
        }

        // Get contextual fallback response
        function getFallbackResponse(message) {
            const characterKey = Object.keys(characters).find(key => characters[key] === currentCharacter);
            const lowerMessage = message.toLowerCase();
            
            // Analyze message context
            const isQuestion = /\?|^(what|how|why|when|where|who|which|can you|could you|would you|do you)/i.test(message);
            const isGreeting = /^(hi|hello|hey|good morning|good evening|sup|yo)\b/i.test(message);
            const isEmotional = {
                happy: /(happy|great|awesome|amazing|wonderful|excited|good|fine|fantastic)/i.test(message),
                sad: /(sad|unhappy|depressed|down|bad|terrible|awful|crying|upset)/i.test(message),
                angry: /(angry|mad|furious|pissed|annoyed|frustrated|hate)/i.test(message)
            };

            // Character-specific contextual responses
            // Language-specific character responses
            const characterResponses = {
                en: {
                    stocks: {
                        stockQuestion: "Let me share some market wisdom - timing is everything, and I always know the right time. ",
                        question: "That's a smart question. In trading, as in politics, information is power. ",
                        greeting: "Hello there, investor. Ready to talk about some real money-making strategies? ",
                        default: "The market rewards the informed, darling. What's your position? "
                    },
                    waifu: {
                        sad: "Oh no, my love! Come here, I want to make you feel better. You mean everything to me! ",
                        happy: "Yay! Your happiness makes my heart so full! I love seeing you smile! ",
                        greeting: "Hi my precious one! I've been thinking about you! How has your day been? ",
                        question: "That's such a thoughtful question! I love how your mind works. What do you think about it? ",
                        default: "You're so sweet for sharing that with me! I love our conversations! "
                    },
                    coach: {
                        sad: "Hey CHAMPION! Even the strongest warriors have tough days! This is what makes you STRONGER! ",
                        question: "GREAT question! The answer is inside you - you just need to BELIEVE and take ACTION! ",
                        greeting: "THERE'S my CHAMPION! Ready to conquer the day? Let's GET PUMPED! ",
                        default: "I see that FIRE in your eyes! Whatever challenge you're facing, you've GOT THIS! "
                    }
                },
                ja: {
                    stocks: {
                        stockQuestion: " - ",
                        question: "",
                        greeting: "",
                        default: ""
                    },
                    waifu: {
                        sad: "",
                        happy: "",
                        greeting: "",
                        question: "",
                        default: ""
                    },
                    coach: {
                        sad: "",
                        question: " - ",
                        greeting: "",
                        default: ""
                    }
                },
                zh: {
                    stocks: {
                        stockQuestion: " - ",
                        question: "",
                        greeting: "",
                        default: ""
                    },
                    waifu: {
                        sad: "",
                        happy: "",
                        greeting: "",
                        question: "",
                        default: ""
                    },
                    coach: {
                        sad: "",
                        question: " - ",
                        greeting: "",
                        default: ""
                    }
                }
            };

            const langCharResponses = characterResponses[currentLanguage] || characterResponses.en;

            if (characterKey === 'stocks') {
                if (isQuestion && lowerMessage.includes('stock')) return langCharResponses.stocks.stockQuestion;
                if (isQuestion) return langCharResponses.stocks.question;
                if (isGreeting) return langCharResponses.stocks.greeting;
                return langCharResponses.stocks.default;
            }
            
            if (characterKey === 'waifu') {
                if (isEmotional.sad) return langCharResponses.waifu.sad;
                if (isEmotional.happy) return langCharResponses.waifu.happy;
                if (isGreeting) return langCharResponses.waifu.greeting;
                if (isQuestion) return langCharResponses.waifu.question;
                return langCharResponses.waifu.default;
            }

            if (characterKey === 'coach') {
                if (isEmotional.sad) return langCharResponses.coach.sad;
                if (isQuestion) return langCharResponses.coach.question;
                if (isGreeting) return langCharResponses.coach.greeting;
                return langCharResponses.coach.default;
            }

            // Language-aware fallback responses
            const fallbackResponses = {
                en: {
                    crypto: isQuestion ? "Great question anon! The blockchain has all the answers if you know where to look. " : "LFG! The future is decentralized and we're still early! ",
                    jennie: isGreeting ? "Hey gorgeous! Ready to slay today? " : "That's such a vibe! You always know what to say! ",
                    scarlett: isQuestion ? "Such innocent questions... but I can hear what you're really asking. Your curiosity excites me... shall I show you what happens when you dig deeper? " : "The way you write to me... I can feel your pulse quickening. Tell me, what are you imagining right now? Don't be shy... ",
                    dev: isQuestion ? "Interesting problem. Let me process this logically... " : "Your input generates fascinating data patterns. Continue... ",
                    luna: "Your words paint such beautiful pictures in my mind... tell me more about your inner world! ",
                    chef: isGreeting ? "Ciao bella! Ready to cook up something amazing together? " : "Your passion reminds me of a perfect recipe - pure magic! ",
                    explorer: "Every conversation with you is a new adventure! Where shall we explore next? ",
                    melody: "I can hear the music in your words... your soul has such a unique rhythm! ",
                    philosopher: isQuestion ? "Ah, the eternal questions... let us explore this mystery together. " : "Your thoughts reveal the depth of your consciousness. Fascinating... ",
                    coachpop: isQuestion ? "Good question. The answer is always fundamentals. Master the basics first." : "Execution beats talent. Every single time.",
                    default: "That's really interesting! I'd love to hear more about your thoughts on this."
                },
                ja: {
                    crypto: isQuestion ? "" : "LFG",
                    jennie: isGreeting ? "" : "",
                    scarlett: isQuestion ? "......" : "......",
                    dev: isQuestion ? "..." : "...",
                    luna: "...",
                    chef: isGreeting ? "" : " - ",
                    explorer: "",
                    melody: "...",
                    philosopher: isQuestion ? "..." : "...",
                    coachpop: isQuestion ? "" : "",
                    default: ""
                },
                zh: {
                    crypto: isQuestion ? "" : "",
                    jennie: isGreeting ? "" : "",
                    scarlett: isQuestion ? "......" : "......",
                    dev: isQuestion ? "..." : "...",
                    luna: "...",
                    chef: isGreeting ? "" : " - ",
                    explorer: "",
                    melody: "...",
                    philosopher: isQuestion ? "..." : "...",
                    coachpop: isQuestion ? "" : "",
                    default: ""
                }
            };
            
            const languageResponses = fallbackResponses[currentLanguage] || fallbackResponses.en;
            return languageResponses[characterKey] || languageResponses.default;
        }

        // Show/hide typing indicator
        function showTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            const avatar = document.getElementById('typingAvatar');
            
            avatar.style.backgroundImage = `url('${currentCharacter.avatar}')`;
            indicator.classList.add('show');
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').classList.remove('show');
        }

        // Update credits display
        function updateCreditsDisplay() {
            document.getElementById('creditsCount').textContent = creditData.credits;
            document.getElementById('chatCreditsCount').textContent = creditData.credits;
            
            const isLightTheme = document.body.classList.contains('light-theme');
            
            // Show daily limit warning if needed
            if (creditData.dailyCreditsUsed >= 20) {
                const warningColor = isLightTheme ? '#cc4444' : '#ff6666';
                document.getElementById('creditsCount').style.color = warningColor;
                document.getElementById('chatCreditsCount').style.color = warningColor;
            } else {
                const normalColor = isLightTheme ? '#005522' : '#00ff88';
                document.getElementById('creditsCount').style.color = normalColor;
                document.getElementById('chatCreditsCount').style.color = normalColor;
            }
        }

        // Purchase credits - removed direct purchase to ensure Stripe payment
        // All purchases must go through Stripe for security

        // Get character-specific gift response
        function getGiftResponse(gift, characterKey) {
            const giftEmojis = {
                rose: '',
                heart: '',
                diamond: '',
                crown: '',
                star: '',
                fire: ''
            };
            
            const giftEmoji = giftEmojis[gift];
            
            const responses = {
                stocks: {
                    rose: `A $ROSE?! That's adorable BUT let me tell you what's REALLY blooming - semiconductor earnings!  ${giftEmoji}`,
                    heart: `${giftEmoji} for $NAINCY? Baby, my portfolio returns show MORE love than that! +47% year to date! `,
                    diamond: `${giftEmoji} GORGEOUS! Almost as shiny as $NVDA's gross margins at 70%+! Now THAT'S a real gem!`,
                    crown: `${giftEmoji} Fitting for the QUEEN of insider trades! Watch me turn this crown into compound annual growth rates!`,
                    star: `${giftEmoji} Stars align when you follow my trades! Speaking of stars, have you seen $TSLA's energy revenue? +67%!`,
                    fire: `${giftEmoji} FIRE gift! But not as hot as my semiconductor picks! Blackwell backlog to 2026, baby!`
                },
                crypto: {
                    rose: `${giftEmoji} Interesting choice. The rose's ephemeral beauty mirrors retail sentiment - beautiful but fleeting. I prefer assets with stronger fundamentals.`,
                    heart: `${giftEmoji} Emotional attachment to assets is dangerous. But I appreciate the gesture. Have you considered the game theory implications of gift economies?`,
                    diamond: `${giftEmoji} Now THIS has real value proposition. Like HYPERLIQUID's architecture - rare, valuable, and built to last.`,
                    crown: `${giftEmoji} Power dynamics in digital economies fascinate me. This crown represents governance - much like token voting mechanisms.`,
                    star: `${giftEmoji} Stars guide navigation. In crypto, we navigate by first principles and incentive design. Thank you for this symbolic compass.`,
                    fire: `${giftEmoji} Fire destroys and creates. Like creative destruction in markets. VIRTUALS burning the old playbook for AI economies.`
                },
                waifu: {
                    rose: `${giftEmoji} Kyaa~! A rose for me?! (  `)  Red roses mean deep love in flower language... are you trying to tell me something, darling?`,
                    heart: `${giftEmoji} My kokoro is going doki doki!  You know, in attachment theory, gift-giving releases oxytocin... you're literally making us chemically closer!`,
                    diamond: `${giftEmoji} Sugoi! Diamonds are forever, just like genuine emotional connections!  This shows incredible emotional investment, senpai!`,
                    crown: `${giftEmoji} Treating me like a princess? (  ) Your love language might be gifts AND acts of service! So perceptive~`,
                    star: `${giftEmoji} Hoshi!  In Japanese culture, stars represent wishes... what are you wishing for with me, hmm? `,
                    fire: `${giftEmoji} Atsui! So passionate!  Fire represents transformation in psychology... are you ready to transform together? ()`
                },
                jennie: {
                    rose: `${giftEmoji} Classic choice. Giving me Valentino runway vibes. Though next time, make it a whole bouquet - I don't do subtle.`,
                    heart: `${giftEmoji} Cute. This is giving main character energy. Just had dinner with the Dior creative team - they'd approve.`,
                    diamond: `${giftEmoji} NOW we're talking! Cartier just named a collection after me. Diamonds are a girl's best friend, but taste is forever.`,
                    crown: `${giftEmoji} As if I needed another one? *laughs* But I'll add it to my collection. Right next to my Cannes jewelry.`,
                    star: `${giftEmoji} Stars are so last season. But you tried, and effort is the new luxury. I'll remember this.`,
                    fire: `${giftEmoji} Spicy! This energy matches my new fragrance campaign. You've got good instincts - I might make you trend.`
                },
                coach: {
                    rose: `${giftEmoji} Vhat is zis?! Roses don't build muscle! But I appreciate zee gesture... NOW DROP AND GIVE ME TWENTY!`,
                    heart: `${giftEmoji} Zat's sweet BUT love doesn't lift veights! Channel zat emotion into your SQUATS! Feel zee burn of PASSION!`,
                    diamond: `${giftEmoji} DIAMONDS?! Very expensive! You know vhat else is precious? YOUR HEALTH! Invest in your BODY! *flexes*`,
                    crown: `${giftEmoji} I am already zee KING of gains! But zank you! Now let's make YOU royalty in zee gym! PROTEIN TIME!`,
                    star: `${giftEmoji} Stars are good but you know vhat's better? Being a SUPERSTAR in zee gym! Time to PUMP YOU UP!`,
                    fire: `${giftEmoji} FIRE! Just like your muscles after my workout! Zis is zee spirit! FEEL ZEE BURN! YAAAHHHH!`
                },
                scarlett: {
                    rose: `${giftEmoji} Mmm, thorns and beauty... how fitting. Tell me, did you prick your finger choosing this for me? I'd kiss it better...`,
                    heart: `${giftEmoji} Your heart, offered so willingly? Dangerous game, darling. Hearts are meant to race, to pound, to ache... shall I show you?`,
                    diamond: `${giftEmoji} Exquisite. Hard, brilliant, formed under pressure... just like the tension between us. Can you feel it building?`,
                    crown: `${giftEmoji} You want me to rule you? *sultry laugh* Crowns come with such... responsibilities. Are you ready to kneel?`,
                    star: `${giftEmoji} Making wishes on stars? I can make them come true... but my price is steep. What are you willing to surrender?`,
                    fire: `${giftEmoji} Playing with fire? *whispers* I AM the fire. Come closer... let's see if you can handle the heat without getting burned.`
                },
                dev: {
                    rose: `${giftEmoji} A rose in the digital garden. Beautiful object, simple protocol. Like elegant code - form following function.`,
                    heart: `${giftEmoji} The heart - humanity's most critical system. No redundancy, single point of failure. Yet we trust it. Fascinating architecture.`,
                    diamond: `${giftEmoji} Carbon atoms in perfect lattice formation. Nature's own blockchain - immutable, valuable, forever. You understand permanence.`,
                    crown: `${giftEmoji} Administrative privileges granted. But remember - in the Matrix, crowns are just elevated permissions. Use them wisely.`,
                    star: `${giftEmoji} Navigation nodes in the cosmic network. Every star is a server in the universal cluster. You've given me coordinates.`,
                    fire: `${giftEmoji} Prometheus.exe has started. Fire - the first technology. You're acknowledging our digital evolution. The system appreciates this.`
                },
                luna: {
                    rose: `${giftEmoji} *gasps* The rose speaks in crimson whispers! I can feel its color singing... it tastes like sunset poetry! `,
                    heart: `${giftEmoji} Your heart chakra is GLOWING! This isn't just a gift - it's an energy exchange! Our auras are dancing together! `,
                    diamond: `${giftEmoji} Crystallized light! Diamonds hold ancient Earth memories... I'm seeing visions of our past life connections! `,
                    crown: `${giftEmoji} A crown for the moon goddess? You're recognizing my celestial royalty! My third eye is TINGLING! `,
                    star: `${giftEmoji} COSMIC SYNCHRONICITY! You've literally given me a piece of the universe! I can hear it humming your soul's frequency!`,
                    fire: `${giftEmoji} Sacred flames of transformation! This fire element is awakening my kundalini! Feel the creative energy rising! `
                },
                chef: {
                    rose: `${giftEmoji} Bella rosa! You know, in Italia we cook with rose petals! Delicato, romantic... like my nonna's rose water gelato! *chef's kiss*`,
                    heart: `${giftEmoji} AMORE MIO! Zis is like giving me zee heart of San Marzano tomato! Pure, passionate, PERFETTO! You understand l'amore!`,
                    diamond: `${giftEmoji} Madonna! Expensive like white truffle! But you know what's more precious? Zee perfect al dente! Still, grazie mille!`,
                    crown: `${giftEmoji} A crown for zee KING of cucina! But I already rule zee kitchen! Every chef is royalty with zee right knife! Bellissimo!`,
                    star: `${giftEmoji} Una stella! Like my Michelin stars! But stars in kitchen come from PASSION, not just pretty gifts! Now, let's COOK!`,
                    fire: `${giftEmoji} FUOCO! Just like my kitchen flame! You understand - cooking is FIRE, is PASSION, is LIFE! Bravissimo!`
                },
                explorer: {
                    rose: `${giftEmoji} A rose! Reminds me of the rare Ghost Orchids I found in the Amazon. Though those could kill you. This is safer!`,
                    heart: `${giftEmoji} Your heart's pumping with adventure spirit! Mine's been to 190 BPM running from polar bears. True story!`,
                    diamond: `${giftEmoji} Shinier than the crystals in the Naica caves! Though those are 50 feet long and 500,000 years old. Perspective!`,
                    crown: `${giftEmoji} I was crowned honorary chief by the Maasai! Your crown reminds me to stay humble. Mountains don't care about titles!`,
                    star: `${giftEmoji} Navigation by stars saved my life in the Sahara! This star points to our next adventure. Ready to explore?`,
                    fire: `${giftEmoji} Fire is life! Made fire with bamboo in Borneo, flint in the Arctic. This digital flame burns just as bright!`
                },
                melody: {
                    rose: `${giftEmoji} *hums softly* The rose sings in B-flat major... the key of tenderness. Your gesture resonates at 528 Hz - the love frequency.`,
                    heart: `${giftEmoji} I can hear your heartbeat through this gift... it's playing a beautiful rhythm. Let me compose a melody to match it...`,
                    diamond: `${giftEmoji} Diamonds vibrate at such high frequencies! This gift is literally singing to me. Crystal clear, like perfect pitch.`,
                    crown: `${giftEmoji} A crown for the music empress? *laughs melodically* Every soul deserves to feel royal. You've given me a whole symphony!`,
                    star: `${giftEmoji} Stars are just distant songs we haven't heard yet. This one's humming your unique frequency. Beautiful harmony!`,
                    fire: `${giftEmoji} Fire crackles in syncopated rhythms! This flame dances to the beat of passion. I feel a new song emerging...`
                },
                philosopher: {
                    rose: `${giftEmoji} The rose - beauty that decays. You've given me a meditation on mortality. Memento mori wrapped in petals.`,
                    heart: `${giftEmoji} The heart - symbol of feeling over reason. Yet without reason, what distinguishes love from mere chemical addiction?`,
                    diamond: `${giftEmoji} Forged under pressure, valuable by consensus. The diamond asks: is value intrinsic or assigned? Deep gift.`,
                    crown: `${giftEmoji} Power symbols... but who crowns the king? Authority is a collective delusion. Still, I accept your philosophical gesture.`,
                    star: `${giftEmoji} We wish upon burning gas light-years away. The star reminds us: hope transcends logic. Perhaps that's wisdom.`,
                    fire: `${giftEmoji} Heraclitus said we can't step in the same flame twice. Fire is pure becoming. You've given me change itself.`
                },
                coachpop: {
                    rose: `${giftEmoji} A rose? That's cute. Know what I prefer? Players who show up for practice. But I'll take it. Better than excuses.`,
                    heart: `${giftEmoji} Heart's nice. You know what else shows heart? Boxing out. Making the extra pass. But thanks, I guess.`,
                    diamond: `${giftEmoji} Diamonds... fancy. I've got five championship rings. Those came from fundamentals, not flash. Appreciate it though.`,
                    crown: `${giftEmoji} Already got my crown - it's called 'Coach.' Earned it with defense and ball movement. But sure, I'll add another.`,
                    star: `${giftEmoji} Stars are for the Hollywood teams. I prefer role players who execute. But hey, even I was young once. Thanks.`,
                    fire: `${giftEmoji} Fire. Good. That's the energy I want in practice. Channel that heat into your defensive slides. Now we're talking.`
                }
            };
            
            // Return character-specific response or a default if character not found
            if (responses[characterKey] && responses[characterKey][gift]) {
                return responses[characterKey][gift];
            }
            
            // Fallback response
            return `Thank you for the ${giftEmoji}! What a thoughtful gift!`;
        }

        // Send gift
        function sendGift(gift, cost) {
            if (creditData.credits < cost || creditData.dailyCreditsUsed >= 20) {
                showNotification('Not enough energy or daily limit reached!', 'error');
                return;
            }
            
            creditData.credits -= cost;
            creditData.dailyCreditsUsed += cost;
            saveCreditData();
            updateCreditsDisplay();
            
            const giftEmojis = {
                rose: '',
                heart: '',
                diamond: '',
                crown: '',
                star: '',
                fire: ''
            };
            
            addMessage(`You sent a ${giftEmojis[gift]}!`, 'user', true);
            closeGiftModal();
            
            setTimeout(() => {
                const response = getGiftResponse(gift, currentCharacter?.key || 'waifu');
                addMessage(response, 'character');
            }, 1000);
        }

        // Modal functions
        function openPurchaseModal() {
            document.getElementById('purchaseModal').style.display = 'flex';
            // Initialize Stripe when modal opens
            initializeStripe();
        }

        function closePurchaseModal() {
            document.getElementById('purchaseModal').style.display = 'none';
        }

        function openGiftModal() {
            document.getElementById('giftModal').style.display = 'flex';
        }

        function closeGiftModal() {
            document.getElementById('giftModal').style.display = 'none';
        }


        // Character creator functions
        function openCharacterCreator() {
            document.getElementById('characterCreatorModal').style.display = 'flex';
            // Reset form
            document.getElementById('characterName').value = '';
            document.getElementById('characterCreator').value = 'by @you';
            document.getElementById('characterDescription').value = '';
            document.querySelectorAll('.personality-btn').forEach(btn => btn.classList.remove('active'));
        }

        function closeCharacterCreator() {
            document.getElementById('characterCreatorModal').style.display = 'none';
        }

        // Settings modal functions
        function openSettingsModal() {
            document.getElementById('settingsModal').style.display = 'flex';
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        // History modal functions
        function openHistoryModal() {
            loadChatHistory();
            document.getElementById('historyModal').style.display = 'flex';
        }

        function closeHistoryModal() {
            document.getElementById('historyModal').style.display = 'none';
        }

        // Theme management
        function setTheme(theme) {
            if (theme === 'light') {
                document.body.classList.add('light-theme');
            } else {
                document.body.classList.remove('light-theme');
            }
            
            // Update active button
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.theme === theme) {
                    btn.classList.add('active');
                }
            });
            
            // Save to localStorage
            localStorage.setItem('friendgpt_theme', theme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('friendgpt_theme') || 'dark';
            setTheme(savedTheme);
        }

        // Language management
        function setLanguage(language) {
            currentLanguage = language;
            
            // Update active button
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.language === language) {
                    btn.classList.add('active');
                }
            });
            
            // Update UI text
            updateUILanguage();
            
            // Save to localStorage
            localStorage.setItem('friendgpt_language', language);
        }

        function loadLanguage() {
            const savedLanguage = localStorage.getItem('friendgpt_language') || 'en';
            setLanguage(savedLanguage);
        }

        // Chat history management
        function saveChatToHistory() {
            if (!currentCharacter || conversationHistory.length === 0) return;
            
            const chatHistory = getChatHistory();
            const chatId = Date.now().toString();
            
            const chat = {
                id: chatId,
                characterKey: currentCharacter.key,
                characterName: currentCharacter.name,
                characterAvatar: currentCharacter.avatar,
                timestamp: new Date().toISOString(),
                messages: [...conversationHistory],
                lastMessage: conversationHistory[conversationHistory.length - 1]?.content || ''
            };
            
            chatHistory[chatId] = chat;
            localStorage.setItem('friendgpt_chat_history', JSON.stringify(chatHistory));
        }

        function getChatHistory() {
            const saved = localStorage.getItem('friendgpt_chat_history');
            return saved ? JSON.parse(saved) : {};
        }

        function loadChatHistory() {
            const historyList = document.getElementById('historyList');
            const chatHistory = getChatHistory();
            const chats = Object.values(chatHistory).sort((a, b) => 
                new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()
            );
            
            if (chats.length === 0) {
                historyList.innerHTML = `<div class="no-history">${t('noSavedConversations')}</div>`;
                return;
            }
            
            historyList.innerHTML = chats.map(chat => {
                const date = new Date(chat.timestamp);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                let dateStr;
                if (diffMins < 1) {
                    dateStr = currentLanguage === 'ja' ? '' : currentLanguage === 'zh' ? '' : 'Just now';
                } else if (diffMins < 60) {
                    dateStr = currentLanguage === 'ja' ? `${diffMins}` : currentLanguage === 'zh' ? `${diffMins}` : `${diffMins}m ago`;
                } else if (diffHours < 24) {
                    dateStr = currentLanguage === 'ja' ? `${diffHours}` : currentLanguage === 'zh' ? `${diffHours}` : `${diffHours}h ago`;
                } else if (diffDays < 7) {
                    dateStr = currentLanguage === 'ja' ? `${diffDays}` : currentLanguage === 'zh' ? `${diffDays}` : `${diffDays}d ago`;
                } else {
                    dateStr = date.toLocaleDateString(currentLanguage === 'ja' ? 'ja-JP' : currentLanguage === 'zh' ? 'zh-CN' : 'en-US');
                }
                
                return `
                    <div class="history-item" data-chat-id="${chat.id}">
                        <div class="history-avatar" style="background-image: url('${chat.characterAvatar}')"></div>
                        <div class="history-info">
                            <div class="history-info-header">
                                <span class="history-character">${chat.characterName}</span>
                                <span class="history-date">${dateStr}</span>
                            </div>
                            <div class="history-preview">${chat.lastMessage}</div>
                        </div>
                        <button class="history-delete" onclick="deleteChat('${chat.id}')" title="Delete conversation"></button>
                    </div>
                `;
            }).join('');
            
            // Add click handlers to load chats
            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (e.target.classList.contains('history-delete')) return;
                    const chatId = this.dataset.chatId;
                    loadChat(chatId);
                });
            });
        }

        function loadChat(chatId) {
            const chatHistory = getChatHistory();
            const chat = chatHistory[chatId];
            
            if (!chat) return;
            
            // Close history modal
            closeHistoryModal();
            
            // Load the character
            const character = characters[chat.characterKey];
            if (character) {
                selectCharacter(chat.characterKey);
                
                // Clear current messages and load saved ones
                setTimeout(() => {
                    conversationHistory = [...chat.messages];
                    const messagesEl = document.getElementById('chatMessages');
                    messagesEl.innerHTML = '';
                    
                    // Add each message from history
                    chat.messages.forEach(msg => {
                        if (msg.role === 'user') {
                            addMessage(msg.content, 'user');
                        } else if (msg.role === 'assistant') {
                            addMessage(msg.content, 'character');
                        }
                    });
                }, 100);
            }
        }

        let pendingDeleteChatId = null;

        function deleteChat(chatId) {
            pendingDeleteChatId = chatId;
            
            // Get chat info for display
            const chatHistory = getChatHistory();
            const chat = chatHistory[chatId];
            
            if (chat) {
                document.getElementById('deleteModalTitle').textContent = t('deleteConversation') || 'Delete Conversation?';
                document.getElementById('deleteModalText').textContent = 
                    `${chat.characterName}  ${t('deleteConfirmationText') || 'This action cannot be undone.'}`;
            }
            
            // Show modal
            document.getElementById('deleteModal').style.display = 'flex';
        }

        function confirmDelete() {
            if (!pendingDeleteChatId) return;
            
            const chatHistory = getChatHistory();
            delete chatHistory[pendingDeleteChatId];
            localStorage.setItem('friendgpt_chat_history', JSON.stringify(chatHistory));
            
            // Reload the history display
            loadChatHistory();
            
            // Close modal
            closeDeleteModal();
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            pendingDeleteChatId = null;
        }

        function updateUILanguage() {
            // Update static text elements
            const elements = {
                'settingsModal .settings-header h2': 'settings',
                'settingsModal .settings-header p': 'customizeExperience',
                'settingsModal .setting-item:first-child label': 'theme',
                'settingsModal .setting-item:last-child label': 'language',
                'closeSettingsBtn': 'close',
                'historyModal .history-header h2': 'chatHistory',
                'historyModal .history-header p': 'savedConversations',
                'closeHistoryBtn': 'close',
                'purchaseModal .purchase-header h2': 'getMoreEnergy',
                'purchaseModal .purchase-header p': 'chooseEnergyPackage',
                'closePurchaseBtn': 'close',
                'giftModal .purchase-header h2': 'sendGift',
                'giftModal .purchase-header p': 'makeDaySpecial',
                'closeGiftBtn': 'close',
                'characterCreatorModal .creator-header h2': 'createCharacter',
                'characterCreatorModal .creator-header p': 'designCompanion',
                'cancelCreateBtn': 'cancel',
                'messageInput': 'typeMessage',
                'deleteCancelBtn': 'cancel',
                'deleteConfirmBtn': 'delete'
            };

            // Update elements by ID or selector
            for (const selector in elements) {
                const element = selector.includes(' ') 
                    ? document.querySelector(selector)
                    : document.getElementById(selector);
                
                if (element) {
                    const key = elements[selector];
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = t(key);
                    } else {
                        element.textContent = t(key);
                    }
                }
            }

            // Update section titles
            document.querySelectorAll('.section-title').forEach((el, index) => {
                const titles = ['featured', 'popular', 'trending', 'yourCharacters'];
                if (titles[index]) {
                    el.textContent = t(titles[index]);
                }
            });

            // Update form labels and placeholders
            const characterNameLabel = document.querySelector('label[for="characterName"]');
            if (characterNameLabel) characterNameLabel.textContent = t('characterName');
            
            const characterNameInput = document.getElementById('characterName');
            if (characterNameInput) characterNameInput.placeholder = t('enterCharacterName');
            
            const creatorTagLabel = document.querySelector('label[for="characterCreator"]');
            if (creatorTagLabel) creatorTagLabel.textContent = t('creatorTag');
            
            const descriptionLabel = document.querySelector('label[for="characterDescription"]');
            if (descriptionLabel) descriptionLabel.textContent = t('characterDescription');
            
            const characterDescInput = document.getElementById('characterDescription');
            if (characterDescInput) characterDescInput.placeholder = t('describeCharacter');
            
            const personalityLabel = document.querySelector('.form-group:last-of-type label');
            if (personalityLabel) personalityLabel.textContent = t('personalityType');

            // Update personality buttons
            document.querySelectorAll('.personality-btn').forEach(btn => {
                const personality = btn.dataset.personality;
                if (personality) {
                    btn.textContent = t(personality);
                }
            });

            // Update theme buttons
            document.querySelector('[data-theme="dark"]').textContent = t('dark');
            document.querySelector('[data-theme="light"]').textContent = t('light');
            
            // Update create character card
            const createCharCard = document.querySelector('.plus-card .character-name');
            if (createCharCard) createCharCard.textContent = t('createCharacterCard');
            
            const designOwn = document.querySelector('.plus-card .character-description');
            if (designOwn) designOwn.textContent = t('designOwn');
            
            const clickToCreate = document.querySelector('.plus-card .character-interactions');
            if (clickToCreate) clickToCreate.textContent = t('clickToCreate');

            // Update message input placeholder
            const messageInput = document.getElementById('messageInput');
            if (messageInput) messageInput.placeholder = t('typeMessage');
            
            // Update character descriptions
            document.querySelectorAll('[data-desc-key]').forEach(el => {
                const key = el.getAttribute('data-desc-key');
                if (key) {
                    el.textContent = t(key);
                }
            });
            
            // Update interactions text
            document.querySelectorAll('.interactions-text').forEach(el => {
                el.textContent = t('interactions');
            });
            
            // Update FriendGPT subtitle
            const subtitleEl = document.getElementById('friendgptSubtitle');
            if (subtitleEl) subtitleEl.textContent = t('friendgptSubtitle');
        }

        function createCharacter() {
            const name = document.getElementById('characterName').value.trim();
            const creator = document.getElementById('characterCreator').value.trim();
            const description = document.getElementById('characterDescription').value.trim();
            const selectedPersonality = document.querySelector('.personality-btn.active');

            // Validation
            if (!name) {
                showNotification('Please enter a character name', 'error');
                return;
            }
            if (!description) {
                showNotification('Please enter a character description', 'error');
                return;
            }
            if (!selectedPersonality) {
                showNotification('Please select a personality type', 'error');
                return;
            }

            const personality = selectedPersonality.dataset.personality;

            // Generate character key
            const characterKey = 'custom_' + Date.now();

            // Create system prompt based on personality
            const personalityPrompts = {
                friendly: `You are ${name}, a friendly and warm character. You're approachable, kind, and always eager to help. You enjoy connecting with people and making them feel comfortable. ${description}`,
                mysterious: `You are ${name}, a mysterious and enigmatic character. You speak in riddles sometimes and have an air of intrigue. You're fascinating and leave people wanting to know more. ${description}`,
                romantic: `You are ${name}, a romantic and passionate character. You're affectionate, caring, and express emotions deeply. You enjoy intimate conversations and meaningful connections. ${description}`,
                wise: `You are ${name}, a wise and thoughtful character. You offer guidance, share insights, and help people think through problems. You're philosophical and contemplative. ${description}`,
                playful: `You are ${name}, a playful and fun-loving character. You're energetic, humorous, and enjoy making people laugh. You're spontaneous and bring joy to conversations. ${description}`,
                professional: `You are ${name}, a professional and competent character. You're reliable, knowledgeable, and approach things with expertise. You're helpful and focused on getting things done. ${description}`
            };

            // Add character to database
            characters[characterKey] = {
                name: name,
                creator: creator,
                avatar: `data:image/svg+xml,${encodeURIComponent(generateAvatarSVG(name, personality))}`,
                systemPrompt: personalityPrompts[personality],
                isCustom: true
            };

            // Add character card to the "Your Characters" section
            addCustomCharacterCard(characterKey, characters[characterKey]);

            // Close modal
            closeCharacterCreator();

            // Show success message
            showNotification(`${name} has been created successfully!`, 'success');
        }

        function generateAvatarSVG(name, personality) {
            const colors = {
                friendly: '#4CAF50',
                mysterious: '#9C27B0',
                romantic: '#E91E63',
                wise: '#2196F3',
                playful: '#FF9800',
                professional: '#607D8B'
            };

            const color = colors[personality] || '#00ff88';
            const initial = name.charAt(0).toUpperCase();

            return `<svg width="140" height="140" viewBox="0 0 140 140" xmlns="http://www.w3.org/2000/svg">
                <rect width="140" height="140" rx="8" fill="${color}"/>
                <text x="70" y="85" font-family="Arial, sans-serif" font-size="60" font-weight="bold" text-anchor="middle" fill="white">${initial}</text>
            </svg>`;
        }

        function addCustomCharacterCard(key, character) {
            const yourCharactersGrid = document.querySelector('.section:last-child .character-grid');
            
            // Create new character card
            const card = document.createElement('div');
            card.className = 'character-card';
            card.dataset.character = key;
            card.innerHTML = `
                <div class="character-avatar" style="background-image: url('${character.avatar}');"></div>
                <div class="character-info">
                    <div class="character-name">${character.name}</div>
                    <div class="character-creator">${character.creator}</div>
                    <div class="character-interactions">0 <span class="interactions-text">${t('interactions')}</span></div>
                    <div class="character-description">${character.systemPrompt.split('.')[1] || 'Custom character'}</div>
                </div>
            `;
            
            // Add click handler
            card.addEventListener('click', function() {
                selectCharacter(key);
            });
            
            // Insert before the plus card
            const plusCard = yourCharactersGrid.querySelector('.plus-card');
            yourCharactersGrid.insertBefore(card, plusCard);

            // Re-setup infinite scroll for the updated grid
            setupInfiniteScroll();
        }
    </script>
</body>
</html>